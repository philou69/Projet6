if (self.CavalryLogger) { CavalryLogger.start_js(["3\/mq4"]); }

__d("IrisProtocolMessageLifetime",[],(function a(b,c,d,e,f,g){f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:30000,TTL_1MINUTE:60000,TTL_3MINUTES:180000,TTL_5MINUTES:300000,TTL_10MINUTES:600000,TTL_15MINUTES:900000,TTL_30MINUTES:1800000,TTL_1HOUR:3600000,TTL_2HOURS:7200000,TTL_4HOURS:14400000,TTL_8HOURS:28800000,TTL_12HOURS:43200000,TTL_24HOURS:86400000};}),null);
__d("MercurySyncTopicType",[],(function a(b,c,d,e,f,g){f.exports={DELTA:"delta",DELTAFLOW:"deltaflow",DELTAFLOWREJECT:"deltaflowreject"};}),null);
__d("MessagingThreadAction",[],(function a(b,c,d,e,f,g){f.exports={ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"};}),null);
__d("MessengerApprovalQueueTypes",[],(function a(b,c,d,e,f,g){f.exports={REQUESTED:"REQUESTED",REMOVED:"REMOVED"};}),null);
__d("OmniMActionType",[],(function a(b,c,d,e,f,g){f.exports={CREATE_EVENT:1,LOCATION:2,PAYMENT:3,POLL:4,STICKER:5,TEXT:6,TRANSPORTATION:7,ORDER_FOOD:8,MAKE_RESERVATION:9,SCHEDULE_CALL:10,LIVE_LOCATION:11,VIDEO_CALL:12,VOICE_CALL:13,SAVE_CONTENT:14,PLAY_GAME:15,SHARE_CONTACT:16,SEND_PHOTO:17,CREATE_REMINDER_DEPRECATED:18,CREATE_REMINDER:19};}),null);
__d("OmniMDirectiveType",[],(function a(b,c,d,e,f,g){f.exports={ADD_ACTIONS:1,CLEAR_ACTIONS:2,ADD_RANGES:3,INVOKE_NATIVE_AGENT:4,MUTATE_FLOW_STATE:5};}),null);
__d("OmniMLoggerEvents",[],(function a(b,c,d,e,f,g){f.exports={MESSAGE_ANALYZED:"omni_m_message_analyzed",INTENT_DETECTED:"omni_m_intent_detected",INTENT_HANDLED:"omni_m_intent_handled",SUGGESTION_GENERATED:"omni_m_suggestion_generated",SUGGESTION_SENT:"omni_m_suggestion_sent",SUGGESTION_DISPLAYED:"omni_m_suggestion_displayed",SUGGESTION_CLICKED:"omni_m_suggestion_clicked",SUGGESTION_COMPLETED:"omni_m_suggestion_completed",SUGGESTION_DISMISSED:"omni_m_suggestion_dismissed",SUGGESTION_DISAPPEARED:"omni_m_suggestion_disappeared",BAR_DISMISSED:"omni_m_bar_dismissed",BAR_DISPLAYED:"omni_m_bar_displayed",BAR_DISAPPEARED:"omni_m_bar_disappeared",ORGANIC_CLICKED:"omni_m_organic_clicked",ORGANIC_COMPLETED:"omni_m_organic_completed"};}),null);
__d("PagesMessagingEventType",[],(function a(b,c,d,e,f,g){f.exports={FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3};}),null);
__d('MercurySyncHolesTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:MercurySyncHolesLoggerConfig',this.$MercurySyncHolesTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers['extends']({},this.$MercurySyncHolesTypedLogger1,j);return this;};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this;};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this;};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this;};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this;};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h;}),null);
__d('OmniMEventTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],(function a(b,c,d,e,f,g){'use strict';function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:OmniMEventLoggerConfig',this.$OmniMEventTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$OmniMEventTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$OmniMEventTypedLogger1=babelHelpers['extends']({},this.$OmniMEventTypedLogger1,j);return this;};h.prototype.setActionID=function(j){this.$OmniMEventTypedLogger1.action_id=j;return this;};h.prototype.setActionTypeFromBlob=function(j){this.$OmniMEventTypedLogger1.action_type_from_blob=j;return this;};h.prototype.setAgentName=function(j){this.$OmniMEventTypedLogger1.agent_name=j;return this;};h.prototype.setAppID=function(j){this.$OmniMEventTypedLogger1.appid=j;return this;};h.prototype.setAppversion=function(j){this.$OmniMEventTypedLogger1.appversion=j;return this;};h.prototype.setClientUserID=function(j){this.$OmniMEventTypedLogger1.client_userid=j;return this;};h.prototype.setClienttime=function(j){this.$OmniMEventTypedLogger1.clienttime=j;return this;};h.prototype.setConfidence=function(j){this.$OmniMEventTypedLogger1.confidence=j;return this;};h.prototype.setConfidenceRemapped=function(j){this.$OmniMEventTypedLogger1.confidence_remapped=j;return this;};h.prototype.setContextUserID=function(j){this.$OmniMEventTypedLogger1.context_user_id=j;return this;};h.prototype.setCuApp=function(j){this.$OmniMEventTypedLogger1.cu_app=j;return this;};h.prototype.setEventName=function(j){this.$OmniMEventTypedLogger1.event_name=j;return this;};h.prototype.setIntentID=function(j){this.$OmniMEventTypedLogger1.intent_id=j;return this;};h.prototype.setMessageID=function(j){this.$OmniMEventTypedLogger1.message_id=j;return this;};h.prototype.setMessageLength=function(j){this.$OmniMEventTypedLogger1.message_length=j;return this;};h.prototype.setName=function(j){this.$OmniMEventTypedLogger1.name=j;return this;};h.prototype.setPersonalization=function(j){this.$OmniMEventTypedLogger1.personalization=j;return this;};h.prototype.setPigeonID=function(j){this.$OmniMEventTypedLogger1.pigeon_id=j;return this;};h.prototype.setPosition=function(j){this.$OmniMEventTypedLogger1.position=j;return this;};h.prototype.setSource=function(j){this.$OmniMEventTypedLogger1.source=j;return this;};h.prototype.setSuggestionData=function(j){this.$OmniMEventTypedLogger1.suggestion_data=c('GeneratedLoggerUtils').serializeMap(j);return this;};h.prototype.setSuggestionIds=function(j){this.$OmniMEventTypedLogger1.suggestion_ids=c('GeneratedLoggerUtils').serializeVector(j);return this;};h.prototype.setSuggestionMode=function(j){this.$OmniMEventTypedLogger1.suggestion_mode=j;return this;};h.prototype.setSuggestionTitle=function(j){this.$OmniMEventTypedLogger1.suggestion_title=j;return this;};h.prototype.setSuggestionType=function(j){this.$OmniMEventTypedLogger1.suggestion_type=j;return this;};h.prototype.setThreadID=function(j){this.$OmniMEventTypedLogger1.thread_id=j;return this;};h.prototype.setTotalSuggestions=function(j){this.$OmniMEventTypedLogger1.total_suggestions=j;return this;};h.prototype.setVC=function(j){this.$OmniMEventTypedLogger1.vc=j;return this;};var i={action_id:true,action_type_from_blob:true,agent_name:true,appid:true,appversion:true,client_userid:true,clienttime:true,confidence:true,confidence_remapped:true,context_user_id:true,cu_app:true,event_name:true,intent_id:true,message_id:true,message_length:true,name:true,personalization:true,pigeon_id:true,position:true,source:true,suggestion_data:true,suggestion_ids:true,suggestion_mode:true,suggestion_title:true,suggestion_type:true,thread_id:true,total_suggestions:true,vc:true};f.exports=h;}),null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get(),k='source:messenger_growth:event_upcoming_bump';function l(m,n){c('MercuryAssert').isThreadID(m);j.getThreadMeta(m,function(o){i.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1],r=[];if(q.tags!==undefined)r=r.concat(q.tags);if(q.log_message_data&&(q.log_message_data.message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST||q.log_message_data.message_type==c('MessagingGenericAdminTextType').WORK_INVITE_CLAIMED)){n(h._("New contact added"));}else if(r.indexOf(k)!==-1){n(h._("You have an upcoming event."));}else if(q&&q.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(q.author,function(s){var t=s.short_name;if(o.custom_nickname){var u=c('MercuryIDs').getUserIDFromParticipantID(s.id);if(o.custom_nickname[u])t=o.custom_nickname[u];}if(o.name){n(h._("{senderName} messaged {groupName}",[h.param('senderName',t),h.param('groupName',o.name)]));}else if(c('MercuryIDs').isGroupChat(m)){n(h._("{name} messaged your group",[h.param('name',t)]));}else n(h._("{name} messaged you",[h.param('name',t)]));});}else n(h._("New message!"));});});}f.exports={renderDocumentTitle:l};}),null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryDispatcher','MercuryPayloadSource','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c('MercuryDispatcher').getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe('update-messages',this.$MercuryTimestampTracker4.bind(this));}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE||k.payload_source===c('MercuryPayloadSource').UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c('MercuryActionType').USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp;}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('ChatTitleBarBlinker',['ChatActivity','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c('PresenceState').doSync();}}var p={blink:function u(v,w){if(!k&&l<w)c('MercuryNotificationRenderer').renderDocumentTitle(v,function(x){if(!k)k=c('DocumentTitle').blink(x);});},stopBlinking:function u(){o();},blinkingElsewhere:function u(){m=true;}};function q(u){var v=c('PresenceState').verifyNumber(u.sb2);if(!v||v<=l)return null;return v;}function r(u){var v=u&&q(u);if(v){l=v;j.debug('load',l);n();m=false;}}function s(u){var v=q(u);if(!v){j.debug('store',l);u.sb2=l;m=false;}return u;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x);});c('ChatActivity').subscribe('activity',function(){return o();});var t=c('PresenceState').getInitial();if(t)l=q(t)||0;f.exports=p;}),null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','Event','Map','mercuryBlockedParticipantsRe','MercuryConfig','MercuryIDs','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryThreads').get(),j=3,k=600000,l=new (c('Map'))(),m=0;function n(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function o(){l=new (c('Map'))();}function p(r){if(c('ChatOptions').getSetting('sound')&&!n())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],r,false);}var q=Object.assign({init:function r(){c('Event').listen(window,'focus',function(){o();clearInterval(m);});c('Event').listen(window,'blur',function(){m=setInterval(o,k);});},messageReceived:function r(s){if(s.author&&c('MercuryViewer').isViewer(s.author)||!s.is_unread||s.folder!=c('MessagingTag').INBOX&&s.folder!=c('MessagingTag').ARCHIVED)return;var t=s.thread_id,u=c('ChatActivity').isActive();if(u){var v=false;q.inform('before-alert',{threadID:t,cancelAlert:function w(){v=true;}});}i.getThreadMeta(t,function(w){var x=c('MercuryThreadInfo').isMuted(w),y=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(x)if(!c('MercuryThreadInfo').areMentionsMuted(w)){if(!s.profile_ranges||!s.profile_ranges.some||!s.profile_ranges.some(function(ba){return ba.id===y;}))return;}else return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u){!v&&p(z);}else{c('ChatTitleBarBlinker').blink(t,z);var aa=l.get(t)||0;if(aa<j){l.set(t,aa+1);p(z);}}c('ChatTitleBarBlinker').blinkingElsewhere();});}},c('ArbiterMixin'));f.exports=q;}),null);
__d('ChatAppActions',['ChatDispatcher','ChatAppActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={tti:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').TTI});},hide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').HIDE});},unhide:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').UNHIDE});},setInitialDisplayDone:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').INITIAL_DISPLAY_DONE});},load:function i(){c('ChatDispatcher').dispatch({type:c('ChatAppActionTypes').LOAD});}};f.exports=h;}),null);
__d('MontageDispatcher',['ExplicitRegistrationDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MontageActions',['MontageDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({REQUEST_UPDATE:null,HAS_UPDATED:null}),i={Types:h,requestUpdate:function j(k){c('MontageDispatcher').dispatch({type:h.REQUEST_UPDATE,threadFBID:k});},hasUpdated:function j(k){c('MontageDispatcher').dispatch({type:h.HAS_UPDATED,threadFBID:k});}};f.exports=i;}),null);
__d('FantaCookieUtil',['FantaConst','MercuryIDs','MercuryThreads','WorkModeConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreads').get(),i={convertCookieData:function j(k,l){var m={tabs:[],focusedTabID:null,updatedTime:0},n=[],o=this._getCookieKeys();k=k||{};if(k[o.tabs])n=k[o.tabs];n.forEach(function(u){m.tabs.push({id:u.i,isMinimized:!u.r,openCounter:u.o,focusCounter:u.f});});if(l)for(var p=l.tabs.values(),q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var s;if(q){if(r>=p.length)break;s=p[r++];}else{r=p.next();if(r.done)break;s=r.value;}var t=s;if(h.isEmptyLocalThread(t.id))m.tabs.push({id:t.id,isMinimized:t.isMinimized,openCounter:t.openCounter,focusCounter:t.focusCounter});}m.focusedTabID=k[o.focusedTabID];m.updatedTime=k[o.updatedTime];return m;},createCookieData:function j(k,l){var m=[],n=this._getCookieKeys();for(var o=k.tabs.values(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var r;if(p){if(q>=o.length)break;r=o[q++];}else{q=o.next();if(q.done)break;r=q.value;}var s=r;if(!c('MercuryIDs').isLocalThread(s.id))m.push({i:s.id,r:s.isMinimized?undefined:1,o:s.openCounter,f:s.focusCounter});}l[n.tabs]=m;l[n.focusedTabID]=k.focusedTabID;l[n.updatedTime]=k.updatedTime;return l;},_getCookieKeys:function j(){var k=c('WorkModeConfig').is_work_user;return {tabs:k?c('FantaConst').cookieIDs.WORK_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_COOKIE_ID,focusedTabID:k?c('FantaConst').cookieIDs.WORK_FOCUS_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_FOCUS_COOKIE_ID,updatedTime:k?c('FantaConst').cookieIDs.WORK_TIME_COOKIE_ID:c('FantaConst').cookieIDs.PERSONAL_TIME_COOKIE_ID};}};f.exports=i;}),null);
__d('FantaMercuryThreadEventsBootloaded',['Bootloader','MercuryThreadInformer','MercuryThreads','MercuryViewer'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryThreads').get(),j={onMessagesReceived:function k(l){h.subscribe('messages-received',function(m,n){var o,p=function r(s){var t,u=n[s],v=function x(y){var z=u[y];if(z.author!=c('MercuryViewer').getID()){if(!z.is_unread)return 'continue';i.getThreadMeta(s,function(aa){c('Bootloader').loadModules(["ChatTabPolicy"],function(ba){ba.messageIsAllowed(aa,z,function(){l(s,z);});},'FantaMercuryThreadEventsBootloaded');});}};for(var w=0;w<u.length;w++){var t=v(w);if(t==='continue')continue;}};for(var q in n)p(q);});}};f.exports=j;}),null);
__d('FantaMessageActions',['Bootloader','FantaDispatcher','MercuryConfig','ifRequired','keyMirror','emptyFunction'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CANCEL_FILE_UPLOAD:null,COMPOSER_TEXT_UPDATE:null,LINK_PREVIEW:null,LOADED_SHARE_DATA:null,LOADING_SHARE_DATA:null,PREPARE_FILES_FOR_SEND:null,RECEIVED_NEW_MESSAGE:null,REMOVE_SHARE_PREVIEW:null,SEND_GROUP_MESSAGE:null,SEND_HOT_LIKE:null,SEND_MESSAGE:null,SEND_PHOTO:null,SEND_STICKER:null,UPDATE_GROUP_NAME:null,UPLOAD_FILE_FAILED:null,UPLOADED_FILE:null});function i(){var l=document.createElement('form');l.action=c('MercuryConfig').upload_url;l.method='post';return l;}function j(l,m){var n=document.createElement('input');n.type='file';n.name='attachment[]';n.multiple=true;if(m)n.onchange=m;l.appendChild(n);return n;}var k={Types:h,prepareFilesForSend:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.PREPARE_FILES_FOR_SEND,tabID:m,files:n});});},openUploadFilePicker:function l(m){var n=i(),o=j(n,function(){k.prepareFilesForSend(m,this.files);});o.click();},uploadedFile:function l(m,n,o){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOADED_FILE,tabID:m,uploadID:n,payload:o});});},uploadFileFailed:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.UPLOAD_FILE_FAILED,tabID:m,uploadID:n});});},cancelFileUpload:function l(m,n){this.dispatchOrBootloadUploader(function(){c('FantaDispatcher').dispatch({type:h.CANCEL_FILE_UPLOAD,tabID:m,uploadID:n});});},linkPreview:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LINK_PREVIEW,tabID:m,uri:n});});},loadedShareData:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADED_SHARE_DATA,tabID:m,attachmentData:n});});},loadingShareData:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.LOADING_SHARE_DATA,tabID:m});});},removeSharePreview:function l(m){this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.REMOVE_SHARE_PREVIEW,tabID:m});});},receivedNewMessage:function l(m,n){c('FantaDispatcher').dispatch({type:h.RECEIVED_NEW_MESSAGE,tabID:m,message:n});},updateGroupName:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.UPDATE_GROUP_NAME,threadID:m,newName:n});});},sendGroupMessage:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_GROUP_MESSAGE,threadID:m,onSendSuccess:n});});},sendMessage:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_MESSAGE,threadID:m,message:n,onSendSuccess:o});});},sendPhoto:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_PHOTO,onSendSuccess:o,photoData:n,threadID:m});});},sendHotLike:function l(m,n,o,p,q){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_HOT_LIKE,emoji:n,onSendSuccess:q,size:o,source:p,threadID:m});});},sendSticker:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c('FantaDispatcher').dispatch({type:h.SEND_STICKER,threadID:m,stickerID:n,onSendSuccess:o});});},composerTextUpdate:function l(m,n){if(c('MercuryConfig').FantaTabView){if(n.length>0)c('ifRequired')('FantaReducersSendMessages',c('emptyFunction'),function(){return this.dispatchOrBootloadSendMessages(c('emptyFunction'));}.bind(this));this.dispatchOrBootloadSharePreview(function(){c('FantaDispatcher').dispatch({type:h.COMPOSER_TEXT_UPDATE,threadID:m,message:n});});}else c('FantaDispatcher').dispatch({type:h.COMPOSER_TEXT_UPDATE,threadID:m,message:n});},dispatchOrBootloadSendMessages:function l(m){c('ifRequired')('FantaReducersSendMessages',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSendMessages"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});},dispatchOrBootloadUploader:function l(m){c('ifRequired')('FantaReducersFileUploader',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersFileUploader"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});},dispatchOrBootloadSharePreview:function l(m){c('ifRequired')('FantaReducersSharePreview',function(){m();},function(){c('Bootloader').loadModules(["FantaAppStore","FantaReducersSharePreview"],function(n,o){n.addReducers(o);m();},'FantaMessageActions');});}};f.exports=k;}),null);
__d("isWebMessengerURI",[],(function a(b,c,d,e,f,g){function h(i){return /^(\/messages)/.test(i.getPath());}f.exports=h;}),null);
__d('FantaTabViewportManager',['Arbiter','DockTabsViewportCalculator','DockTabsViewportFantaTabUtils','FantaTabActions','immutable','ifRequired','isWebMessengerURI','setImmediate'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('DockTabsViewportCalculator').getInstance(i);if(!j)return;j.registerFantaTabCallbacks({fantaTabModelStateGetter:function k(){var l=c('immutable').Map({});c('ifRequired')('FantaAppStore',function(m){l=m.getState().tabGroup.tabs;});return l;},onAvailableWidthChanged:function k(l){c('setImmediate')(function(){c('FantaTabActions').setAllowedRaisedTabs(c('DockTabsViewportFantaTabUtils').getTabCountToFitWidth(l));});}});c('Arbiter').subscribe('FantaReducersDockCalculator/shouldRecalculate',function(){j.forceRecalculateChatTabs();});j.forceRecalculateFBDockWidth();c('Arbiter').subscribe('page_transition',function(k,l){if(c('isWebMessengerURI')(l.uri))c('setImmediate')(function(){return c('FantaTabActions').minimizeAllTabs();});});}f.exports={init:h};}),null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonProvider','mixin'],(function a(b,c,d,e,f,g){var h,i;h=babelHelpers.inherits(j,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;function j(l){'use strict';i.constructor.call(this);this.$MercuryDeliveryReceipts2=l;this.$MercuryDeliveryReceipts3=new (c('Map'))();this.$MercuryDeliveryReceipts1=c('MercuryDispatcher').getForFBID(this.$MercuryDeliveryReceipts2);this.$MercuryDeliveryReceipts1.subscribe('update-delivery',function(m,n){if(n.delivery_receipts)for(var o in n.delivery_receipts){var p=n.delivery_receipts[o],q=this.$MercuryDeliveryReceipts3.get(o)||0;if(p>q){this.$MercuryDeliveryReceipts3.set(o,p);this.informDeliveryStatusChanged(o);}}}.bind(this));}j.getForFBID=function(l){'use strict';return k.getForFBID(l);};j.get=function(){'use strict';return k.get();};j.prototype.informDeliveryStatusChanged=function(l){'use strict';var m=new (c('Map'))();m.set(l,true);this.inform('change',m);};j.prototype.getDeliveryTime=function(l){'use strict';return this.$MercuryDeliveryReceipts3.get(l)||0;};var k=new (c('MercurySingletonProvider'))(j);f.exports=j;}),null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryDelayedDispatcher',['MercuryDispatcher','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c('MercuryThreadIDMap').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c('MercuryDispatcher').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c('MercuryServerRequests').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe('model-update-completed',function(k,l){return this.$MercuryDelayedDispatcher7();}.bind(this));}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return;}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push({thread_fbid:k,payload:j});}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k);};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2.shift(),k=j.thread_fbid,l=j.payload;this.handleUpdateWaitForThread(l,k);}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client){this.$MercuryDelayedDispatcher4.handleUpdate(j);}else this.$MercuryDelayedDispatcher6.handleUpdate(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryMessageCustomizations',[],(function a(b,c,d,e,f,g){'use strict';function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k;});return m.length>0?m[0].customization_value:null;}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]});});return l;}f.exports={getCustomizationValue:h,parseCustomizations:i};}),null);
__d('MercuryProfileRanges',['idx'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(!i.id&&i.i)return {id:i.i,offset:i.o,length:i.l};return i;}f.exports={extractFromDelta:function i(j){var k,l=(k=j)!=null?(k=k.data)!=null?k.prng:k:k;if(!l)return undefined;var m=[];try{m=JSON.parse(l);if(m.length>0)return m.map(h);}catch(n){}return m;}};}),null);
__d('MercurySyncNewMessageTransformer',['IrisProtocolMessageLifetime','MercuryActionType','MercuryIDs','MercuryMessageCustomizations','MercuryProfileRanges','MercuryTimestamp','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';var h=function j(k){var l={};try{l=JSON.parse(k);}catch(m){}return l;};function i(j,k){var l=parseInt(k.messageMetadata.timestamp,10),m=c('MercuryTimestamp').getFormatedTimestamp(l),n=k.messageMetadata.skipBumpThread,o=j!==k.messageMetadata.actorFbId,p=[];if(k.attachments)p=k.attachments.map(function(r){return r.mercury;});var q=k.messageMetadata.tags?k.messageMetadata.tags[0]:undefined;return {message_id:k.messageMetadata.messageId,threading_id:null,offline_threading_id:k.messageMetadata.offlineThreadingId,author:c('MercuryIDs').getParticipantIDFromUserID(k.messageMetadata.actorFbId),author_email:k.messageMetadata.actorFbId+'@facebook.com',ephemeral_ttl_mode:k.ttl?c('IrisProtocolMessageLifetime')[k.ttl]:0,timestamp:l,is_unread:o,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,source:q,tags:k.messageMetadata.tags,is_spoof_warning:false,folder:c('MessagingTag').INBOX,thread_fbid:k.messageMetadata.threadKey.threadFbId,other_user_fbid:k.messageMetadata.threadKey.otherUserFbId,body:k.body!==undefined?k.body:'',html_body:null,subject:null,has_attachment:p.length>0,attachments:p,ranges:undefined,thread_id:null,action_type:c('MercuryActionType').USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(k.data&&k.data.is_sponsored&&k.data.is_sponsored==='true'),commerce_message_type:k.data?k.data.commerce_message_type:null,customizations:k.data&&k.data.customization?c('MercuryMessageCustomizations').parseCustomizations(k.data.customization):null,platform_xmd:k.data&&k.data.platform_xmd?k.data.platform_xmd:null,profile_ranges:c('MercuryProfileRanges').extractFromDelta(k),message_source:k.data&&k.data.message_source_data?h(k.data.message_source_data).message_source:null,skip_bump_thread:n,montage_reply_data:k.data&&k.data.montage_reply_data?h(k.data.montage_reply_data):null,meta_ranges:k.data&&k.data.meta_ranges?h(k.data.meta_ranges):null};}f.exports={transform:i};}),null);
__d('MercurySyncAdminTextMessageTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c('MercuryLogMessageType').GENERIC_ADMIN_TEXT;return k;}f.exports={transform:h};}),null);
__d('MercurySyncClientPayloadTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(k){var l=k.payload;l=JSON.parse(String.fromCharCode.apply(null,l));var m=l&&l.deltas,n=m[0];if(n.deltaMessageReaction){return i(n.deltaMessageReaction);}else return j(n);}function i(k){var l=k.messageId,m=k.offlineThreadingId,n=k.reaction,o=k.senderId,p=k.userId,q=k.threadKey.threadFbId||k.threadKey.otherUserFbId;return {action_type:c('MercuryActionType').REACTION_UPDATE,messageId:l,offlineThreadingId:m,reaction:n?decodeURIComponent(window.escape(n)):undefined,senderId:o,thread_fbid:q,userId:p};}function j(k){var l=k&&k.deltaPaymentPinProtectionStatusData,m=l&&l.threadKey&&l.threadKey.otherUserFbId,n=l&&l.isPinProtected;if(!m)return null;var o=m.toString();return {action_type:c('MercuryActionType').IS_PIN_PROTECTED,thread_fbid:o,is_pin_protected:n};}f.exports={transform:h};}),null);
__d('MercurySyncDeliveryReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){return {delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:'',thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:'',time:parseInt(i.deliveredWatermarkTimestampMs,10)}]};}f.exports={transform:h};}),null);
__d('MercurySyncMarkFolderSeenTransformer',['MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_SEEN,folder:c('MessagingTag').IRIS_MAPPING[j],timestamp:parseInt(i.timestamp,10)};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkReadTransformer',['MercuryActionType','MercuryGlobalActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return {action_type:c('MercuryGlobalActionType').MARK_ALL_READ,action_id:null,folder:c('MessagingTag').IRIS_MAPPING[j],timestamp:parseInt(i.watermarkTimestamp,10)};});return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMarkUnreadTransformer',['MercuryActionType','MessagingTag'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:false,timestamp:parseInt(i.watermarkTimestamp,10),folder:c('MessagingTag').INBOX};});}f.exports={transform:h};}),null);
__d('MercurySyncMessageDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};}f.exports={transform:h};}),null);
__d('MercurySyncPagesManagerEventTransformer',['MercuryActionType','PagesMessagingEventType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=JSON.parse(i.jsonBlob),k=j&&j.type;if(!k)return undefined;switch(k){case c('PagesMessagingEventType').FLAG:var l=!!(j&&j.flagData&&j.flagData.state),m={action_type:c('MercuryActionType').CHANGE_FLAG,mark_as_flag:l,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return m;default:return undefined;}}f.exports={transform:h};}),null);
__d('MercurySyncParticipantLeftGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c('MercuryIDs').getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c('MercuryLogMessageType').UNSUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncParticipantsAddedToGroupThreadTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return c('MercuryIDs').getParticipantIDFromUserID(l.userFbId);})};k.log_message_type=c('MercuryLogMessageType').SUBSCRIBE;return k;}f.exports={transform:h};}),null);
__d('MercurySyncRTCEventLogTransformer',['MercuryActionType','MercuryIDs','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i;k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c('MercuryIDs').getParticipantIDFromUserID(m),caller:c('MercuryIDs').getParticipantIDFromUserID(l)};k.log_message_type=c('MercuryLogMessageType').VIDEO_CALL;return k;}f.exports={transform:h};}),null);
__d('MercurySyncReadReceiptTransformer',[],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={watermark:parseInt(i.watermarkTimestampMs,10),action:parseInt(i.actionTimestampMs,10)},k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m;}f.exports={transform:h};}),null);
__d('MercurySyncReplaceMessageTransformer',['MercuryActionType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c('MercurySyncNewMessageTransformer').transform(i,j),{action_type:c('MercuryActionType').REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId});}f.exports={transform:h};}),null);
__d('MercurySyncRtcCallDataTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=i.messageMetadata.threadKey&&i.messageMetadata.threadKey.threadFbId?i.messageMetadata.threadKey.threadFbId.toString():undefined,k=i.initiator&&i.initiator.userFbId?i.initiator.userFbId.toString():undefined;return {action_type:c('MercuryActionType').UPDATE_RTC_CALL_DATA,thread_fbid:j,call_state:i.callState,server_info_data:i.serverInfoData,initiator_fbid:k};}f.exports={transform:h};}),null);
__d('MercurySyncThreadActionTransformer',['MercuryActionType','MessagingThreadAction'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_ARCHIVED_STATUS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,archived:i.action===c('MessagingThreadAction').ACTION_ARCHIVED};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsAddToGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j.userFbId);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadAdminsRemovedFromGroupTransformer',['MercuryActionType','MercuryIDs'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds.map(function(j){return c('MercuryIDs').getParticipantIDFromUserID(j);})};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalModeTransformer',['MercuryActionType','MessengerApprovalModeTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').APPROVAL_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,approval_mode:c('MessengerApprovalModeTypes')[i.mode]};}f.exports={transform:h};}),null);
__d('MercurySyncThreadApprovalQueueTransformer',['MercuryActionType','MercuryIDs','MessengerApprovalQueueTypes'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j=c('MercuryIDs').getParticipantIDFromUserID(i.recipientFbId);return {action_type:c('MercuryActionType').APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_id:i.action===c('MessengerApprovalQueueTypes').REMOVED?j:null,added_id:i.action===c('MessengerApprovalQueueTypes').REQUESTED?j:null};}f.exports={transform:h};}),null);
__d('MercurySyncThreadDeleteTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return i.threadKeys.map(function(j){return {action_type:c('MercuryActionType').DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId};});}f.exports={transform:h};}),null);
__d('MercurySyncThreadJoinableModeTransformer',['MercuryActionType','MessengerJoinableModeType'],(function a(b,c,d,e,f,g){'use strict';function h(i){return {action_type:c('MercuryActionType').JOINABLE_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,joinable_mode:{mode:c('MessengerJoinableModeType')[i.mode],link:i.link}};}f.exports={transform:h};}),null);
__d('MercurySyncThreadMuteSettingsTransformer',['MercuryActionType'],(function a(b,c,d,e,f,g){'use strict';function h(i){var j={action_type:c('MercuryActionType').CHANGE_MUTE_SETTINGS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,mute_until:parseInt(i.expireTime,10)};return j;}f.exports={transform:h};}),null);
__d('MercurySyncThreadNameTransformer',['MercuryActionType','MercuryLogMessageType','MercurySyncNewMessageTransformer'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=c('MercurySyncNewMessageTransformer').transform(i,j);k.action_type=c('MercuryActionType').LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c('MercuryLogMessageType').THREAD_NAME;return k;}f.exports={transform:h};}),null);
__d('MercurySyncDispatcher',['MercuryDelayedDispatcher','MercuryGlobalActionType','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercurySyncThreadAdminsAddToGroupTransformer','MercurySyncThreadAdminsRemovedFromGroupTransformer','MercurySyncAdminTextMessageTransformer','MercurySyncClientPayloadTransformer','MercurySyncDeliveryReceiptTransformer','MercurySyncMarkFolderSeenTransformer','MercurySyncMarkReadTransformer','MercurySyncMarkUnreadTransformer','MercurySyncMessageDeleteTransformer','MercurySyncNewMessageTransformer','MercurySyncReadReceiptTransformer','MercurySyncPagesManagerEventTransformer','MercurySyncParticipantLeftGroupThreadTransformer','MercurySyncParticipantsAddedToGroupThreadTransformer','MercurySyncRTCEventLogTransformer','MercurySyncThreadDeleteTransformer','MercurySyncThreadMuteSettingsTransformer','MercurySyncThreadNameTransformer','MercurySyncThreadActionTransformer','MercurySyncReplaceMessageTransformer','MercurySyncThreadJoinableModeTransformer','MercurySyncThreadApprovalModeTransformer','MercurySyncThreadApprovalQueueTransformer','MercurySyncRtcCallDataTransformer','MercurySyncDeltaTypes','MercurySingletonProvider','MontageActions'],(function a(b,c,d,e,f,g){'use strict';var h='FOLDER_MONTAGE';i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncDispatcher1=k;this.$MercurySyncDispatcher2=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDispatcher1);}i.prototype.process=function(k){var l=void 0,m=void 0;switch(k['class']){case c('MercurySyncDeltaTypes').NewMessage:l=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ReplaceMessage:l=c('MercurySyncReplaceMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').DeliveryReceipt:l=c('MercurySyncDeliveryReceiptTransformer').transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c('MercurySyncDeltaTypes').MarkRead:l=c('MercurySyncMarkReadTransformer').transform(k);var n=[],o=[];l.forEach(function(p){if(p.action_type===c('MercuryGlobalActionType').MARK_ALL_READ){n.push(p);}else o.push(p);});n.length&&this.$MercurySyncDispatcher5(n);o.length&&this.$MercurySyncDispatcher6(o);break;case c('MercurySyncDeltaTypes').MarkUnread:l=c('MercurySyncMarkUnreadTransformer').transform(k);this.$MercurySyncDispatcher6(l);break;case c('MercurySyncDeltaTypes').ParticipantLeftGroupThread:l=c('MercurySyncParticipantLeftGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ParticipantsAddedToGroupThread:l=c('MercurySyncParticipantsAddedToGroupThreadTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').RTCEventLog:l=c('MercurySyncRTCEventLogTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadName:l=c('MercurySyncThreadNameTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ReadReceipt:l=c('MercurySyncReadReceiptTransformer').transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c('MercurySyncDeltaTypes').AdminTextMessage:l=c('MercurySyncAdminTextMessageTransformer').transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MessageDelete:m=k.threadKey.threadFbId;if(m&&k.folder&&k.folder===h){c('MontageActions').requestUpdate(m);}else{l=c('MercurySyncMessageDeleteTransformer').transform(k);this.$MercurySyncDispatcher4(l);}break;case c('MercurySyncDeltaTypes').ThreadAction:l=c('MercurySyncThreadActionTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadDelete:l=c('MercurySyncThreadDeleteTransformer').transform(k);this.$MercurySyncDispatcher6(l);break;case c('MercurySyncDeltaTypes').AdminAddedToGroupThread:l=c('MercurySyncThreadAdminsAddToGroupTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').AdminRemovedFromGroupThread:l=c('MercurySyncThreadAdminsRemovedFromGroupTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ThreadMuteSettings:l=c('MercurySyncThreadMuteSettingsTransformer').transform(k);this.$MercurySyncDispatcher6([l]);break;case c('MercurySyncDeltaTypes').PagesManagerEvent:l=c('MercurySyncPagesManagerEventTransformer').transform(k);if(!l)return;this.$MercurySyncDispatcher6([l]);break;case c('MercurySyncDeltaTypes').JoinableMode:l=c('MercurySyncThreadJoinableModeTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ApprovalMode:l=c('MercurySyncThreadApprovalModeTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ApprovalQueue:l=c('MercurySyncThreadApprovalQueueTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').ClientPayload:l=c('MercurySyncClientPayloadTransformer').transform(k);if(!l)return;this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').GenieMessage:l=c('MercurySyncNewMessageTransformer').transform(this.$MercurySyncDispatcher1,k.deltaNewMessage);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MontageMessage:m=k.newMessage.messageMetadata.actorFbId;if(m)c('MontageActions').requestUpdate(m);break;case c('MercurySyncDeltaTypes').RtcCallData:l=c('MercurySyncRtcCallDataTransformer').transform(k);this.$MercurySyncDispatcher4(l);break;case c('MercurySyncDeltaTypes').MarkFolderSeen:l=c('MercurySyncMarkFolderSeenTransformer').transform(k);this.$MercurySyncDispatcher5(l);break;default:break;}};i.prototype.$MercurySyncDispatcher4=function(k){var l=k.other_user_fbid||k.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[k],payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE},l);};i.prototype.$MercurySyncDispatcher5=function(k){this.$MercurySyncDispatcher3.handleUpdate({global_actions:k,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};i.prototype.$MercurySyncDispatcher6=function(k){this.$MercurySyncDispatcher3.handleUpdate({actions:k,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncDataFetcherImpl',['Promise','AsyncRequest','MessagingConfig','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MessagingConfig').syncFetchRequestTimeoutMs;function i(k){return new (c('Promise'))(function(l,m){j(k,l,m,0);});}function j(k,l,m,n){if(n>c('MessagingConfig').syncFetchRetries){m();return;}var o=n===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,n);c('setTimeoutAcrossTransitions')(function(){var p=false,q=function r(){if(p)return;p=true;j(k,l,m,n+1);};new (c('AsyncRequest'))().setURI(k).setHandler(function(r){p=true;l(r);}).setErrorHandler(q).setTimeoutHandler(h,q).setAllowCrossPageTransition(true).send();},o);}f.exports={fetch:i};}),null);
__d('MercurySyncDataFetcher',['Promise','LogHistory','MessagingConfig','MercurySyncDataFetcherImpl','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('mercury_sync_data_fetcher');function i(){var l=0;for(var m=0;m<c('MessagingConfig').syncFetchRetries;m++){var n=m===0?0:c('MessagingConfig').syncFetchInitialTimeoutMs*Math.pow(c('MessagingConfig').syncFetchTimeoutMultiplier,m);l+=n+c('MessagingConfig').syncFetchRequestTimeoutMs;}return l;}var j=i();function k(l){return new (c('Promise'))(function(m,n){var o=function q(){h.error('fetch_timeout',JSON.stringify({timeout:j,uri:l.toString()}));n();},p=c('setTimeoutAcrossTransitions')(o,j);c('MercurySyncDataFetcherImpl').fetch(l).done(function(){clearTimeout(p);m.apply(undefined,arguments);},o);});}f.exports={fetch:k,getMaxTimeoutMs:i};}),null);
__d("XMercuryFetchMessageController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/fetch_message\/",{other_user_or_thread_fbid:{type:"Int",required:true},mid:{type:"String",required:true}});}),null);
__d("XMercuryInvalidateGlobalStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_global_state\/",{cachius_min_seq_id:{type:"Int"}});}),null);
__d("XMercuryInvalidateThreadStateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/invalidate_thread_state\/",{other_user_or_thread_fbid:{type:"Int",required:true},num_messages:{type:"Int",required:true}});}),null);
__d('MercurySyncDFFDataFetcher',['Promise','ActorURI','AsyncRequest','MercuryConfig','MercuryMessages','MercuryThreads','MercuryThreadIDMap','MercurySingletonProvider','MercurySyncDataFetcher','XMercuryFetchMessageController','XMercuryInvalidateGlobalStateController','XMercuryInvalidateThreadStateController'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c('MercuryMessages').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c('MercuryThreads').getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncDFFDataFetcher1);}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.fetchInvalidateGlobalState=function(j){var k=c('XMercuryInvalidateGlobalStateController').getURIBuilder();if(c('MercuryConfig').MessengerCachiusUseClientSeqIDWWW)k.setInt('cachius_min_seq_id',j);var l=k.getURI(),m=c('ActorURI').create(l,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(m);};h.prototype.fetchInvalidateThreadState=function(j,k){var l=11,m=3,n=j||k,o=this.__threadIDMap.getClientIDFromServerIDNow(n);if(!o)return c('Promise').resolve({getPayload:function s(){return {};}});var p=m+this.__messages.getCurrentlyLoadedMessages(o).length,q=c('XMercuryInvalidateThreadStateController').getURIBuilder().setInt('other_user_or_thread_fbid',n).setInt('num_messages',Math.max(p,l)).getURI(),r=c('ActorURI').create(q,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(r);};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=c('XMercuryFetchMessageController').getURIBuilder().setInt('other_user_or_thread_fbid',j||k).setString('mid',l).getURI(),n=c('ActorURI').create(m,this.$MercurySyncDFFDataFetcher1);return c('MercurySyncDataFetcher').fetch(n);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercurySyncForcedFetchHandler',['Promise','MercurySingletonProvider','MercurySyncDFFDataFetcher','MercuryMessages','MercuryThreadIDMap'],(function a(b,c,d,e,f,g){'use strict';function h(k){return {getPayload:function l(){return {sequence_id:k};}};}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c('MercuryMessages').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c('MercuryThreadIDMap').getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c('MercurySyncDFFDataFetcher').getForFBID(this.$MercurySyncForcedFetchHandler1);}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c('Promise').resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m);};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c('Promise').resolve(h(k));}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId);};i.prototype.processGlobalDFF=function(k){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalState(k);};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercurySyncDeltaHandler',['invariant','Arbiter','ChannelConstants','ChatReliabilityInstrumentation','LogHistory','MercuryConfig','MessagingConfig','MercuryDelayedDispatcher','MercuryPayloadSource','MercurySyncConstants','MercurySyncDeltaHolder','MercurySyncDeltaTypes','MercurySyncDispatcher','MercurySyncForcedFetchHandler','MercurySyncHolesTypedLogger','MercuryServerPayloadPreprocessor','MercurySyncTopicType','MercurySingletonProvider'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('LogHistory').getInstance('mercury_sync_delta_handler'),j=c('MessagingConfig').syncFetchRetries||0;k.getForFBID=function(m){return l.getForFBID(m);};k.get=function(){return l.get();};function k(m){this.$MercurySyncDeltaHandler1=m;this.$MercurySyncDeltaHandler2=c('MercurySyncDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler3=c('MercurySyncForcedFetchHandler').getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c('MercuryDelayedDispatcher').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c('MercurySyncDeltaHolder').getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler6=[];this.$MercurySyncDeltaHandler11=0;i.debug('constructor',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));c('Arbiter').subscribe('MercurySyncDeltaHandler/initSeqID',function(n,o){i.debug('initSeqID',JSON.stringify(o));var p=o&&o.seqID,q=o&&o.fbid;if(!q)return;if(q!==this.$MercurySyncDeltaHandler1)return;if(p){this.$MercurySyncDeltaHandler4.updateLastSeqID(p);}else this.$MercurySyncDeltaHandler4.updateLastSeqID(0);this.$MercurySyncDeltaHandler13();this.$MercurySyncDeltaHandler7=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('deltaflow'),function(r,s){if(!this.$MercurySyncDeltaHandler12)this.$MercurySyncDeltaHandler13();}.bind(this));}.bind(this));}k.prototype.$MercurySyncDeltaHandler13=function(){i.debug('setUpSubscriptionsToRealTimeUpdates',JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));this.$MercurySyncDeltaHandler9=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('delta'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta,q=n&&n.obj&&n.obj.iseq;if(!p||!q)return;this.$MercurySyncDeltaHandler14(q,c('MercurySyncTopicType').DELTA);this.$MercurySyncDeltaHandler15(q,p);this.$MercurySyncDeltaHandler4.push(q,p);this.$MercurySyncDeltaHandler16();}.bind(this));this.$MercurySyncDeltaHandler10=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('deltaflowreject'),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;if(this.$MercurySyncDeltaHandler12)this.$MercurySyncDeltaHandler17();}.bind(this));this.$MercurySyncDeltaHandler8=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(c('ChannelConstants').FAKE_DFF),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o&&o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta;if(!p)return;this.$MercurySyncDeltaHandler6.push(p);this.$MercurySyncDeltaHandler16();}.bind(this));this.$MercurySyncDeltaHandler12=true;};k.prototype.$MercurySyncDeltaHandler16=function(){if(this.$MercurySyncDeltaHandler5)return;if(this.$MercurySyncDeltaHandler6.length>0){var m=this.$MercurySyncDeltaHandler6.shift();this.$MercurySyncDeltaHandler18(this.$MercurySyncDeltaHandler4.getLastSeqID(),m);this.$MercurySyncDeltaHandler16();}var n=this.$MercurySyncDeltaHandler4.peek();if(!n)return;var o=n-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o===1){var p=this.$MercurySyncDeltaHandler4.pop();if(!p)return;var q=p.seqID,r=p.delta;this.$MercurySyncDeltaHandler18(q,r);this.$MercurySyncDeltaHandler16();}else if(o>1){this.$MercurySyncDeltaHandler19();}else{this.$MercurySyncDeltaHandler4.pop();this.$MercurySyncDeltaHandler16();}};k.prototype.$MercurySyncDeltaHandler18=function(m,n){this.$MercurySyncDeltaHandler4.updateLastSeqID(m);if(n['class']===c('MercurySyncDeltaTypes').ForcedFetch){i.debug('DFF',JSON.stringify(n));if(n.threadKey!==undefined&&n.messageId===undefined){this.$MercurySyncDeltaHandler20(m,n);}else if(n.threadKey!==undefined&&n.messageId!==undefined){this.$MercurySyncDeltaHandler21(m,n);}else{c('ChatReliabilityInstrumentation').logDFF_DELTA_INIT(JSON.stringify(n));this.$MercurySyncDeltaHandler22(m);}}else this.$MercurySyncDeltaHandler2.process(n);};k.prototype.$MercurySyncDeltaHandler19=function(){var m=JSON.stringify({$MercurySyncDeltaHandler23:this.$MercurySyncDeltaHandler4.getLastSeqID(),nextSeqID:this.$MercurySyncDeltaHandler4.peek()});i.warn('hole',m);var n=this.$MercurySyncDeltaHandler4.peek();!!n||h(0);var o=n-1;c('ChatReliabilityInstrumentation').logDFF_HOLE_INIT(m);this.$MercurySyncDeltaHandler22(o);};k.prototype.$MercurySyncDeltaHandler24=function(m,n,o,p){!this.$MercurySyncDeltaHandler5||h(0);this.$MercurySyncDeltaHandler5=true;i.debug('_scheduleDataFetch:start',JSON.stringify({seqID:m}));n().done(function(q){i.debug('_scheduleDataFetch:success',JSON.stringify({seqID:m}));o(m,q);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler16();}.bind(this),function(){i.error('_scheduleDataFetch:failure',JSON.stringify({seqID:m}));p(m);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler16();}.bind(this));};k.prototype.$MercurySyncDeltaHandler22=function(m){this.$MercurySyncDeltaHandler24(undefined,function(){return this.$MercurySyncDeltaHandler3.processGlobalDFF(m);}.bind(this),function(n,o){var p=o.getPayload();this.__payloadPreprocessor.handleUpdate(p);if(p.sequence_id){i.debug('_initiateGlobalDFF:success',JSON.stringify({seqID:p.sequence_id}));this.$MercurySyncDeltaHandler4.updateLastSeqID(p.sequence_id);}this.$MercurySyncDeltaHandler11=0;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RECOVER);}.bind(this),function(){i.error('_initiateGlobalDFF:failure','');if(this.$MercurySyncDeltaHandler11>=j){if(this.$MercurySyncDeltaHandler12)this.$MercurySyncDeltaHandler17();if(c('MercuryConfig').chatDFFUpdateSeqID)this.$MercurySyncDeltaHandler4.updateLastSeqID(m);}else{this.$MercurySyncDeltaHandler11++;c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE_RETRY);i.debug('_initiateGlobalDFF:retry','');this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler22(m);}}.bind(this));};k.prototype.$MercurySyncDeltaHandler20=function(m,n){this.$MercurySyncDeltaHandler24(m,function(){return this.$MercurySyncDeltaHandler3.processThreadDFF(m,n.threadKey,n.isLazy);}.bind(this),function(o,p){this.__payloadPreprocessor.handleUpdate(p.getPayload());this.$MercurySyncDeltaHandler4.updateLastSeqID(o);}.bind(this),function(){i.error('_initiateThreadDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.threadKey;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler21=function(m,n){this.$MercurySyncDeltaHandler24(m,function(){return this.$MercurySyncDeltaHandler3.processMessageDFF(m,n.threadKey,n.messageId,n.isLazy);}.bind(this),function(o,p){var q=p.getPayload(),r=q.other_user_fbid?q.other_user_fbid:q.thread_fbid,s=[babelHelpers['extends']({},q)],t=c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:s,payload_source:t},r);this.$MercurySyncDeltaHandler4.updateLastSeqID(o);}.bind(this),function(){i.error('_initiateMessageDFF:failure',JSON.stringify(n));var o=babelHelpers['extends']({},n);delete o.messageId;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o);}.bind(this));};k.prototype.$MercurySyncDeltaHandler14=function(m,n){var o=m-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o!==1&&o!==0){if(!c('MercuryConfig').WWWSyncHolesLogging)return;new (c('MercurySyncHolesTypedLogger'))().setSeqID(m).setDifference(o).setTopicType(n).log();}};k.prototype.$MercurySyncDeltaHandler15=function(m,n){switch(n['class']){case c('MercurySyncDeltaTypes').NewMessage:i.debug('message_delta',JSON.stringify({seqID:m,threadKey:n.messageMetadata.threadKey,messageId:n.messageMetadata.messageId}));break;case c('MercurySyncDeltaTypes').ReadReceipt:i.debug('read_receipt_delta',JSON.stringify({seqID:m,threadKey:n.threadKey,actionTimestampMs:n.actionTimestampMs,watermarkTimestampMs:n.watermarkTimestampMs}));break;case c('MercurySyncDeltaTypes').DeliveryReceipt:i.debug('delivery_receipt_delta',JSON.stringify({seqID:m,deliveredWatermarkTimestampMs:n.deliveredWatermarkTimestampMs,messageIds:n.messageIds}));break;}};k.prototype.$MercurySyncDeltaHandler17=function(){this.$MercurySyncDeltaHandler12=false;c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler9);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler8);c('Arbiter').unsubscribe(this.$MercurySyncDeltaHandler10);c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_INVALID_STATE);};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercurySyncEnvironment',['Arbiter','ChannelInitialData','CurrentUser','MercurySyncDeltaHandler'],(function a(b,c,d,e,f,g){'use strict';function h(){if(!c('ChannelInitialData').channelConfig)return;c('MercurySyncDeltaHandler').get();c('Arbiter').inform('MercurySyncDeltaHandler/initSeqID',{fbid:c('CurrentUser').getAccountID(),seqID:c('ChannelInitialData').channelConfig.sequenceId});}f.exports={setUp:h};}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;(n.global_actions||[]).forEach(function(x){if(x.action_type===c('MercuryGlobalActionType').MARK_ALL_SEEN)this.$MercuryUnseenState15(x.timestamp,[]);}.bind(p));if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y],aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){if(!c('MercuryThreadInfo').isMuted(fa)&&!(fa&&fa.last_read_timestamp>=z.timestamp))t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('OmniMActions',['MessengerFluxReduceDispatcher','keyMirror','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({BAR_DISMISSED:null,BAR_DISPLAYED:null,BAR_DISAPPEARED:null,BAR_TIMED_OUT:null,MERCURY_DISPATCHED:null,FETCH_SUGGESTIONS:null,PREFS_UPDATED:null,SUGGESTION_CLICKED:null,SUGGESTION_COMPLETED:null,SUGGESTION_DISMISSED:null,SUGGESTION_DISPLAYED:null,SUGGESTION_DISAPPEARED:null,SUGGESTION_MODE_SET:null,SUGGESTIONS_DISMISSED_FOR_THREAD:null}),i='omnim',j={Types:h,Namespace:i,mercuryDispatched:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.MERCURY_DISPATCHED,namespace:i,mercuryType:l,data:m});},messageFetched:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.FETCH_SUGGESTIONS,namespace:i,threadID:l,message:m});});},suggestionClicked:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_CLICKED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionCompleted:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_COMPLETED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionDismissed:function k(l,m,n,o){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISMISSED,namespace:i,threadID:l,option:m,source:n,position:o});},suggestionsDismissedForThread:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTIONS_DISMISSED_FOR_THREAD,namespace:i,threadID:l});},suggestionDisplayed:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISPLAYED,namespace:i,option:l,position:m});});},suggestionDisappeared:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_DISAPPEARED,namespace:i,option:l,position:m});});},prefsUpdated:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREFS_UPDATED,namespace:i,prefs:l});},suggestionModeSet:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.SUGGESTION_MODE_SET,namespace:i,mode:l});},barDismissed:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISMISSED,namespace:i,options:l});},barDisplayed:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISPLAYED,namespace:i,options:l});});},barDisappeared:function k(l){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_DISAPPEARED,namespace:i,options:l});});},barTimedOut:function k(l,m){c('setImmediate')(function(){c('MessengerFluxReduceDispatcher').dispatch({type:h.BAR_TIMED_OUT,namespace:i,options:m,threadID:l});});}};f.exports=j;}),null);
__d('OmniMHelpers',['immutable','MercuryConfig'],(function a(b,c,d,e,f,g){function h(i){if(!c('MercuryConfig').OmniMEditConfidenceThreshold)return 0;if(i&&i.has('suggestion_mode')){var j=i.get('suggestion_mode');return j!==null&&j!==undefined?j:1;}return 3;}f.exports={suggestionMode:h};}),null);
__d('MNOmniMConstants',['keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({OMNIM:null,QUICKREPLIES:null});h.SUGGESTION_MODES=['conservative','balanced','aggressive','muted'];f.exports=h;}),null);
__d('OmniMLogHelpers',['OmniMEventTypedLogger','MNOmniMConstants','OmniMLoggerEvents','CurrentUser'],(function a(b,c,d,e,f,g){function h(s){return c('MNOmniMConstants').SUGGESTION_MODES[s];}function i(s,t,u,v){new (c('OmniMEventTypedLogger'))().setEventName(s).setPosition(u+'').setMessageID(t.messageID).setPigeonID(t.suggestionID).setSuggestionMode(h(v)).setContextUserID(c('CurrentUser').getID()).setConfidence(Math.round(t.confidence*10000)).log();}function j(s,t,u){new (c('OmniMEventTypedLogger'))().setEventName(s).setSuggestionMode(h(u)).setContextUserID(c('CurrentUser').getID()).setSuggestionIds(t.map(function(v){return v.suggestionID;})).log();}function k(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISPLAYED,s,t,u);}function l(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISAPPEARED,s,t,u);}function m(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_DISMISSED,s,t,u);}function n(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_CLICKED,s,t,u);}function o(s,t,u){i(c('OmniMLoggerEvents').SUGGESTION_COMPLETED,s,t,u);}function p(s,t){j(c('OmniMLoggerEvents').BAR_DISAPPEARED,s,t);}function q(s,t){j(c('OmniMLoggerEvents').BAR_DISMISSED,s,t);}function r(s,t){j(c('OmniMLoggerEvents').BAR_DISPLAYED,s,t);}f.exports={barDisappeared:p,barDisplayed:r,barDismissed:q,suggestionDisplayed:k,suggestionDisappeared:l,suggestionDismissed:m,suggestionClicked:n,suggestionCompleted:o};}),null);
__d("XMessagingOmniMSetPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_omnim_prefs\/",{});}),null);
__d('OmniMReducer',['AsyncRequest','immutable','MercuryActionType','MercuryConfig','MercuryIDs','MercuryPayloadSource','MNOmniMConstants','OmniMActions','OmniMActionType','OmniMDirectiveType','OmniMLogHelpers','P2PGKValues','XMessagingOmniMSetPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i=c('OmniMActions').Types,j=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').REPLACE_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),k=c('immutable').Set([c('MercuryActionType').SEND_MESSAGE,c('MercuryActionType').USER_GENERATED_MESSAGE]),l=2;function m(oa,pa){switch(oa.content_type){case 'text':return true;case 'location':if(pa===c('MNOmniMConstants').OMNIM)return c('MercuryConfig').OmniMLocationSuggestion;return c('MercuryConfig').MessengerLocationQuickReply;case 'sticker':return c('MercuryConfig').MessengerStickerQuickReply;case 'ride_service':return c('MercuryConfig').MessengerRideServiceQuickReply;case 'p2p_payment':return c('P2PGKValues').P2PVisible&&c('MercuryConfig').MessengerP2PPaymentQuickReply;default:return false;}}function n(oa){return Array.isArray(oa);}function o(oa){if(!oa)return {};var pa=JSON.parse(oa)||{},qa=n(pa.quick_replies)?pa.quick_replies:[],ra=pa.m_directives;return {quickReplies:qa,directives:ra};}function p(oa){var pa=oa.other_user_fbid,qa=oa.thread_fbid;return pa?c('MercuryIDs').getThreadIDFromUserID(pa):c('MercuryIDs').getThreadIDFromThreadFBID(qa);}var q=c('immutable').Map((h={},h[c('OmniMActionType').CREATE_EVENT]='create_event',h[c('OmniMActionType').LOCATION]='location',h[c('OmniMActionType').PAYMENT]='p2p_payment',h[c('OmniMActionType').POLL]='poll',h[c('OmniMActionType').STICKER]='sticker',h[c('OmniMActionType').TEXT]='text',h[c('OmniMActionType').TRANSPORTATION]='ride_service',h[c('OmniMActionType').ORDER_FOOD]='order_food',h[c('OmniMActionType').MAKE_RESERVATION]='make_reservation',h[c('OmniMActionType').SCHEDULE_CALL]='schedule_call',h[c('OmniMActionType').LIVE_LOCATION]='live_location',h));function r(oa){var pa=oa.confidence,qa=oa.id,ra=oa.label,sa=oa.type,ta=oa.data,ua=oa.icon,va=oa.message_id,wa=oa.thread_key;return {content_type:q.get(sa+''),data:ta,image_url:ua,title:ra,confidence:pa,messageID:va,suggestionID:qa,threadID:p(wa),messageDepth:1};}function s(oa,pa){var qa=o(pa),ra=(qa.quickReplies||[]).filter(function(ta){return m(ta,c('MNOmniMConstants').QUICKREPLIES);}),sa=(qa.directives||[]).filter(function(ta){return ta.type===c('OmniMDirectiveType').ADD_ACTIONS;}).map(function(ta){return ta.data.actions;}).reduce(function(ta,ua){return ta.concat(ua);},[]).map(r).filter(function(ta){return m(ta,c('MNOmniMConstants').OMNIM);}).reduce(function(ta,ua){var va=ua.threadID;return ta.updateIn([va,'agentSuggestions'],[],function(wa){return wa.concat([ua]);});},c('immutable').Map({}));return sa.setIn([oa,'quickReplies'],ra);}function t(oa){var pa=oa.content_type;Object.keys(oa.data||{}).sort().map(function(qa){pa+=''+qa+oa.data[qa];});return pa;}function u(oa){var pa=c('immutable').Set(),qa=[];for(var ra=oa.length-1;ra>=0;ra--){var sa=oa[ra],ta=t(sa);if(!pa.has(ta)){pa=pa.add(ta);qa.unshift(sa);}}return qa;}function v(oa){var pa=0;return oa.filter(function(qa){if(qa.content_type==='sticker'){if(pa>=l)return false;pa+=1;}return true;});}function w(oa,pa,qa,ra){var sa=oa.getIn(['threadMetadata',pa,'timestamp']);if(sa&&sa>ra)return oa;var ta=qa.agentSuggestions,ua=qa.quickReplies,va=(oa.getIn(['suggestionsByThread',pa])||{}).agentSuggestions||[],wa=ta||[];if(va.length)wa=v(wa);var xa=u(wa.concat(va));return oa.setIn(['threadMetadata',pa,'timestamp'],ra).setIn(['suggestionsByThread',pa],{agentSuggestions:xa,quickReplies:ua});}function x(oa,pa,qa,ra,sa){var ta=s(pa,ra);return ta.reduce(function(ua,va,wa){return w(ua,wa,va.toJS(),sa);},oa);}function y(oa){if(!oa)return null;var pa=oa.agentSuggestions,qa=(pa||[]).reduce(function(ra,sa){if(sa.messageDepth>=c('MercuryConfig').OmniMMessagesToLive)return ra;return ra.concat([babelHelpers['extends']({},sa,{messageDepth:sa.messageDepth+1})]);},[]);return babelHelpers['extends']({},oa,{agentSuggestions:qa});}function z(oa,pa){var qa=pa.thread_id,ra=pa.message_id,sa=pa.platform_xmd,ta=pa.timestamp;if(k.has(pa.action_type))oa=oa.updateIn(['suggestionsByThread',qa],y);return x(oa,qa,ra,sa,ta);}function aa(oa,pa){if(pa.type!==i.MERCURY_DISPATCHED)return oa;var qa=pa.data;switch(pa.mercuryType){case 'update-messages':if(qa.payload_source!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)return oa;return qa.actions.filter(function(ra){return j.has(ra.action_type);}).reduce(z,oa);case 'invalidate-thread-state':return oa.deleteIn(['suggestionsByThread',qa.threadID]).deleteIn(['threadMetadata',qa.threadID]);case 'invalidate-global-state':return oa.set('suggestionsByThread',c('immutable').Map()).set('threadMetadata',c('immutable').Map());}return oa;}function ba(oa,pa){if(pa.type!==i.FETCH_SUGGESTIONS)return oa;var qa=pa.message,ra=pa.threadID;return x(oa,ra,qa.message_id,qa.platform_xmd,qa.timestamp);}function ca(oa){return oa.getIn(['prefs','suggestion_mode'],0);}function da(oa,pa){if(pa.type!==i.SUGGESTION_CLICKED)return oa;var qa=pa.option,ra=pa.position,sa=pa.source;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionClicked(qa,ra,ca(oa));return oa;}function ea(oa,pa){if(pa.type!==i.SUGGESTION_COMPLETED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.position,ta=pa.source;if(ta===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionCompleted(ra,sa,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function fa(oa,pa){if(pa.type!==i.SUGGESTION_DISMISSED)return oa;var qa=pa.threadID,ra=pa.option,sa=pa.source,ta=pa.position;if(sa===c('MNOmniMConstants').OMNIM)c('OmniMLogHelpers').suggestionDismissed(ra,ta,ca(oa));var ua=oa.getIn(['suggestionsByThread',qa]);if(!ua||!ua.agentSuggestions)return oa;var va=ua.agentSuggestions.map(function(wa){if(wa.suggestionID===ra.suggestionID)return babelHelpers['extends']({},wa,{dismissed:true});return wa;});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ua,{agentSuggestions:va}));}function ga(oa,pa){if(pa.type!==i.SUGGESTIONS_DISMISSED_FOR_THREAD)return oa;var qa=pa.threadID,ra=oa.getIn(['suggestionsByThread',qa]);if(!ra||!ra.agentSuggestions)return oa;c('OmniMLogHelpers').barDismissed(ra.agentSuggestions,ca(oa));var sa=ra.agentSuggestions.map(function(ta,ua){if(ta.dismissed)return ta;c('OmniMLogHelpers').suggestionDismissed(ta,ua,ca(oa));return babelHelpers['extends']({},ta,{dismissed:true});});return oa.setIn(['suggestionsByThread',qa],babelHelpers['extends']({},ra,{agentSuggestions:sa}));}function ha(oa,pa){if(pa.type!==i.PREFS_UPDATED)return oa;var qa=pa.prefs;return oa.updateIn(['prefs'],function(ra){return ra.merge(c('immutable').fromJS(qa));});}function ia(oa,pa){if(pa.type!==i.SUGGESTION_MODE_SET)return oa;var qa=pa.mode,ra=c('XMessagingOmniMSetPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(ra).setMethod('POST').setData({suggestion_mode:qa}).send();return oa.setIn(['prefs','suggestion_mode'],qa);}function ja(oa,pa){if(pa.type!==i.SUGGESTION_DISPLAYED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisplayed(qa,ra,ca(oa));return oa;}function ka(oa,pa){if(pa.type!==i.SUGGESTION_DISAPPEARED)return oa;var qa=pa.option,ra=pa.position;if(!qa.dismissed)c('OmniMLogHelpers').suggestionDisappeared(qa,ra,ca(oa));return oa;}function la(oa,pa){if(pa.type!==i.BAR_TIMED_OUT)return oa;var qa=pa.threadID,ra=pa.options;c('OmniMLogHelpers').barDisappeared(ra,ca(oa));return oa.deleteIn(['suggestionsByThread',qa]);}function ma(oa,pa){if(pa.type!==i.BAR_DISAPPEARED)return oa;c('OmniMLogHelpers').barDisappeared(pa.options,ca(oa));return oa;}function na(oa,pa){if(pa.type!==i.BAR_DISPLAYED)return oa;c('OmniMLogHelpers').barDisplayed(pa.options,ca(oa));return oa;}f.exports={barDisappeared:ma,barDisplayed:na,barTimedOut:la,mercuryDispatch:aa,messageFetched:ba,prefsUpdated:ha,suggestionClicked:da,suggestionCompleted:ea,suggestionDisappeared:ka,suggestionDismissed:fa,suggestionDisplayed:ja,suggestionModeSet:ia,suggestionsDismissedForThread:ga};}),null);
__d('OmniMState',['immutable'],(function a(b,c,d,e,f,g){'use strict';var h,i,j={suggestionsByThread:c('immutable').Map(),threadMetadata:c('immutable').Map(),prefs:c('immutable').Map()};h=babelHelpers.inherits(k,c('immutable').Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments);}f.exports=k;}),null);
__d("XMessagingOmniMPrefController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/get_omnim_prefs\/",{});}),null);
__d('OmniMStore',['AsyncRequest','FluxReduceStore','immutable','MercuryConfig','MercuryDispatcher','MercuryMessages','MessengerFluxReduceDispatcher','OmniMHelpers','OmniMReducer','OmniMState','OmniMActions','XMessagingOmniMPrefController'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=5,k=[].concat(Object.values(c('OmniMReducer')));h=babelHelpers.inherits(l,c('FluxReduceStore'));i=h&&h.prototype;l.prototype.getInitialState=function(){return new (c('OmniMState'))();};l.prototype.reduce=function(m,n){if(n.namespace!==c('OmniMActions').Namespace)return m;return k.reduce(function(o,p){return p(o,n);},m);};l.prototype.$OmniMStore1=function(m){c('MercuryMessages').get().getThreadMessagesRange(m,0,1,function(n){if(n&&n.length){var o=n[0];c('OmniMActions').messageFetched(m,o);}});};l.prototype.$OmniMStore2=function(){var m=this.getState().get('prefs'),n=c('OmniMHelpers').suggestionMode(m),o=c('MercuryConfig').OmniMConfidenceThresholds[n];return o||.9;};l.prototype.$OmniMStore3=function(m){var n=this.$OmniMStore2();return (m||[]).filter(function(o){return o.confidence&&o.confidence>n;});};l.prototype.suggestionsForThread=function(m){var n=this.getState();if(!n.getIn(['threadMetadata',m]))this.$OmniMStore1(m);var o=n.getIn(['suggestionsByThread',m],{}),p=this.$OmniMStore3(o.agentSuggestions).slice(0,j);return babelHelpers['extends']({},o,{agentSuggestions:p});};l.prototype.prefs=function(){return this.getState().get('prefs');};l.prototype.$OmniMStore4=function(){var m=c('MercuryDispatcher').get();m.subscribe('update-messages',function(n,o){c('OmniMActions').mercuryDispatched(n,o);});m.subscribe('invalidate-thread-state',function(n,o){c('OmniMActions').mercuryDispatched(n,{threadID:o});});m.subscribe('invalidate-global-state',function(n){return c('OmniMActions').mercuryDispatched(n);});};l.prototype.$OmniMStore5=function(){if(c('MercuryConfig').OmniMEditConfidenceThreshold){var m=c('XMessagingOmniMPrefController').getURIBuilder().getURI();new (c('AsyncRequest'))(m).setAllowCrossPageTransition(true).setReadOnly(true).setMethod('POST').setHandler(function(n){return c('OmniMActions').prefsUpdated(n.payload);}).send();}};l.prototype.setUp=function(){this.$OmniMStore4();this.$OmniMStore5();};function l(){h.apply(this,arguments);}f.exports=new l(c('MessengerFluxReduceDispatcher'));}),null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','Map','P2PDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=void 0,k=void 0;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(){i.constructor.call(this);k=new (c('Map'))();j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}l.prototype.onEventDispatched=function(m){var n=m.data,o=m.type;switch(o){case c('P2PActionConstants').CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(n);this.emit('change');break;case c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(n);this.emit('change');break;}};l.prototype.getStateByThreadID=function(m){return k.get(m);};l.prototype.handleChatSendViewOpened=function(m){k.set(m.threadID,{amount:m.amount,groupSendRecipientUserIDs:m.groupSendRecipientUserIDs,groupSendReceiptDetails:m.groupSendReceiptDetails,groupThreadFBID:m.groupThreadFBID,onCompletion:m.onCompletion,openRequestTab:m.openRequestTab,memoText:m.memoText,platformData:m.platformData,referrer:m.referrer,paymentRequestID:m.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:m.sendMoneyNUXDismissed,useModal:m.useModal});};l.prototype.handleChatSendViewClosed=function(m){k.set(m.threadID,{amount:'',groupSendRecipientUserIDs:[],groupSendReceiptDetails:null,groupThreadFBID:'',onCompletion:null,openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false});};l.prototype.isAnyChatSendViewOpen=function(){for(var m=k.values(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;if(q.sendMoneyDialogShown)return true;}return false;};f.exports=new l();}),null);
__d('FantaTabsAppBase',['ChatAppActions','ChatAppStore','ChatPerfInstrumentation','CSS','JSLogger'],(function a(b,c,d,e,f,g){'use strict';h.prototype.init=function(i,j,k){if(this.isInitialized()){c('JSLogger').create('chat_app').error('repeated_init');return;}this.$FantaTabsAppBase1=i;this.tabsElem=j;var l=c('ChatAppStore').addListener(function(){var m=c('ChatAppStore').getPreviousState(),n=c('ChatAppStore').getState();if(m.initialDisplayDone===false&&n.initialDisplayDone===true){c('ChatPerfInstrumentation').logDisplayDone();l.remove();}});c('ChatPerfInstrumentation').init();this.$FantaTabsAppBase2(k);this.initializeFantaData();this.initializeFantaUI();this.$FantaTabsAppBase3();c('ChatAppActions').tti();c('ChatPerfInstrumentation').logTTI();};h.prototype.isInitialized=function(){return !!c('ChatAppStore').getState().isInitialized;};h.prototype.isHidden=function(){var i=c('ChatAppStore').getState();return !!(!i.isInitialized||i.isHidden);};h.prototype.hide=function(){if(this.isHidden())return;c('CSS').hide(this.$FantaTabsAppBase1);c('ChatAppActions').hide();};h.prototype.unhide=function(){var i=c('ChatAppStore').getState();if(i.isInitialized){if(i.isHidden){c('CSS').show(this.$FantaTabsAppBase1);e(['Dock'],function(j){j.resizeAllFlyouts();});c('ChatAppActions').unhide();}}else if(!i.isLoaded){e(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});c('ChatAppActions').load();}};h.prototype.initializeFantaData=function(){};h.prototype.initializeFantaUI=function(){};h.prototype.$FantaTabsAppBase2=function(i){e(['mercuryBlockedParticipantsRe','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryServerPayloadPreprocessor','MercuryThreads','MercuryUnreadState','MercuryUnseenState','MercurySyncEnvironment','P2PSendMoneyDialogStore','OmniMStore'],function(j,k,l,m,n,o,p,q,r,s,t,u){j.get();k.get();l.get();m.get();n;p.get();r.get();q.get();s.setUp();u.setUp();c('ChatPerfInstrumentation').logInitStores();o.get().handleUpdate(i);});};h.prototype.$FantaTabsAppBase3=function(){e(['HotLikeSound','ChatOptions'],function(i,j){i.setCheckSoundEnabledFunc(function(){return j.getSetting('sound');});c('ChatPerfInstrumentation').logInitSound();});};function h(){}f.exports=h;}),null);