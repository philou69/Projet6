if (self.CavalryLogger) { CavalryLogger.start_js(["h0k9q"]); }

__d('ChangeChatTabColorDialog',['ix','cssVar','cx','fbt','Grid.react','Image.react','MercuryThreads','MessagingThreadCustomizationConfig','MessengerCustomThreadColorButton.react','MessagingThreadCustomizationSource','React','SimpleXUIDialog','MercuryThreadActions','XUIDialogCancelButton.react','convertMIGColorToFIGColor','fbglyph'],(function a(b,c,d,e,f,g,h,i,j,k){'use strict';var l=c('Grid.react').GridItem,m=c('MercuryThreads').get(),n=c('MercuryThreadActions').get(),o='Unknown Color',p={show:function r(s,t){var u=m.getThreadMetaNow(s),v=u&&u.custom_color?u.custom_color:"#0084ff",w=355,x=null,y=["#0084ff"].concat(c('MessagingThreadCustomizationConfig').colorChoices),z=c('MessagingThreadCustomizationConfig').colorNames,aa=y.map(function(ea){return c('React').createElement(l,{key:ea,className:"_gs0"},c('React').createElement('div',null,ea.toLowerCase()==v.toLowerCase()?c('React').createElement(c('Image.react'),{className:"_gs2",src:h("114570")}):null,c('React').createElement(c('MessengerCustomThreadColorButton.react'),{colorChoice:c('convertMIGColorToFIGColor')(ea)||ea,colorName:z[ea]||o,isSelected:ea===v,onChoose:function fa(){q(x,s,ea,v);}})));}),ba=k._("Pick a color for this conversation"),ca=c('React').createElement('div',{className:"_gs3 _430z"},c('React').createElement('div',{className:"_28he"},k._("Everyone in this conversation will see this.")),c('React').createElement(c('Grid.react'),{cols:5,className:"_gs4"},aa)),da=c('React').createElement('div',null,c('React').createElement(c('XUIDialogCancelButton.react'),null));x=c('SimpleXUIDialog').showEx(ca,ba,da,null,{width:w,causalElement:t});}};function q(r,s,t,u){if(t!=u){n.changeThreadColor(s,t,c('MessagingThreadCustomizationSource').SETTINGS);if(r)r.hide();}}f.exports=p;}),null);
__d('EditChatTabNicknameDialog',['cx','fbt','DialogX','ImmutableObject','MercuryIDs','MessengerDialogHeader.react','MessengerTextWithEmojiInput.react','MessagingThreadCustomizationConfig','MessagingThreadCustomizationSource','MessengerDialogCancelButton.react','MessengerDialogButton.react','MessengerDialogFooter.react','MercuryThreadActions','React','SimpleXUIDialog'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('MercuryThreadActions').get(),k=400,l={show:function m(n,o,p,q,r){var s=null,t=c('MercuryIDs').getUserIDFromParticipantID(o.id),u=t===q?i._("Edit Your Nickname"):i._("Edit Nickname for {personName}",[i.param('personName',o.name)]),v=c('React').createElement('div',{className:"_2c1u"},c('React').createElement(c('MessengerDialogHeader.react'),null,u)),w=c('React').createElement('div',{className:"_2c1u"},c('React').createElement('div',{className:"_21g-"},c('React').createElement('div',{className:"_-bo"},i._("Everyone in this conversation will see this.")),c('React').createElement(c('MessengerTextWithEmojiInput.react'),{className:"_2c1v",initialValue:p,onReturn:function(){return this._handleSave(s,n,o,p);}.bind(this),maxLength:c('MessagingThreadCustomizationConfig').maxNicknameLength,placeholder:o.name}))),x=c('React').createElement('div',{className:"_2c1u"},c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),null),c('React').createElement(c('MessengerDialogButton.react'),{label:i._("Save"),onClick:function(){return this._handleSave(s,n,o,p);}.bind(this),type:'primary'})));s=c('SimpleXUIDialog').showEx(w,v,x,null,{NICKNAME_DIALOG_WIDTH:k,causalElement:r});},_handleSave:function m(n,o,p,q){if(!n)return;var r=n._reactContainer.querySelector('[data-text]').textContent;if(r!==q)j.changeThreadNicknames(o,c('MercuryIDs').getUserIDFromParticipantID(p.id),r,c('MessagingThreadCustomizationSource').SETTINGS);n.hide();}};f.exports=l;}),null);
__d('EditChatTabNicknamesDialog',['cx','fbt','EditChatTabNicknameDialog','immutable','ImmutableObject','MercuryThreads','MercuryIDs','MessengerAdminGroupUtils','MercuryParticipants','MessengerContactList.react','MessengerDialogHeader.react','MessengerDialogTitle.react','MessengerScrollableArea.react','React','SimpleXUIDialog','XUIDialogCancelButton.react','idx'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('MercuryThreads').get(),k=200,l=350,m={show:function n(o,p,q){var r=null,s=j.getThreadMetaNow(o),t=c('immutable').Map().withMutations(function(z){if(!s)return;s.participants&&s.participants.forEach(function(aa){z.set(aa,c('MercuryParticipants').getOrFetch(aa));});s.is_subscribed&&z.set(c('MercuryIDs').getParticipantIDFromUserID(p),c('MercuryParticipants').getOrFetch(c('MercuryIDs').getParticipantIDFromUserID(p)));}),u=c('MessengerAdminGroupUtils').isJoinableThread(s),v=t.filter(function(z){if(!z)return false;var aa=c('MercuryIDs').getUserIDFromParticipantID(z.id);return u&&aa===p||!u;}).toArray(),w=c('React').createElement('div',{className:"_4h9n"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,i._("Edit Nicknames")))),x=c('React').createElement('div',{className:"_4h9n"},c('React').createElement('div',{className:"_4h9o"},c('React').createElement(c('MessengerScrollableArea.react'),{height:'100%'},c('React').createElement(c('MessengerContactList.react'),{contactAdapter:function(z){return this._fromMercuryParticipant(z,s);}.bind(this),disableRole:true,listSections:c('immutable').OrderedMap([[null,v]]),onSelect:function(z){r&&r.hide();setTimeout(function(){return this._handleContactSelect(z,s,p);}.bind(this),k);}.bind(this),rowClassName:"_44kr",viewer:p,thread:s})))),y=c('React').createElement('div',null,c('React').createElement(c('XUIDialogCancelButton.react'),null));r=c('SimpleXUIDialog').showEx(x,w,y,null,{NICKNAME_DIALOG_WIDTH:l,causalElement:q});},_handleContactSelect:function n(o,p,q){var r,s=c('MercuryIDs').getUserIDFromParticipantID(o.id),t=((r=p)!=null?(r=r.custom_nickname)!=null?r[s]:r:r)||'',u=p.thread_id;c('EditChatTabNicknameDialog').show(u,o,t,q,this.linkRef);},_fromMercuryParticipant:function n(o,p){var q=c('MercuryIDs').getUserIDFromParticipantID(o.id),r=o.name,s='';if(p.custom_nickname&&p.custom_nickname[q]){r=p.custom_nickname[q];s=o.name;}return new (c('ImmutableObject'))({alias:o.alias,uid:o.id,photo:o.image_src,title:r,subtitle:s,type:o.type,isMessengerUser:o.is_messenger_user,href:o.href});}};f.exports=m;}),null);
__d('WebMessengerDeleteThreadDialog',['fbt','React','SimpleXUIDialog','MercuryThreadActions','XUIDialogButton.react','XUIDialogCancelButton.react'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadActions').get(),j={show:function k(l,m,n){var o=h._("Delete This Entire Conversation?"),p=h._("Once you delete your copy of this conversation, it cannot be undone."),q=c('React').createElement('div',null,c('React').createElement(c('XUIDialogCancelButton.react'),null),c('React').createElement(c('XUIDialogButton.react'),{action:'cancel',label:h._("Delete Conversation"),use:'confirm',onClick:function r(){i['delete'](l);m&&m();}}));c('SimpleXUIDialog').showEx(p,o,q,null,{causalElement:n});}};f.exports=j;}),null);
__d('ChatFileUploader.react',['cx','fbt','ChatFileUploaderMixin','InlineBlock.react','MercuryConfig','React','ReactDOM','createCancelableFunction'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('React').createClass({displayName:'ChatFileUploader',mixins:[c('ChatFileUploaderMixin')],getDefaultProps:function k(){return {uploaderIsFromHigherLevel:true};},shouldComponentUpdate:function k(){return false;},componentDidMount:function k(){this._uploaderCallback=c('createCancelableFunction')(this.setUpSubscriptionsHandler);this.props.initFileUploaderFn(c('ReactDOM').findDOMNode(this.refs.form),c('ReactDOM').findDOMNode(this.refs.input),c('ReactDOM').findDOMNode(this.refs.attachID)).then(this._uploaderCallback);},componentWillUnmount:function k(){if(this._uploaderCallback)this._uploaderCallback.cancel();},render:function k(){return c('React').createElement('form',{ref:'form',action:c('MercuryConfig').upload_url,method:'post'},c('React').createElement('input',{type:'hidden',ref:'attachID',name:'attach_id'}),c('React').createElement(c('InlineBlock.react'),{className:"_m _4q60 itemLabel"},c('React').createElement('input',{type:'file',className:"_n",name:'attachment[]',multiple:'true',ref:'input'}),c('React').createElement('span',{className:"_4q61 itemAnchor"},i._("Add Files..."))));}});f.exports=j;}),null);
__d('MNCommerceReviewDialogTextArea.react',['cx','AbstractTextArea.react','React','joinClasses'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){var l=c('joinClasses')(this.props.className,"_3g_j");return c('React').createElement(c('AbstractTextArea.react'),babelHelpers['extends']({},this.props,{className:l}));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MNCommerceReviewDialog.react',['fbt','cx','MessengerEnvironment','MNCommerceButton.react','MNCommerceDetailsDialog.react','MNCommerceDialogBody.react','MNCommerceDialogFooter.react','MNCommerceDialogTitle.react','React','StarsInput.react','MNCommerceReviewDialogTextArea.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(o,p){k.constructor.call(this,o,p);n.call(this);this.state=this.$MNCommerceReviewDialog1();}m.prototype.componentWillReceiveProps=function(o){this.setState(this.$MNCommerceReviewDialog1(o));};m.prototype.render=function(){var o=this.props.merchantName||'',p=this.state.rating>0,q=this.props.review||'',r=this.state.review||'',s=this.state.rating!==this.props.rating||r.length!==q.length||r!==q,t=h._("Write a review for {label for merchant name}",[h.param('label for merchant name',o)]),u=h._("Cancel"),v=h._("Send"),w=h._("Reivew options couldn't be shown.");return c('React').createElement(c('MNCommerceDetailsDialog.react'),babelHelpers['extends']({errorMessage:w,onToggle:this.props.onToggle,shown:this.props.shown},this.props),c('React').createElement(c('MNCommerceDialogTitle.react'),{showCloseButton:true},t),c('React').createElement(c('MNCommerceDialogBody.react'),null,this.$MNCommerceReviewDialog2()),c('React').createElement(c('MNCommerceDialogFooter.react'),null,c('React').createElement(c('MNCommerceButton.react'),{label:u,onClick:this.props.onCancelButtonClick,use:'default'}),c('React').createElement(c('MNCommerceButton.react'),{label:v,onClick:this.$MNCommerceReviewDialog3,disabled:!p||!s,use:'confirm'})));};m.propTypes={error:l.object,loading:l.bool.isRequired,rating:l.number,review:l.string,merchantName:l.string,onCancelButtonClick:l.func,onConfirmButtonClick:l.func.isRequired,pageId:l.string};var n=function o(){this.onStarsChangeClick=function(p){var q=this.state.review;this.onTypeChange(p,q);}.bind(this);this.onReviewChange=function(p){var q=this.state.rating;this.onTypeChange(q,p.target.value);}.bind(this);this.$MNCommerceReviewDialog1=function(p){var q=p||this.props,r=q.rating,s=q.review;return {rating:r,review:s};}.bind(this);this.onTypeChange=function(p,q){this.setState({rating:p,review:q});}.bind(this);this.$MNCommerceReviewDialog2=function(){var p=c('MessengerEnvironment').messengerui,q=this.state.rating||0,r=this.state.review||'',s=(p?"_159y":'')+(!p?' '+"_159z":''),t=(p?"_15a3":'')+(' '+"_15a4");return c('React').createElement('div',null,c('React').createElement('div',{className:t},' Rate your experience'),c('React').createElement(c('StarsInput.react'),{allowMultipleSubmissions:true,large:true,onClick:this.onStarsChangeClick,count:q}),c('React').createElement(c('MNCommerceReviewDialogTextArea.react'),{className:s,defaultValue:r,onChange:this.onReviewChange,placeholder:'Write a review...'}));}.bind(this);this.$MNCommerceReviewDialog3=function(p){var q=this.props;q.onToggle(false);if(!q.onConfirmButtonClick)return;var r=q.pageId;q.onConfirmButtonClick(r,this.state.rating,this.state.review);}.bind(this);};f.exports=m;}),null);
__d('MessengerPlatformBotReviewActions',['MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h={stateLoaded:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOT_REVIEW_STATE.LOADED,state:j});},stateLoadError:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOT_REVIEW_STATE.LOAD_ERROR,pageID:j});},stateReload:function i(j){c('MessengerDispatcher').dispatch({type:c('MNCommerceActionTypes').BOT_REVIEW_STATE.RELOAD,pageID:j});}};f.exports=h;}),null);
__d("XMessengerPlatformBotReviewReadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messages\/platform\/bot_review\/read\/",{page_id:{type:"FBID",required:true}});}),null);
__d('MessengerPlatformBotReviewReadDataManager',['AsyncRequest','MessengerPlatformBotReviewActions','XMessengerPlatformBotReviewReadController'],(function a(b,c,d,e,f,g){'use strict';h.prototype.fetchReviewState=function(i){var j=c('XMessengerPlatformBotReviewReadController').getURIBuilder().setFBID('page_id',i).getURI();new (c('AsyncRequest'))().setURI(j).setHandler(this.$MessengerPlatformBotReviewReadDataManager1).setErrorHandler(this.$MessengerPlatformBotReviewReadDataManager2).send();};h.prototype.$MessengerPlatformBotReviewReadDataManager1=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;if(i)i.payload.pageID=k;c('MessengerPlatformBotReviewActions').stateLoaded(i.payload);};h.prototype.$MessengerPlatformBotReviewReadDataManager2=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MessengerPlatformBotReviewActions').stateLoadError(k);};function h(){}f.exports=new h();}),null);
__d('MessengerPlatformBotReviewStore',['Cache','FluxStore','LoadObject','MessengerDispatcher','MessengerPlatformBotReviewReadDataManager','MNCommerceActionTypes','MNCommerceCacheTimeoutLimits'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MessengerPlatformBotReviewStore1=new (c('Cache'))();}j.prototype.__onDispatch=function(k){var l=k.type,m=k.pageID||k.state&&k.state.pageID;switch(l){case c('MNCommerceActionTypes').BOT_REVIEW_STATE.LOADED:var n=k.state;this.$MessengerPlatformBotReviewStore1.set(m,c('LoadObject').empty().setValue(n),null,c('MNCommerceCacheTimeoutLimits').SUCCESS_TIMEOUT);this.__emitChange();break;case c('MNCommerceActionTypes').BOT_REVIEW_STATE.LOAD_ERROR:this.$MessengerPlatformBotReviewStore1.set(m,c('LoadObject').empty().setError(new Error('Unable to load permissions for: '+m)),null,c('MNCommerceCacheTimeoutLimits').ERROR_TIMEOUT);this.__emitChange();break;case c('MNCommerceActionTypes').BOT_REVIEW_STATE.RELOAD:if(m){this.$MessengerPlatformBotReviewStore1.set(m,c('LoadObject').loading());c('MessengerPlatformBotReviewReadDataManager').fetchReviewState(m);}this.__emitChange();break;}};j.prototype.getReviewState=function(k){if(k&&!this.$MessengerPlatformBotReviewStore1.has(k)){this.$MessengerPlatformBotReviewStore1.set(k,c('LoadObject').loading().setValue({pageID:k}));c('MessengerPlatformBotReviewReadDataManager').fetchReviewState(k);}return this.$MessengerPlatformBotReviewStore1.get(k)||c('LoadObject').empty();};f.exports=new j();}),null);
__d('MNCommerceReviewDialogContainer.react',['MessengerPlatformBotReviewStore','MNCommerceDialogStateActions','MNCommerceDialogStateStore','MNCommerceReviewDialog.react','PureStoreBasedStateMixin','React'],(function a(b,c,d,e,f,g){'use strict';var h=c('React').createClass({displayName:'MNCommerceReviewDialogContainer',mixins:[c('PureStoreBasedStateMixin')(c('MessengerPlatformBotReviewStore'))],statics:{calculateState:function i(){var j=c('MNCommerceDialogStateStore').getState(),k=null;if(j)k=j.pageID;var l=c('MessengerPlatformBotReviewStore').getReviewState(k);return {shown:!!j,loading:l.isLoading(),onConfirmButtonClick:j&&j.onConfirmButtonClick,pageID:k,reviewState:l.getValue(),error:l.getError()};}},render:function i(){var j=this.state.reviewState;return c('React').createElement(c('MNCommerceReviewDialog.react'),{error:this.state.error,loading:this.state.loading,shown:this.state.shown,rating:j.rating,review:j.review,merchantName:j&&j.name,onCancelButtonClick:this._hideDialog,onConfirmButtonClick:this.state.onConfirmButtonClick,onToggle:this._onToggle,pageId:this.state.pageID});},_onToggle:function i(j){if(!j)this._hideDialog();},_hideDialog:function i(){c('MNCommerceDialogStateActions').hideDialog();}});f.exports=h;}),null);
__d('MercuryThreadMuter',['AsyncDialog','AsyncRequest','DOM','MercuryThreadInfo'],(function a(b,c,d,e,f,g){var h={showMuteChangeDialog:function i(j,k){c('AsyncDialog').send(new (c('AsyncRequest'))('/ajax/mercury/mute_thread_dialog.php').setRelativeTo(k),function(l){l.subscribe('confirm',function(){this.hide();var m=void 0;c('DOM').scry(this.getRoot(),'input[type="radio"]').forEach(function(n){if(n.checked)m=n.value;});m=h.convertRawMuteSetting(m);e(['MercuryThreadActions'],function(n){n.get().updateMuteSetting(j,m);});}.bind(l));});},convertRawMuteSetting:function i(j){switch(j){case 'always':return -1;case '30minutes':return 1800;case '1hour':return 3600;case '8hours':return 8*3600;case '24hours':return 24*3600;case '8am':var k,l=new Date(),m=new Date();m.setHours(8);m.setMinutes(0);m.setSeconds(0);if(m>l){k=m-l;}else k=m-l+24*3600*1000;return k/1000;default:return 0;}}};f.exports=h;}),null);
__d('MNCommerceBotsReviewResponseDialog.react',['fbt','MessengerEnvironment','MNCommerceAttachmentConstants','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;k.prototype.render=function(){var l=c('MessengerEnvironment').messengerui?c('MNCommerceAttachmentConstants').MDOTCOMDIALOG.WIDTH:c('MNCommerceAttachmentConstants').DIALOG.WIDTH,m=this.props.success?h._("Thanks for your review!"):h._("Something went wrong"),n=this.props.success?h._("Your review has been successfully submitted."):h._("Please try again");return c('React').createElement(c('XUIDialog.react'),babelHelpers['extends']({autohide:2000,width:l},this.props),c('React').createElement(c('XUIDialogTitle.react'),null,m),c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement('div',null,n)));};function k(){i.apply(this,arguments);}f.exports=k;}),null);
__d('MNCommerceBotsReviewConfirmationDialogContainer.react',['MNCommerceBotsReviewResponseDialog.react','MNCommerceDialogStateActions','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;function j(){var k,l;for(var m=arguments.length,n=Array(m),o=0;o<m;o++)n[o]=arguments[o];return l=(k=i.constructor).call.apply(k,[this].concat(n)),this.$MNCommerceBotsReviewConfirmationDialogContainer1=function(p){if(!p)this.$MNCommerceBotsReviewConfirmationDialogContainer2();}.bind(this),this.$MNCommerceBotsReviewConfirmationDialogContainer2=function(){c('MNCommerceDialogStateActions').hideDialog();},l;}j.prototype.render=function(){return c('React').createElement(c('MNCommerceBotsReviewResponseDialog.react'),{success:true,shown:true,onToggle:this.$MNCommerceBotsReviewConfirmationDialogContainer1});};f.exports=j;}),null);
__d('MNCommerceBotsReviewErrorDialogContainer.react',['MNCommerceBotsReviewResponseDialog.react','MNCommerceDialogStateActions','React'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;function j(){var k,l;for(var m=arguments.length,n=Array(m),o=0;o<m;o++)n[o]=arguments[o];return l=(k=i.constructor).call.apply(k,[this].concat(n)),this.$MNCommerceBotsReviewErrorDialogContainer1=function(p){if(!p)this.$MNCommerceBotsReviewErrorDialogContainer2();}.bind(this),this.$MNCommerceBotsReviewErrorDialogContainer2=function(){c('MNCommerceDialogStateActions').hideDialog();},l;}j.prototype.render=function(){return c('React').createElement(c('MNCommerceBotsReviewResponseDialog.react'),{success:false,shown:true,onToggle:this.$MNCommerceBotsReviewErrorDialogContainer1});};f.exports=j;}),null);
__d("XMessengerPlatformBotReviewWriteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messages\/platform\/bot_review\/write\/",{page_id:{type:"FBID",required:true},rating:{type:"Int",required:true},review:{type:"String"}});}),null);
__d('MessengerPlatformBotReviewWriteDataManager',['AsyncRequest','MessengerPlatformBotReviewActions','XMessengerPlatformBotReviewWriteController','MNCommerceBotsReviewErrorDialogContainer.react','MNCommerceBotsReviewConfirmationDialogContainer.react','MNCommerceDialogStateActions'],(function a(b,c,d,e,f,g){'use strict';h.prototype.review=function(i,j,k){var l=c('XMessengerPlatformBotReviewWriteController').getURIBuilder().setFBID('page_id',i).setInt('rating',j).setString('review',k).getURI();new (c('AsyncRequest'))().setURI(l).setHandler(this.$MessengerPlatformBotReviewWriteDataManager1).setErrorHandler(this.$MessengerPlatformBotReviewWriteDataManager2).send();};h.prototype.$MessengerPlatformBotReviewWriteDataManager1=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MessengerPlatformBotReviewActions').stateReload(k);c('MNCommerceDialogStateActions').showDialog(c('MNCommerceBotsReviewConfirmationDialogContainer.react'),{});};h.prototype.$MessengerPlatformBotReviewWriteDataManager2=function(i){var j=i.getRequest().uri.getQueryData(),k=j.page_id;c('MessengerPlatformBotReviewActions').stateLoadError(k);c('MNCommerceDialogStateActions').showDialog(c('MNCommerceBotsReviewErrorDialogContainer.react'),{});};function h(){}f.exports=new h();}),null);
__d("XMessagingGroupOptionsDialogController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/dialog\/group_options\/",{thread_fbid:{type:"String",required:true},__asyncDialog:{type:"Int"}});}),null);
__d('ChatTabMenu.react',['cx','fbt','invariant','Promise','AsyncDialog','AsyncRequest','AutoFocusableLink.react','Bootloader','ChatConfig','ChatFileUploader.react','ChatPrivacyActionController','CurrentUser','Dialog','EventRemindersGating','FantaMessageActions','FantaTabActions','JSResource','BootloadedComponent.react','MercuryConfig','MercuryIDs','MercuryLogMessageType','MercuryParticipants','MercurySourceType','MercuryThreadMuter','MercuryViewer','MessengerAdminGroupUtils','MessengerPlatformBotReviewWriteDataManager','MNCommerceDialogStateActions','MNCommercePromotionBlockDataManager','MNCommercePromotionManageBlockDialogContainer.react','MNCommerceReviewDialogContainer.react','NFXChatHeadGK','PopoverMenu.react','ReactComponentWithPureRenderMixin','React','ReactDOM','ReactMenu','MercuryMessageObject','MercuryThreadActions','MercuryThreadIDMap','MercuryThreads','MercuryMessageActions','ChangeChatTabColorDialog','EditChatTabNicknamesDialog','MenuSeparator.react','RTCConfig','Toggler','TrackingNodes','URI','WebMessengerDeleteThreadDialog','WebMessengerThreadPermalinks','XNFXStartForMessageThreadController','WorkModeConfig','WorkFileUploadsGating','WorkGKs','getPageIDFromThreadID','XEventCreateDialogController','XMessagingGroupOptionsDialogController','goURI'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k=c('MercuryMessageObject').get(),l=c('MercuryThreadActions').get(),m=c('MercuryThreadIDMap').get(),n=c('MercuryThreads').get(),o=c('MercuryMessageActions').get(),p=c('ReactMenu').Item,q=c('React').PropTypes,r=c('React').createClass({displayName:'ChatTabMenu',_privacyActionController:undefined,_fileUploaderPromise:undefined,_fileUploaderLoader:undefined,_fileUploaderPromiseResolve:undefined,_isEventPlanEditing:false,_eventPlanActionContext:undefined,linkRef:undefined,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{autoFocus:q.bool,attachmentsShelf:q.object,nameConversationFunc:q.func,isGroupChat:q.bool,isEmptyChat:q.bool,hasMessageBlocked:q.bool,isEmptyConversation:q.bool,onFileUploaderMounted:q.func,onMount:q.func,onSubmit:q.func,onUpdateAttachmentsShelf:q.func,onUploadFinished:q.func,otherUserID:q.string,sheetController:q.object.isRequired,showAddFriend:q.func,threadID:q.string.isRequired},getInitialState:function s(){return {url:null,privacyText:'',muted:false,showReportPageDialog:false,showEventPlanFlyout:false};},getDefaultProps:function s(){return {show:true,isMuted:false,hasSwitchToWork:false};},componentWillMount:function s(){this._fileUploaderPromise=new (c('Promise'))(function(t,u){this._fileUploaderPromiseResolve=t;}.bind(this));},componentDidMount:function s(){c('WebMessengerThreadPermalinks').getThreadURI(this.props.threadID,function(t){this.isMounted()&&!c('MercuryIDs').isLocalThread(this.props.threadID)&&this.setState({url:t});}.bind(this));if(!this.props.isGroupChat)this._privacyActionController=new (c('ChatPrivacyActionController'))(c('MercuryIDs').getUserIDFromThreadID(this.props.threadID),function(t){return this._updatePrivacyLink(t);}.bind(this));if(this.props.isMuted)this.props.sheetController.openThreadIsMutedTabSheet();this.props.onMount&&this.props.onMount(this);},componentDidUpdate:function s(t,u){if(this.props.isMuted&&!t.isMuted){this.props.sheetController.openThreadIsMutedTabSheet();}else if(!this.props.isMuted&&t.isMuted)this.props.sheetController.closeThreadIsMutedTabSheet();if(!c('MercuryConfig').FantaTabView)if(this.props.hasMessageBlocked){this.props.sheetController.openMessageBlockedTabSheet();}else this.props.sheetController.closeMessageBlockedTabSheet();},_initFileUploader:function s(t,u,v){if(!c('MercuryConfig').FantaTabView)if(this._fileUploaderLoader&&this._fileUploaderPromise){this._fileUploaderPromise.done(function(w){w.updateElements(t,u,v);});}else this._fileUploaderLoader=new (c('Promise'))(function(w,x){c('Bootloader').loadModules(["MercuryFileUploader"],function(y){var z=new y(this.props.attachmentsShelf,t,u,v);this._fileUploaderPromiseResolve&&this._fileUploaderPromiseResolve(z);w(z);}.bind(this),'ChatTabMenu.react');}.bind(this));return this._fileUploaderPromise;},componentWillUnmount:function s(){this._privacyActionController&&this._privacyActionController.destroy();this._fileUploaderPromise&&this._fileUploaderPromise.then(function(t){t.destroy();});},_unmuteThread:function s(){l.unmute(this.props.threadID);c('Toggler').hide();},_togglePrivacyFunc:function s(){this._privacyActionController&&this._privacyActionController.togglePrivacy();},_renderFileUploader:function s(){if(c('MercuryConfig').FantaTabView){return c('React').createElement(p,{className:"_37_x"},c('React').createElement('span',{className:"_4q61 itemAnchor",onClick:function(){return c('FantaMessageActions').openUploadFilePicker(this.props.threadID);}.bind(this),role:'button'},i._("Add Files...")));}else return c('React').createElement(p,{className:"_37_x"},c('React').createElement(c('ChatFileUploader.react'),{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,initFileUploaderFn:this._initFileUploader,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit}));},_fullConversationRedirect:function s(){c('goURI')(this.state.url);},_renderOpenFullConversation:function s(){if(this.state.url){var t=c('WorkGKs').workplace_www_chat_branding?i._("Open in Work Chat"):i._("Open in Messenger");return c('React').createElement(p,{href:this.state.url,onclick:this._fullConversationRedirect},t);}return null;},_renderAddFriend:function s(){if(!this.props.showAddFriend)return null;var t=n.getThreadMetaNow(this.props.threadID),u=c('MessengerAdminGroupUtils').shouldInvite(t),v=void 0;if(c('WorkModeConfig').is_work_user){v=i._("Add Coworkers to Chat...");}else if(u){v=i._("Invite friends to Chat...");}else v=i._("Add Friends to Chat...");return c('React').createElement(p,{onclick:this.props.showAddFriend},v);},_renderTogglePrivacy:function s(){if(!this.props.isGroupChat&&this.state.privacyText)return c('React').createElement(p,{onclick:this._togglePrivacyFunc},this.state.privacyText);return null;},_canEditNickname:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('CurrentUser').getID(),v=t&&t.participants&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u);return !!v;},_renderEditNickname:function s(){if(!this._canEditNickname()||!c('ChatConfig').get('chat_tab_edit_nickname'))return null;return c('React').createElement(p,{onclick:this._showEditNicknameDialog},i._("Edit Nicknames"));},_renderChangeColor:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),v=t&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u);if(v&&c('ChatConfig').get('chat_tab_custom_color'))return c('React').createElement(p,{onclick:this._showCustomColorDialog},i._("Change Color..."));return null;},_renderMuteConversation:function s(){if(!this.props.isMuted){var t=c('MercuryThreadMuter').showMuteChangeDialog.bind(null,this.props.threadID,this.linkRef);return c('React').createElement(p,{onclick:t},i._("Mute Conversation..."));}else return c('React').createElement(p,{onclick:this._unmuteThread},i._("Unmute Conversation"));},_renderDeleteConversation:function s(){return c('React').createElement(p,{onclick:this._deleteConversation},i._("Delete Conversation..."));},_renderReportSpam:function s(){var t=c('getPageIDFromThreadID')(this.props.threadID),u=i._("Report...");if(c('MercuryConfig').MessengerPlatformReportPage&&t)return c('React').createElement(p,{onclick:this._reportPageClicked},c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('MNCommerceReportConversationDialog.react').__setRef('ChatTabMenu.react'),pageID:t,showDialog:this.state.showReportPageDialog,onToggle:this._handleReportPageToggle}),u);if(!this.props.isGroupChat&&!c('CurrentUser').isWorkUser())return c('React').createElement(p,{onclick:this._reportSpamClicked},u);return null;},_manageMessagesItem:function s(){if(this.props.isBusinessEnabled)return c('React').createElement(p,{onclick:this._messageManageClicked},i._("Manage Messages..."));return null;},_manageReviewItem:function s(){if(!this.props.isBusinessEnabled||!c('MercuryConfig').MessengerPlatformBotReviewUsers)return null;return c('React').createElement(p,{onclick:this._reviewClicked},i._("Leave Feedback"));},_blockMessagesItem:function s(){if(this.props.isBusinessEnabled||this.props.otherUserID&&this.props.otherUserID===c('CurrentUser').getID())return null;if(!this.props.isGroupChat&&!this.props.hasMessageBlocked&&!this.props.isEmptyConversation&&!c('CurrentUser').isWorkUser())return c('React').createElement(p,{onclick:this._messageBlockedClicked},i._("Block Messages..."));if(!this.props.isMultichat&&this.props.hasMessageBlocked)return c('React').createElement(p,{onclick:this._messageUnblockedClicked},i._("Unblock Messages..."));return null;},_renderCreateGroup:function s(){if(this.props.isGroupChat)return c('React').createElement(p,{onclick:this._createGroupClicked},i._("Create Group"));return null;},_renderCreateEvent:function s(){if(this.props.isGroupChat)return c('React').createElement(p,{onclick:this._createEventClicked},i._("Create Event"));return null;},_renderCreatePlan:function s(){if(c('EventRemindersGating').isCreateAllowed)return c('React').createElement(p,{onclick:this._onEventPlanButtonClicked},i._("Start Plan"),this._renderEventPlanFlyout());return null;},_renderSwitchToWork:function s(){if(this.props.hasSwitchToWork)return c('React').createElement(p,{onclick:this._switchToWorkUserClicked},i._("Move to Workplace"));return null;},_renderConversationName:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID()),v=t&&u&&c('MessengerAdminGroupUtils').canUpdateThreadCustomization(t,u)&&this.props.isGroupChat&&!n.isEmptyLocalThread(this.props.threadID);if(v)return c('React').createElement(p,{onclick:this.props.nameConversationFunc},i._("Edit Conversation Name"));return null;},_renderLeaveConversation:function s(){if(this.props.isGroupChat)return c('React').createElement(p,{onclick:this._unsubscribeLinkClicked},i._("Leave Conversation..."));return null;},_renderPeopleList:function s(){if(this.props.isGroupChat&&!n.isEmptyLocalThread(this.props.threadID))return c('React').createElement(p,{onclick:this._showParticipants},i._("Edit Participants..."));return null;},_renderGroupOptions:function s(){var t=n.getThreadMetaNow(this.props.threadID),u=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(t&&u&&this.props.isGroupChat&&c('MessengerAdminGroupUtils').canSeeGroupOptions(true,t,u))return c('React').createElement(p,{onclick:this._showGroupOptions},i._("View Group Options"));return null;},_renderToggleSecretMode:function s(){if(this.props.hasSecretModeOn)return c('React').createElement(p,{onclick:this._secretModeTurnOff},i._("Turn off disappearing messages"));return null;},_renderShareScreenContent:function s(){if(c('RTCConfig').CollaborationScreenSharingGK&&!this.props.isGroupChat)return c('React').createElement(p,{onclick:this._shareScreenContentClicked},i._("Share Screen Content..."));return null;},_shareScreenContentClicked:function s(){c('Bootloader').loadModules(["FBRTCScreenSharingController"],function(t){var u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);!!u||j(0);var v=new t(parseInt(u,10),null,true);v.initPromise.done(function(){v.initializeAsSender();v.toggleScreenSharing();});}.bind(this),'ChatTabMenu.react');},render:function s(){var t=this._renderReportSpam(),u=this._blockMessagesItem(),v=this._manageMessagesItem(),w=this._manageReviewItem(),x=this._renderCreateGroup(),y=this._renderCreateEvent(),z=this._renderCreatePlan(),aa=this._renderGroupOptions(),ba=c('React').createElement(c('ReactMenu'),{className:"chatReact"+(!this.props.show?' '+"hidden_elem":'')},this._renderOpenFullConversation(),c('WorkFileUploadsGating').canUploadFiles?this._renderFileUploader():null,this._renderToggleSecretMode(),this._renderAddFriend(),this._renderShareScreenContent(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),c('React').createElement(c('MenuSeparator.react'),null),aa,aa?c('React').createElement(c('MenuSeparator.react'),null):null,this._renderEditNickname(),this._renderChangeColor(),this._renderSwitchToWork(),this._renderMuteConversation(),this._renderDeleteConversation(),this._renderLeaveConversation(),t||u||v||w?c('React').createElement(c('MenuSeparator.react'),null):null,u,v,w,t,x||y||z?c('React').createElement(c('MenuSeparator.react'),null):null,x,y,z),ca=i._("Options"),da=c('TrackingNodes').getTrackingInfo(c('TrackingNodes').types.DROPDOWN_BUTTON);return c('React').createElement(c('PopoverMenu.react'),{menu:ba,ref:'menu'},c('React').createElement(c('AutoFocusableLink.react'),{autoFocus:this.props.autoFocus,'data-ft':da,'data-hover':'tooltip','aria-label':ca,'data-tooltip-alignh':'center','data-tooltip-content':ca,className:"button"+(this.props.isEmptyChat?' '+"hidden_elem":'')+(' '+"_3olv")+(' '+"_1ll-"),ref:function(ea){return this.linkRef=c('ReactDOM').findDOMNode(ea);}.bind(this),role:'button'}));},getFileUploaderPromise:function s(){return this._fileUploaderPromise;},_updatePrivacyLink:function s(t){var u=void 0;if(t==c('ChatPrivacyActionController').OFFLINE){u=i._("Go online");this.setState({privacyText:u});return;}if(this.props.isGroupChat||this.props.otherUserID===undefined)return;var v='fbid:'.concat(this.props.otherUserID);c('MercuryParticipants').get(v,function(w){if(!w.is_friend){u=null;}else if(t==c('ChatPrivacyActionController').BLOCKED){u=i._("Turn On Chat for {name}",[i.param('name',w.short_name)]);}else if(c('MercuryConfig').ChatSettingsDisableLists){u='';}else u=i._("Turn Off Chat for {name}",[i.param('name',w.short_name)]);this.setState({privacyText:u});}.bind(this));},_showEditNicknameDialog:function s(){var t=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());if(t)c('EditChatTabNicknamesDialog').show(this.props.threadID,t,this.linkRef);},_showCustomColorDialog:function s(){c('ChangeChatTabColorDialog').show(this.props.threadID,this.linkRef);},_showParticipants:function s(){m.getServerIDFromClientID(this.props.threadID,function(t){c('AsyncDialog').send(new (c('AsyncRequest'))(new (c('URI'))('/ajax/browser/dialog/multichat_members/').addQueryData({id:t})));});},_unsubscribeLinkClicked:function s(){var t=[];t.push({name:'unsubscribe',label:i._("Leave Conversation"),handler:function(){return this._unsubscribeToThread();}.bind(this)});t.push(c('Dialog').CANCEL);var u=void 0;n.getThreadMeta(this.props.threadID,function(v){if(v.admin_ids&&v.admin_ids.indexOf(c('MercuryViewer').getID())!==-1){u=i._("Leaving this group will remove you as an owner and allow other members to manage the group. You will no longer be able to send and receive messages.");}else u=i._("You will stop receiving messages from this conversation and people will see that you left.");});new (c('Dialog'))().setTitle(i._("Leave Conversation?")).setBody(u).setButtons(t).show();},_unsubscribeToThread:function s(){if(!n.isEmptyLocalThread(this.props.threadID)){var t=k.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this.props.threadID,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]});o.send(t);}c('FantaTabActions').closeTab(this.props.threadID);return true;},_deleteConversation:function s(){c('WebMessengerDeleteThreadDialog').show(this.props.threadID,null,this.linkRef);},_reportSpamClicked:function s(){var t=new (c('URI'))('/ajax/chat/report.php').addQueryData({id:this.props.otherUserID}).addQueryData({src:'top_report_link'});if(c('NFXChatHeadGK').result)t=c('XNFXStartForMessageThreadController').getURIBuilder().setString('thread_fbid',this.props.otherUserID).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(t));},_reportPageClicked:function s(){this.setState({showReportPageDialog:true});},_handleReportPageToggle:function s(){this.setState({showReportPageDialog:false});},_messageBlockedClicked:function s(){l.blockMessages(this.props.threadID);},_messageManageClicked:function s(){var t=function v(w,x){return c('MNCommercePromotionBlockDataManager').block(w,x);},u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);c('MNCommerceDialogStateActions').showDialog(c('MNCommercePromotionManageBlockDialogContainer.react'),{pageID:u,onConfirmButtonClick:t});},_reviewClicked:function s(){var t=function v(w,x,y){if(x===0)return;c('MessengerPlatformBotReviewWriteDataManager').review(w,x,y.trim());},u=c('MercuryIDs').getUserIDFromThreadID(this.props.threadID);c('MNCommerceDialogStateActions').showDialog(c('MNCommerceReviewDialogContainer.react'),{pageID:u,onConfirmButtonClick:t});},_messageUnblockedClicked:function s(){l.unblockMessages(this.props.threadID);},_secretModeTurnOff:function s(){l.turnOffSecretMode(this.props.threadID);},_secretModeTurnOn:function s(){l.turnOnSecretMode(this.props.threadID);},_showGroupOptions:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=c('XMessagingGroupOptionsDialogController').getURIBuilder().setString('thread_fbid',t.thread_fbid).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(u));}});},_createGroupClicked:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=new (c('URI'))('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),v=t.participants.map(function(w){return c('MercuryIDs').getUserIDFromParticipantID(w);}).filter(function(w){return w;});u.addQueryData({members:v});if(t.name)u.addQueryData({name:t.name});c('AsyncDialog').send(new (c('AsyncRequest'))(u));}});},_createEventClicked:function s(){n.getThreadMeta(this.props.threadID,function(t){if(!t.is_canonical){var u=t.participants.map(function(w){return c('MercuryIDs').getUserIDFromParticipantID(w);}).filter(function(w){return w;}),v=c('XEventCreateDialogController').getURIBuilder().setString('acontext',JSON.stringify({})).setIntVector('invite_ids',u).getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(v));}});},_switchToWorkUserClicked:function s(){var t=[];t.push({name:'move',label:i._("Move Conversation"),handler:function(){return this._switchToWork();}.bind(this)});t.push(c('Dialog').CANCEL);var u=i._("Move Conversation to Workplace?"),v=i._("Do you want to move this conversation to Workplace?");new (c('Dialog'))().setTitle(u).setBody(v).setButtons(t).show();},_switchToWork:function s(){if(!n.isEmptyLocalThread(this.props.threadID)){var t=k.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,this.props.threadID,c('MercuryLogMessageType').SWITCH_TO_WORK,{removed_participants:[c('MercuryViewer').getID()]});o.send(t);}c('FantaTabActions').closeTab(this.props.threadID);return true;},open:function s(){this.refs.menu.showPopover();},_onEventPlanButtonClicked:function s(){c('Bootloader').loadModules(["EventsActionsLogger","EventReminderStateStore","EventReminderRequestHelper"],function(t,u,v){this._eventPlanActionContext={action_history:[{surface:t.Surface.MESSENGER_CHAT_TAB,mechanism:t.Mechanism.MESSENGER_THREAD_SETTINGS}]};var w=u.getEvent(this.props.threadID);if(w&&w.exists){this._isEventPlanEditing=true;if(!this.state.showFlyout){v.fetchEventReminder(this.props.threadID,w.eventID,function(){this.setState({showEventPlanFlyout:true});}.bind(this));}else this.setState({showEventPlanFlyout:false});}else{this._isEventPlanEditing=false;this.setState({showEventPlanFlyout:!this.state.showEventPlanFlyout});}}.bind(this),'ChatTabMenu.react');},_renderEventPlanFlyout:function s(){if(!this.state.showEventPlanFlyout)return null;var t={shown:true,onToggle:this._onToggle};return c('React').createElement(c('BootloadedComponent.react'),{bootloadPlaceholder:c('React').createElement('div',null),bootloadLoader:c('JSResource')('ChatEventReminderContainer.react').__setRef('ChatTabMenu.react'),threadID:this.props.threadID,useContextualDialog:false,dialogProps:t,flyoutNoSheet:true,isEditing:this._isEventPlanEditing,actionContext:this._eventPlanActionContext});},_onToggle:function s(t){this.setState({showEventPlanFlyout:false});}});f.exports=r;}),null);