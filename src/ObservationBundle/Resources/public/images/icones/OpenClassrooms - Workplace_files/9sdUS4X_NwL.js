if (self.CavalryLogger) { CavalryLogger.start_js(["pQG1q"]); }

__d("ChatNotificationConstants",[],(function a(b,c,d,e,f,g){f.exports={NORMAL:0,NO_USER_MESSAGE_NOTIFICATION:1};}),null);
__d("MercuryActionStatus",[],(function a(b,c,d,e,f,g){f.exports={UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10};}),null);
__d("MercuryActionType",[],(function a(b,c,d,e,f,g){f.exports={LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",ADD_GROUP_ADMINS:"ma-type:add_group_admins",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message",JOINABLE_MODE:"ma-type:joinable-mode",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue",IS_PIN_PROTECTED:"ma-type:is_pin_protected",REACTION_UPDATE:"ma-type:reaction-update",UPDATE_RTC_CALL_DATA:"ma-type:update-rtc-call-data"};}),null);
__d("MercuryAPIArgsSource",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"};}),null);
__d("MercuryAttachmentContentType",[],(function a(b,c,d,e,f,g){f.exports={PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"};}),null);
__d("MercuryAudioType",[],(function a(b,c,d,e,f,g){f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"};}),null);
__d("MercuryErrorType",[],(function a(b,c,d,e,f,g){f.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};}),null);
__d("MercuryGlobalActionType",[],(function a(b,c,d,e,f,g){f.exports={MARK_ALL_READ:"mga-type:mark-all-read",MARK_ALL_SEEN:"mga-type:mark-all-seen"};}),null);
__d("MercuryLogMessageType",[],(function a(b,c,d,e,f,g){f.exports={SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"};}),null);
__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};}),null);
__d("MercurySendMessageFields",[],(function a(b,c,d,e,f,g){f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};}),null);
__d("MercurySourceType",[],(function a(b,c,d,e,f,g){f.exports={CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",CONTACT_ADD_MUTATION:"source:contact_add:graphql_mutation",CONTACT_ADD_CYMK:"source:contact_add:cymk_suggestion",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",EVENT_REMINDERS:"source:event_reminders",FUNDRAISER_MESSAGE_BLAST:"source:fundraiser_message_blast",GENERIC_ADMIN_TEXT:"source:generic_admin_text",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",INVITE:"source:invite",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",MESSENGER_WEB_SEARCH:"source:messenger:web_search",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",MESSENGER_EMPLOYEE_ONLY_BOT:"source:bot:employee_only",MESSENGER_OMNIM:"source:messenger:omnim",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",MARKETPLACE:"source:marketplace",MESSENGER_LEAD_GEN:"source:messenger:lead_gen",PAGES_MESSAGE_SHORTLINK:"source:pages:message_shortlink",STICKER_SUBSCRIBE:"source:messenger:sticker_subscribe",PHOTO_TAG:"source:messenger:photo_tag",INTERNAL_TEST_PENDING:"source:internal:test_pending",JOB_SEARCH_APPLICATION:"source:job_search:application",MESSENGER_JOINABLE_LINK:"source:messenger:joinable_link",MESSENGER_SMS_BRIDGE_CONVERT:"source:messenger:sms_bridge_conversion",TINCAN_ORCA:"source:tincan:orca",TINCAN_IOS:"source:tincan:ios",TINCAN_UNKNOWN:"source:tincan:unknown",FACEBOOK_GROUPS_CHANNELS:"source:groups:channels",GROUP_COMMERCE:"source:group_commerce",INTERNAL_TOOL:"source:internal:tool",PAGES_PLATFORM:"source:pages:platform",PAGES_RECOMMENDATION:"source:pages:recommendation",PAGE_AUTO_RESPONSE:"source:pages:auto_response",PAGES_INVITE:"source:pages:invite",FRIENDING_ADMIN_BUMP:"source:messenger_growth:friending_admin_bump",NEW_MESSENGER_USER_ADMIN_BUMP:"source:messenger_growth:new_messenger_user_admin_bump",EVENT_UPCOMING_BUMP:"source:messenger_growth:event_upcoming_bump"};}),null);
__d("MercuryTimePassed",[],(function a(b,c,d,e,f,g){f.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};}),null);
__d("MessengerApprovalModeTypes",[],(function a(b,c,d,e,f,g){f.exports={OPEN:0,APPROVALS:1};}),null);
__d("MessengerJoinableModeType",[],(function a(b,c,d,e,f,g){f.exports={PRIVATE:0,JOINABLE:1};}),null);
__d("PageMessageEnumTag",[],(function a(b,c,d,e,f,g){f.exports={FLAG:"flag",IMPORTANT:"important",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing",JOB_APPLICATION:"job_application",CONFIRMED_APPOINTMENT:"confirmed_appointment",PENDING_APPOINTMENT:"pending_appointment",REQUESTED_APPOINTMENT:"requested_appointment",MESSENGER_ADS:"messenger_ads"};}),null);
__d("PhotoResizeModeConst",[],(function a(b,c,d,e,f,g){f.exports={CONTAIN:"s",COVER:"p"};}),null);
__d('DockTabsViewportFantaTabUtils',[],(function a(b,c,d,e,f,g){'use strict';var h=269;function i(){return h+1;}function j(m){return Math.floor(m/h);}function k(m){if(!m)return null;var n=m.fantaTabModelStateGetter;return n?n():null;}function l(m){return m?m.size:0;}f.exports={getTabCountToFitWidth:j,getMinRequiredWidthForFirstFantaTab:i,getFantaTabModelFromCallbacks:k,getNumFantaTabsFromModel:l};}),null);
__d('DockTabsViewportPinnedConversationTabUtils',[],(function a(b,c,d,e,f,g){'use strict';var h=496+9+2,i=210+9+2,j=52;function k(){return h;}function l(){return i;}function m(){return j;}function n(r){return r.getIsRaised()?k():l();}function o(){return k()+j;}function p(r){var s=r||{},t=s.pinnedConvoTabStateGetter;return t?t():null;}function q(r){return r?r.getTotalTabCount():0;}f.exports={getRaisedPinnedConvoTabWidth:k,getLoweredPinnedConvoTabWidth:l,getPinnedConvoSelectorWidth:m,getPinnedConvoTabWidth:n,getMinRequiredWidthForFirstConvoTab:o,getPinnedConvoTabsStateFromCallbacks:p,getNumPinnedConvoTabsFromModel:q};}),null);
__d('DockTabsViewportCalculator',['csx','Arbiter','DataStore','Dock','DockTabsViewportFantaTabUtils','DockTabsViewportPinnedConversationTabUtils','DOM','Event','FullScreen','PinnedConversationNubsConfig','SubscriptionsHandler','Vector','ViewportBounds','ge','getViewportDimensions','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=50,j=35,k=j,l='dock-tab-viewport-inst',m=c('DockTabsViewportFantaTabUtils').getMinRequiredWidthForFirstFantaTab,n=c('DockTabsViewportFantaTabUtils').getFantaTabModelFromCallbacks,o=c('DockTabsViewportFantaTabUtils').getNumFantaTabsFromModel,p=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab,q=c('DockTabsViewportPinnedConversationTabUtils').getNumPinnedConvoTabsFromModel,r=c('DockTabsViewportPinnedConversationTabUtils').getPinnedConvoTabsStateFromCallbacks;function s(u){return u?c('Vector').getElementDimensions(u).x:0;}function t(u){this.$DockTabsViewportCalculatorImpl1=u;this.$DockTabsViewportCalculatorImpl3=0;this.$DockTabsViewportCalculatorImpl4=0;this.$DockTabsViewportCalculatorImpl5=null;this.$DockTabsViewportCalculatorImpl6=null;this.$DockTabsViewportCalculatorImpl7=false;this.$DockTabsViewportCalculatorImpl8=false;this.$DockTabsViewportCalculatorImpl9=false;this.$DockTabsViewportCalculatorImpl2=new (c('SubscriptionsHandler'))();this.$DockTabsViewportCalculatorImpl10();this.$DockTabsViewportCalculatorImpl11();}t.prototype.$DockTabsViewportCalculatorImpl10=function(){var u=this.$DockTabsViewportCalculatorImpl12.bind(this);this.$DockTabsViewportCalculatorImpl2.addSubscriptions(c('Event').listen(window,'resize',u),c('Dock').subscribe('resize',u),c('Arbiter').subscribeOnce('sidebar/initialized',u,c('Arbiter').SUBSCRIBE_NEW),c('FullScreen').subscribe('changed',function(){if(c('FullScreen').isFullScreen()){this.$DockTabsViewportCalculatorImpl7=true;this.$DockTabsViewportCalculatorImpl8=false;}else{this.$DockTabsViewportCalculatorImpl7=false;if(this.$DockTabsViewportCalculatorImpl8){c('setImmediate')(function(){u();});this.$DockTabsViewportCalculatorImpl8=false;}}}.bind(this)));};t.prototype.registerFantaTabCallbacks=function(u){this.$DockTabsViewportCalculatorImpl5=u;};t.prototype.registerPinnedConvoTabCallbacks=function(u){this.$DockTabsViewportCalculatorImpl6=u;};t.prototype.forceRecalculateFBDockWidth=function(){this.$DockTabsViewportCalculatorImpl11();this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:false,pinnedConvoUpdateData:null});};t.prototype.forceRecalculateChatTabs=function(){this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:true,pinnedConvoUpdateData:null});};t.prototype.forceRecalculatePinnedConvoTabs=function(u){this.$DockTabsViewportCalculatorImpl13({forceRecalculateChatTabs:true,pinnedConvoUpdateData:u});};t.prototype.$DockTabsViewportCalculatorImpl12=function(){if(c('FullScreen').isFullScreen()||this.$DockTabsViewportCalculatorImpl7){this.$DockTabsViewportCalculatorImpl8=true;return;}this.forceRecalculateFBDockWidth();};t.prototype.$DockTabsViewportCalculatorImpl13=function(u){var v=u.forceRecalculateChatTabs,w=u.pinnedConvoUpdateData,x=this.$DockTabsViewportCalculatorImpl14(),y=x.chatTabAvailableWidth,z=x.pinnedConvoTabAvailableWidth;this.$DockTabsViewportCalculatorImpl15(y,!!v);this.$DockTabsViewportCalculatorImpl16(z,w);};t.prototype.$DockTabsViewportCalculatorImpl16=function(u,v){var w=this.$DockTabsViewportCalculatorImpl6||{},x=w.onAvailableWidthChanged;x&&x(u,v);};t.prototype.$DockTabsViewportCalculatorImpl15=function(u,v){var w=this.$DockTabsViewportCalculatorImpl5||{},x=w.onAvailableWidthChanged;x&&x(u);};t.prototype.$DockTabsViewportCalculatorImpl17=function(){var u=n(this.$DockTabsViewportCalculatorImpl5);return o(u);};t.prototype.$DockTabsViewportCalculatorImpl18=function(){return m();};t.prototype.$DockTabsViewportCalculatorImpl14=function(){var u=this.$DockTabsViewportCalculatorImpl3,v={chatTabAvailableWidth:u,pinnedConvoTabAvailableWidth:0},w={chatTabAvailableWidth:0,pinnedConvoTabAvailableWidth:u},x=this.$DockTabsViewportCalculatorImpl17(),y=r(this.$DockTabsViewportCalculatorImpl6),z=q(y);if(!y||z===0){return v;}else if(x===0)return w;var aa=this.$DockTabsViewportCalculatorImpl18();if(u<=aa)return v;var ba=p(),ca=u-aa,da=0;if(ca<ba){if(c('PinnedConversationNubsConfig').chatTabTypingPriority&&y&&(y.anyTabHasText()||y.anyTabHasFocus())){return w;}else return v;}else da=ba;var ea=da,fa=Math.max(aa,u-da);return {chatTabAvailableWidth:fa,pinnedConvoTabAvailableWidth:ea};};t.prototype.$DockTabsViewportCalculatorImpl11=function(){this.$DockTabsViewportCalculatorImpl3=this.$DockTabsViewportCalculatorImpl19();this.$DockTabsViewportCalculatorImpl20('DockTabsViewportCalculator/recalcTotalDock_FOR_TEST_ONLY');};t.prototype.$DockTabsViewportCalculatorImpl21=function(){var u=this.$DockTabsViewportCalculatorImpl1;if(!u)return {buddyListNubWidth:0,employeeNubsWidth:0};var v=s(u),w=s(c('DOM').find(u,"._56ox")),x=s(c('DOM').scry(u,"._56oy")[0]),y=s(c('DOM').scry(u,"._ph1")[0]),z=Math.max(v-w-x-y,0);return {buddyListNubWidth:w,employeeNubsWidth:z};};t.prototype.$DockTabsViewportCalculatorImpl19=function(){var u=c('getViewportDimensions').withoutScrollbars().width;u-=c('ViewportBounds').getLeft()+c('ViewportBounds').getRight();u-=i;var v=this.$DockTabsViewportCalculatorImpl21(),w=v.buddyListNubWidth,x=v.employeeNubsWidth;u-=w;this.$DockTabsViewportCalculatorImpl4=Math.max(this.$DockTabsViewportCalculatorImpl4,x);u-=this.$DockTabsViewportCalculatorImpl4;u-=k;return Math.max(u,0);};t.prototype.enableTestInforms_FOR_TEST_ONLY=function(){this.$DockTabsViewportCalculatorImpl9=true;};t.prototype.$DockTabsViewportCalculatorImpl20=function(u){if(this.$DockTabsViewportCalculatorImpl9)c('Arbiter').inform(u);};t.prototype.getChatTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl14().chatTabAvailableWidth;};t.prototype.getPinnedConvoTabAvailableDockWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl14().pinnedConvoTabAvailableWidth;};t.prototype.getAvailableTotalWidth_FOR_TEST_ONLY=function(){return this.$DockTabsViewportCalculatorImpl3;};f.exports={getInstance:function u(v){var w=c('ge')('pagelet_dock');if(!w||!c('DOM').contains(w,v))return null;var x=c('DataStore').get(w,l);if(x instanceof t)return x;var y=c('DOM').scry(w,'.fbDockWrapperRight .fbDock')[0];x=new t(y);c('DataStore').set(w,l,x);return x;}};}),null);
__d('MercuryMessageClientState',[],(function a(b,c,d,e,f,g){var h={DO_NOT_SEND_TO_SERVER:'do_not_send_to_server',SEND_TO_SERVER:'send_to_server'};f.exports=h;}),null);
__d('MercuryDispatcher',['invariant','ArbiterMixin','LogHistory','MercuryActionType','MercuryPayloadSource','MercurySingletonProvider','MercuryThreadInformer','isEmpty','mixin'],(function a(b,c,d,e,f,g,h){'use strict';var i,j,k=c('LogHistory').getInstance('mercury_dispatcher');i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n;}l.prototype.handleUpdate=function(n){this.$MercuryDispatcher2(n);!!n.from_client!==!!n.preprocessed||h(0);delete n.preprocessed;if(!c('isEmpty')(n))c('MercuryThreadInformer').getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)this.inform('invalidate-global-state',{});if(n.payload_source===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform('invalidate-thread-state',o);}this.inform('update-thread-ids',n.newlyAddedClientIDs);this.inform('update-participants',n);this.inform('update-threads',n);this.inform('update-unread',n);this.inform('update-threadlist',n);this.inform('update-messages',n);this.inform('update-unseen',n);this.inform('update-typing-state',n);this.inform('update-delivery',n);this.inform('update-roger',n.roger);this.inform('update-blocked-users',n);this.inform('model-update-completed',null);}.bind(this));};l.prototype.$MercuryDispatcher2=function(n){var o=n.payload_source;if(o===c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS||o===c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN)return;var p={from_client:n.from_client,messages:null};if(n.actions){var q=n.actions.filter(function(r){return r.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE||r.action_type===c('MercuryActionType').LOG_MESSAGE;}).map(function(r){return {action_type:r.action_type,other_user_fbid:r.other_user_fbid,thread_fbid:r.thread_fbid,message_id:r.message_id};});if(q.length)p.messages=q;}k.debug('update:'+o,JSON.stringify(p));};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('EmojiLikeConstants',['EmojiStaticConfig'],(function a(b,c,d,e,f,g){'use strict';var h=c('EmojiStaticConfig').sizeMap,i={XSMALL:'xsmall',SMALL:'small',MEDIUM:'medium',LARGE:'large'},j={dp16:'xsmall',dp32:'small',dp64:'medium',db64:'medium',dp128:'large'},k={PICKER:'picker',HOT_LIKE:'hot_like'},l=[983040],m='hot_emoji_source',n='hot_emoji_size',o='emoji_like',p='\uD83D\uDC4D',q=[128077];f.exports={FB_THUMBS_UP_EMOJI:l,size:i,sizeMap:h,sizeMapTransfer:j,source:k,SOURCE_TAG_PREFIX:m,TAG_PREFIX_NEW:n,TAG_PREFIX_OLD:o,THUMBS_UP_EMOJI:p,THUMBS_UP_EMOJI_CODES:q};}),null);
__d('MercuryTagHelper',[],(function a(b,c,d,e,f,g){'use strict';var h={get:function i(j,k){var l=j.find(function(m){return m.startsWith(k);});return l&&l.substr(l.indexOf(':')+1);}};f.exports=h;}),null);
__d('EmojiLikeUtils',['EmojiLikeConstants','EmoticonEmojiList','MercuryTagHelper'],(function a(b,c,d,e,f,g){'use strict';function h(n,o){if(!n.tags){n.tags=[i(o)];}else n.tags.push(i(o));return n;}function i(n){var o=c('EmojiLikeConstants').TAG_PREFIX_NEW;return o+':'+n;}function j(n,o){if(!n.tags){n.tags=[k(o)];}else n.tags.push(k(o));return n;}function k(n){return c('EmojiLikeConstants').SOURCE_TAG_PREFIX+':'+n;}function l(n){return m(n)!=null;}function m(n){if(!n.tags)return null;var o=c('MercuryTagHelper').get(n.tags,c('EmojiLikeConstants').TAG_PREFIX_NEW);if(o)return o;return c('MercuryTagHelper').get(n.tags,c('EmojiLikeConstants').TAG_PREFIX_OLD);}f.exports={getEmojiSize:m,isEmojiLike:l,setEmojiSize:h,setEmojiSource:j};}),null);
__d('MercuryAttachment',['cx','EmojiLikeUtils','MercuryAttachmentContentType','MercuryAttachmentType','MercuryAudioType','Set','StoryAttachmentStyle'],(function a(b,c,d,e,f,g,h){'use strict';var i=function m(n){return n===Object(n);},j="_1c_u",k=new (c('Set'))([c('MercuryAttachmentType').ANIMATED_IMAGE,c('MercuryAttachmentType').PHOTO,c('MercuryAttachmentType').VIDEO,c('MercuryAttachmentType').THIRDPARTYSTICKER]),l={getAttachIconClass:function m(n){switch(n){case c('MercuryAttachmentContentType').PHOTO:return "_y2-";case c('MercuryAttachmentContentType').VIDEO:return "_y2_";case c('MercuryAttachmentContentType').MUSIC:return "_y30";case c('MercuryAttachmentContentType').VOICE:return "_y31";case c('MercuryAttachmentContentType').TEXT:return "_y32";case c('MercuryAttachmentContentType').MSWORD:return "_y33";case c('MercuryAttachmentContentType').MSXLS:return "_y34";case c('MercuryAttachmentContentType').MSPPT:return "_y35";}return "_y36";},getAttachIconClassByMime:function m(n){if(n.startsWith('image')){return "_y2-";}else if(n.startsWith('video')){return "_y2_";}else if(n.startsWith('audio')){return "_y30";}else if(n.startsWith('text/plain')){return "_y32";}else return "_y36";},getAttachTypeByMime:function m(n){if(n.startsWith('image')){return c('MercuryAttachmentContentType').PHOTO;}else if(n.startsWith('video')){return c('MercuryAttachmentContentType').VIDEO;}else if(n.startsWith('audio')){return c('MercuryAttachmentContentType').MUSIC;}else if(n.startsWith('text/plain')){return c('MercuryAttachmentContentType').TEXT;}else return c('MercuryAttachmentContentType').UNKNOWN;},convertRaw:function m(n){var o=[];for(var p=0;p<n.length;p++){var q=n[p];if(q.attach_type===c('MercuryAttachmentType').PHOTO){o.push(q);}else if(q.filename){var r=l.getAttachTypeByMime(q.filetype),s={};s.attach_type=c('MercuryAttachmentType').FILE;s.name=q.filename;s.icon_type=r;s.url='';o.push(s);}}return o;},get:function m(n){var o=[];if(n.attachments){o=n.attachments;}else if(n.raw_attachments)o=this.convertRaw(n.raw_attachments);var p=c('EmojiLikeUtils').getEmojiSize(n);if(p)o=o.concat([{attach_type:c('MercuryAttachmentType').EMOJI_LIKE,size:p}]);if(!(n.attachments&&n.attachments.length>0)){if(n.sticker_id)return o.concat([{attach_type:c('MercuryAttachmentType').STICKER}]);if(n.preview_attachments&&n.preview_attachments.length>0)return o.concat(n.preview_attachments);}return o;},resizeContain:function m(n,o){var p=n.width/n.height,q=o.width/o.height;if(q<p){return {width:Math.ceil(Math.min(n.height*q,o.width)),height:Math.ceil(Math.min(n.height,o.height))};}else return {width:Math.ceil(Math.min(n.width,o.width)),height:Math.ceil(Math.min(n.width/q,o.height))};},isBubblePreferred:function m(n){return this.isFileAttachment(n);},isPhotoAttachment:function m(n){return !!(n.attach_type==c('MercuryAttachmentType').PHOTO||n.attach_type==c('MercuryAttachmentType').ANIMATED_IMAGE||n.attach_type==c('MercuryAttachmentType').THIRDPARTYSTICKER||n.attach_type==c('MercuryAttachmentType').FILE&&n.preview_url);},isPhotoGroupAttachment:function m(n){return k.has(n.attach_type);},isSinglePhotoGroupAttachment:function m(n){return !!(n.attachments&&n.attachments.length===1&&n.attachments[0]&&this.isPhotoGroupAttachment(n.attachments[0]));},isVideoAttachment:function m(n){return n.attach_type==c('MercuryAttachmentType').VIDEO;},isShareAttachment:function m(n){return n.attach_type==c('MercuryAttachmentType').SHARE;},isFileAttachment:function m(n){return n.attach_type==c('MercuryAttachmentType').FILE;},isErrorAttachment:function m(n){return n.attach_type==c('MercuryAttachmentType').ERROR;},isStickerAttachment:function m(n){return n.attach_type==c('MercuryAttachmentType').STICKER;},isEmojiLikeAttachment:function m(n){return n.attach_type===c('MercuryAttachmentType').EMOJI_LIKE;},isVoiceAttachment:function m(n){if(!n.metadata)return false;return n.metadata.type===c('MercuryAudioType').AudioClip||n.metadata.type===c('MercuryAudioType').VoiceMessageWithTranscript;},hasAttribution:function m(n){return !!n.app_attribution;},isSingleVideoAttachment:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isVideoAttachment(p);}.bind(this));return o.length===1;},isSharedVideoAttachment:function m(n){var o=n.attach_type===c('MercuryAttachmentType').SHARE&&n.share&&n.share.subattachments&&n.share.subattachments[0];return !!(o&&o.target&&o.target.video_id);},isGenieSharedVideoAttachment:function m(n){return !!(n.attach_type===c('MercuryAttachmentType').SHARE&&n.share&&n.share.style_list.indexOf(c('StoryAttachmentStyle').GENIE_MESSAGE)>-1&&n.share.target&&n.share.target.attachment&&this.isSharedVideoAttachment(n.share.target.attachment));},isSharedVideoAttachmentMessage:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isSharedVideoAttachment(p)||this.isGenieSharedVideoAttachment(p);}.bind(this));return o.length===1;},getVideoElem:function m(n,o){var p=o.getMessageElement(n);if(!p)return null;var q=p.getElementsByClassName(j);return q&&q.length?q[0]:p;}};f.exports=l;}),null);
__d('ImageSourceType',[],(function a(b,c,d,e,f,g){var h={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};f.exports=h;}),null);
__d('ImageSourceRequest',['CurrentUser','ImageSourceType','KeyedCallbackManager','PhotoResizeModeConst','MercuryServerDispatcher','arrayContains'],(function a(b,c,d,e,f,g){function h(){'use strict';this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}h.prototype.setFBID=function(l){'use strict';this._request.fbid=l;return this;};h.prototype.setType=function(l){'use strict';if(!c('arrayContains')([c('ImageSourceType').PROFILE_PICTURE,c('ImageSourceType').IMAGE],l))throw new TypeError('ImageSourceRequest.setType: invalid type '+l);this._request.type=l;return this;};h.prototype.setDimensions=function(l,m){'use strict';this._request.width=l;this._request.height=m;return this;};h.prototype.setResizeMode=function(l){'use strict';if(!c('arrayContains')([c('PhotoResizeModeConst').COVER,c('PhotoResizeModeConst').CONTAIN],l))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+l);this._request.resize_mode=l;return this;};h.prototype.setCallback=function(l){'use strict';this._callback=l;return this;};h.prototype.send=function(){'use strict';if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c('MercuryServerDispatcher').trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;};var i=null;function j(){if(i)return i;var l=new (c('KeyedCallbackManager'))();i=l;c('MercuryServerDispatcher').registerEndpoints({'/ajax/image_source.php':{request_user_id:c('CurrentUser').getID(),mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,batch_function:function m(n,o){var p;(p=n.requests).push.apply(p,o.requests);return n;},handler:function m(n,o){var p=o.getData().requests;for(var q=0;q<p.length;++q)l.setResource(k(p[q]),n[q]);}}});return l;}function k(l){return [l.fbid,l.type,l.width,l.height,l.resize_mode].join('|');}f.exports=h;}),null);
__d('MercurySendErrorLogger',['Banzai','BanzaiLogger'],(function a(b,c,d,e,f,g){var h=c('BanzaiLogger').create({retry:true}),i=c('Banzai').isEnabled('mercury_send_error_logging'),j={log:function k(l){if(!i)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};h.log('MercurySendErrorLoggerConfig',m);}};f.exports=j;}),null);
__d('MercuryServerPayloadPreprocessor',['invariant','MessengerEnvironment','MercuryIDs','MercuryConfig','MercuryActionStatus','MercuryActionType','MercuryAttachment','MercuryDispatcher','MercurySendErrorLogger','MercurySingletonProvider','MercuryThreadIDMap','URI'],(function a(b,c,d,e,f,g,h){'use strict';function i(k){this.$MercuryServerPayloadPreprocessor1=k;this.$MercuryServerPayloadPreprocessor2=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c('MercuryDispatcher').getForFBID(this.$MercuryServerPayloadPreprocessor1);}i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};i.prototype.handleUpdate=function(k){var l={};!k.from_client||h(0);(k.threads||[]).forEach(function(x){this.$MercuryServerPayloadPreprocessor4(x,l);var y=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(x.thread_id);e(['MercuryServerRequests'],function(z){var aa=z.getForFBID(this.$MercuryServerPayloadPreprocessor1);aa.markThreadFetched(x.thread_id);if(y)aa.markThreadFetched(y);aa.updateLastActionTimestamp(x.timestamp);}.bind(this));}.bind(this));(k.ordered_threadlists||[]).forEach(function(x){var y=x.thread_fbids||[];y=y.concat(x.other_user_fbids||[]);x.thread_ids=y.map(function(z){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(z.toString());}.bind(this));}.bind(this));if(k.pinned_threads&&k.pinned_threads.thread_fbids)k.pinned_threads.thread_fbids=k.pinned_threads.thread_fbids.map(function(x){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);}.bind(this));if(k.delivery_receipts){var m={};for(var n=k.delivery_receipts,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q,s=r.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(r.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(r.thread_fbid);if(s)m[s]=r.time;}k.delivery_receipts=m;}k.actions=k.actions||[];k.actions.forEach(function(x){if(x.action_type===c('MercuryActionType').SEND_MESSAGE&&x.status===c('MercuryActionStatus').ERROR)c('MercurySendErrorLogger').log(x);var y=null,z=null;if(x.other_user_fbid){z=c('MercuryIDs').getThreadIDFromUserID(x.other_user_fbid);y=x.other_user_fbid;}else if(x.thread_fbid){z=c('MercuryIDs').getThreadIDFromThreadFBID(x.thread_fbid);y=x.thread_fbid;}else if(x.thread_id){z=c('MercuryIDs').getThreadIDFromThreadFBID(x.thread_id);y=x.thread_id;}else if(x.status&&x.status!=c('MercuryActionStatus').SUCCESS&&x.client_thread_id){z=x.client_thread_id;}else h(0);y=y&&y.toString();x.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(y)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(y):z;if(x.action_type==c('MercuryActionType').SEND_MESSAGE&&x.client_thread_id&&y){x.thread_id=x.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(y,x.client_thread_id);l[y]=x.client_thread_id;}x.thread_id||h(0);if(!k.payload_source||!k.payload_source.startsWith('server'))e(['MercuryServerRequests'],function(aa){aa.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(x.timestamp);}.bind(this));}.bind(this));this.$MercuryServerPayloadPreprocessor5(k);this.$MercuryServerPayloadPreprocessor6(k);if(k.end_of_history){var t=[];for(var u=0;u<k.end_of_history.length;u++){var v=k.end_of_history[u];if(v.type=='user'){t.push('user:'+v.fbid);}else if(v.type=='thread'&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(v.fbid))t.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v.fbid));}k.end_of_history=t;}if(k.roger){var w={};Object.keys(k.roger).forEach(function(x){var y=Object.keys(k.roger[x]),z=void 0;if(x){z=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);}else if(y.length===1)z=c('MercuryIDs').getThreadIDFromUserID(y[0]);if(z){var aa=k.roger[x];w[z]={};for(var ba in aa)if(Object.prototype.hasOwnProperty.call(aa,ba)){var ca=c('MercuryIDs').getParticipantIDFromUserID(ba);w[z][ca]=aa[ba];}}}.bind(this));k.roger=w;}k.newlyAddedClientIDs=l;k.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(k);};i.prototype.$MercuryServerPayloadPreprocessor4=function(k,l){var m=k.other_user_fbid?k.other_user_fbid:k.thread_fbid;m||h(0);var n=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(m);if(!n){n=k.other_user_fbid?c('MercuryIDs').getThreadIDFromUserID(k.other_user_fbid):c('MercuryIDs').getThreadIDFromThreadFBID(k.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(m,n);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(k.thread_id,n);l[m]=n;}k.thread_id=n;};i.prototype.$MercuryServerPayloadPreprocessor5=function(k){k.actions.forEach(function(l){if(l.action_type===c('MercuryActionType').USER_GENERATED_MESSAGE){l.attachments=l.attachments||[];l.attachments.forEach(function(m){if(c('MercuryAttachment').isShareAttachment(m)&&c('MessengerEnvironment').messengerui){var n=new (c('URI'))(m.share.uri);if(!n.getDomain())m.share.uri=n.setDomain('facebook.com').setSubdomain(c('URI').getRequestURI().getSubdomain()).setProtocol('https').toString();}});}});};i.prototype.$MercuryServerPayloadPreprocessor6=function(k){k.actions.forEach(function(l){if(l.action_type!==c('MercuryActionType').USER_GENERATED_MESSAGE)return;var m=l;if(!m.has_attachment||!m.attachments)return;for(var n=m.attachments.length-1;n>=0;n-=1){var o=m.attachments[n];if(!o.share||!o.share.style_list||o.share.style_list[0]!='genie_message')continue;if(o.share.target.genie_id)m.author=c('MercuryIDs').getParticipantIDFromUserID(o.share.target.genie_id);if(o.share.target&&!o.share.target.attachment){m.attachments.splice(n,1);m.has_attachment=m.attachments.length>0;}}});};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryMessageIDs',['KeyedCallbackManager'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('KeyedCallbackManager'))(),i={getServerIDs:function j(k,l){var m=k.filter(function(o){return o.indexOf('id')===-1;}),n=function o(p){var q=k.map(function(r){return p[r]?p[r]:r;});l(q);};return h.executeOrEnqueue(m,n);},addServerID:function j(k,l){h.setResource(k,l);}};f.exports=i;}),null);
__d('MercuryServerSendMessageQueueOptions',[],(function a(b,c,d,e,f,g){function h(i,j,k,l,m,n){'use strict';this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n;}f.exports=h;}),null);
__d('MercuryServerSendMessageQueueSimulatedError',['AsyncRequest','AsyncResponse'],(function a(b,c,d,e,f,g){var h=9999,i={create:function j(k){var l=new (c('AsyncRequest'))(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new (c('AsyncResponse'))(l,{});Object.assign(m,{error:h,silentError:false,transientError:true,request:l});return m;}};f.exports=i;}),null);
__d("XMessagingSendController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/send\/",{});}),null);
__d('MercuryServerSendMessageQueue',['BanzaiODS','LogHistory','MercuryLoggingHelper','MercuryServerRequestsConfig','MercuryServerDispatcher','MercuryServerSendMessageQueueSimulatedError','XMessagingSendController'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('mercury_server_send_message_queue');function i(j,k,l,m){var n;'use strict';this.pending_message=null;this.queue=[];this.sender_id=j;this.queue_id=k;this.$MercuryServerSendMessageQueue2=l.success_handler;this.$MercuryServerSendMessageQueue1=l.error_handler;this.$MercuryServerSendMessageQueue4=l.transport_error_handler;this.$MercuryServerSendMessageQueue3=l.timeout_handler;this.client=m;var o=null;if(c('MercuryServerRequestsConfig').msgrRegion)o={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var p=c('XMessagingSendController').getURIBuilder().getURI().toString(),q=(n={},n[p]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:o,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:l.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:l.connection_retries},n);c('MercuryServerDispatcher').registerEndpoints(q);}i.prototype.enqueue=function(j){'use strict';this.queue.push(j);this.$MercuryServerSendMessageQueue5();};i.prototype.$MercuryServerSendMessageQueue5=function(){'use strict';if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue6();return;}this.pending_message=this.queue.shift();var j={client:this.client,action_type:this.pending_message.action_type,app_id:this.pending_message.app_id,audio_ids:this.pending_message.audio_ids,body:this.pending_message.body,client_thread_id:this.pending_message.client_thread_id,content_attachment:this.pending_message.content_attachment,ephemeral_ttl_mode:this.pending_message.ephemeral_ttl_mode,file_ids:this.pending_message.file_ids,gif_ids:this.pending_message.gif_ids,has_attachment:this.pending_message.has_attachment,image_ids:this.pending_message.image_ids,location_attachment:this.pending_message.location_attachment,lightweight_action_attachment:this.pending_message.lightweight_action_attachment,log_message_data:this.pending_message.log_message_data,log_message_type:this.pending_message.log_message_type,message_id:this.pending_message.message_id,message_source_data:this.pending_message.message_source_data,offline_threading_id:this.pending_message.offline_threading_id,other_user_fbid:this.pending_message.other_user_fbid,photo_fbids:this.pending_message.photo_fbids,shareable_attachment:this.pending_message.shareable_attachment,signature_id:this.pending_message.signatureID,source:this.pending_message.source,specific_to_list:this.pending_message.specific_to_list,sticker_id:this.pending_message.sticker_id,tags:this.pending_message.tags,thread_fbid:this.pending_message.thread_fbid,timestamp:this.pending_message.timestamp,ui_push_phase:this.pending_message.ui_push_phase,video_ids:this.pending_message.video_ids,platform_xmd:this.pending_message.platform_xmd,profile_xmd:this.pending_message.profile_xmd};for(var k in j)if(j[k]===undefined||j[k]===null)delete j[k];c('MercuryServerDispatcher').trySend(c('XMessagingSendController').getURIBuilder().getURI().toString(),j,null,this.sender_id,this.queue_id);};i.prototype.$MercuryServerSendMessageQueue7=function(){'use strict';while(this.queue.length)this.$MercuryServerSendMessageQueue8(this.queue.shift());};i.prototype.$MercuryServerSendMessageQueue8=function(j){'use strict';this.$MercuryServerSendMessageQueue1(c('MercuryServerSendMessageQueueSimulatedError').create(j));h.error('mark_as_failed',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c('MercuryLoggingHelper').obfuscateMessage(j)}));};i.prototype.handleSuccess=function(j,k){'use strict';this.$MercuryServerSendMessageQueue2(j,k);this.pending_message=null;this.$MercuryServerSendMessageQueue5();};i.prototype.handleError=function(j){'use strict';this.$MercuryServerSendMessageQueue1(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.handleTransportError=function(j){'use strict';this.$MercuryServerSendMessageQueue4(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.handleTimeout=function(j){'use strict';this.$MercuryServerSendMessageQueue3(j);this.$MercuryServerSendMessageQueue7();this.pending_message=null;};i.prototype.$MercuryServerSendMessageQueue6=function(){'use strict';h.debug('maybe_send_next_pending_message',JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c('MercuryLoggingHelper').obfuscateMessage(this.pending_message),queue:this.queue.map(function(k){return c('MercuryLoggingHelper').obfuscateMessage(k);})}));var j='send_queue.delayed.queue_length.'+this.queue.length.toString();c('BanzaiODS').bumpEntityKey('chat.web',j);};f.exports=i;}),null);
__d('MercurySingletonMixin',['CurrentUser'],(function a(b,c,d,e,f,g){var h={_getInstances:function i(){if(!this._instances)this._instances={};return this._instances;},get:function i(){return this.getForFBID(c('CurrentUser').getID());},getForFBID:function i(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j];}};f.exports=h;}),null);
__d('MercuryServerSendMessageQueueRouter',['BanzaiODS','LogHistory','Map','MercuryServerSendMessageQueue','MercurySingletonMixin'],(function a(b,c,d,e,f,g){var h=c('LogHistory').getInstance('mercury_server_send_message_queue_router'),i='chat.web.send_queue_router';c('BanzaiODS').setEntitySample(i,.1);function j(k){'use strict';this.queues=new (c('Map'))();this.fbid=k;}j.prototype.enqueue=function(k,l,m,n){'use strict';var o=this.queues.get(k);if(o===undefined){o=new (c('MercuryServerSendMessageQueue'))(this.fbid,k,l,m);this.queues.set(k,o);h.debug('added queue',JSON.stringify({fbid:this.fbid,queue_id:k}));c('BanzaiODS').bumpEntityKey(i,'new_queue');}o.enqueue(n);};Object.assign(j,c('MercurySingletonMixin'));f.exports=j;}),null);
__d('MercurySyncConstants',[],(function a(b,c,d,e,f,g){'use strict';var h={ARBITER_EVENT_INVALID_STATE:'SYNC:INVALID_STATE',ARBITER_EVENT_INVALID_STATE_RETRY:'SYNC:INVALID_STATE_RETRY',ARBITER_EVENT_INVALID_STATE_RECOVER:'SYNC:INVALID_STATE_RECOVER',ARBITER_EVENT_SERVER_REQUESTS_FAIL:'NET:SERVER_REQUESTS_FAIL',ARBITER_EVENT_SERVER_REQUESTS_RECOVER:'NET:SERVER_REQUESTS_RECOVER'};f.exports=h;}),null);
__d('MercurySyncDeltaHolder',['Map','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';function h(){this.$MercurySyncDeltaHolder2=new (c('Map'))();this.$MercurySyncDeltaHolder3=[];this.$MercurySyncDeltaHolder1=0;}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.peek=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(j,k){return j-k;});return this.$MercurySyncDeltaHolder3[0];};h.prototype.pop=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(l,m){return l-m;});if(this.$MercurySyncDeltaHolder3.length===0)return undefined;var j=this.$MercurySyncDeltaHolder3.shift(),k=this.$MercurySyncDeltaHolder2.get(j);this.$MercurySyncDeltaHolder2['delete'](j);return {seqID:j,delta:k};};h.prototype.push=function(j,k){if(this.$MercurySyncDeltaHolder2.has(j))return;this.$MercurySyncDeltaHolder2.set(j,k);this.$MercurySyncDeltaHolder3.push(j);};h.prototype.getLastSeqID=function(){return this.$MercurySyncDeltaHolder1;};h.prototype.updateLastSeqID=function(j){this.$MercurySyncDeltaHolder1=j;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d("XMercuryUnseenThreadIDsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/unseen_thread_ids\/",{});}),null);
__d("XMessagingChangeMentionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/mercury\/change_mentions_mute_thread\/",{});}),null);
__d("XMessagingChangeReactionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/mercury\/change_reactions_mute_thread\/",{});}),null);
__d('MercuryServerRequests',['errorCode','invariant','Arbiter','AsyncResponse','BanzaiODS','ChannelConstants','ChatReliabilityInstrumentation','CurrentUser','FBID','LogHistory','MercuryActionStatus','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryConfig','MercuryDispatcher','MercuryErrorType','MercuryGlobalActionType','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySendErrorLogger','MercuryServerPayloadPreprocessor','MercuryServerRequestsConfig','MercuryServerSendMessageQueueRouter','MercuryServerURIs','MercurySingletonProvider','MercurySourceType','MercurySyncDeltaHolder','MercurySyncConstants','MercuryThreadIDMap','MercuryThreadlistConstants','MercuryMessageIDs','MessagingConfig','MessagingTag','PageMessageEnumTag','MercuryServerSendMessageQueueOptions','MercuryServerDispatcher','Set','XMercuryUnseenThreadIDsController','XMessagingChangeMentionsMuteModeController','XMessagingChangeReactionsMuteModeController','createObjectFrom','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('LogHistory').getInstance('mercury_server'),k=c('MercuryAPIArgsSource').MERCURY,l=1000,m=30*1000;function n(y){return y.getError()?'_'+y.getError():'';}function o(y,z){var aa=babelHelpers['extends']({},y),ba=void 0;if(z.threads){if(!aa.threads)aa.threads={};for(ba in z.threads)aa.threads[ba]=Object.keys(c('createObjectFrom')((aa.threads[ba]||[]).concat(z.threads[ba]||[])));}if(z.messages){if(!aa.messages)aa.messages={};for(ba in z.messages){if(!aa.messages[ba])aa.messages[ba]={};for(var ca in z.messages[ba])if(aa.messages[ba][ca]){aa.messages[ba][ca]=s(aa.messages[ba][ca],z.messages[ba][ca]);}else aa.messages[ba][ca]=z.messages[ba][ca];}}aa.client=y.client||z.client;return aa;}function p(y,z){var aa=Object.assign(c('createObjectFrom')(y.folders,true),c('createObjectFrom')(z.folders,true)),ba=y.client||z.client;return {folders:Object.keys(aa),client:ba};}function q(y,z){for(var aa in z)if(y[aa]&&typeof y[aa]==='object'){y[aa]=s(y[aa],z[aa]);}else if(z[aa]&&typeof z[aa]==='object'){var ba={};Object.assign(ba,z[aa]);y[aa]=ba;}return y;}function r(y,z){return z;}function s(y,z){var aa=y.offset<z.offset?y.offset:z.offset,ba=y.offset+y.limit,ca=z.offset+z.limit,da=ba>ca?ba:ca,ea=da-aa,fa=y.timestamp>z.timestamp?y.timestamp:z.timestamp;return {offset:aa,limit:ea,timestamp:fa};}function t(y,z){var aa=y.client||z.client,ba={ids:{},client:aa};Object.assign(ba.ids,y.ids,z.ids);return ba;}function u(y,z){var aa={},ba=void 0,ca=y.client||z.client;delete y.client;delete z.client;for(ba in y)Object.assign(aa,c('createObjectFrom')(y[ba],ba));for(ba in z)Object.assign(aa,c('createObjectFrom')(z[ba],ba));var da={client:ca};for(var ea in aa){ba=aa[ea];if(!da[ba])da[ba]=[];da[ba].push(ea);}return da;}function v(y,z){var aa=y.client||z.client,ba=c('createObjectFrom')(y.ids,true),ca=c('createObjectFrom')(z.ids,true),da=Object.assign(ba,ca);return {ids:Object.keys(da),client:aa};}function w(y){this.$MercuryServerRequests1=y;this.$MercuryServerRequests2=0;this.$MercuryServerRequests3={};this.$MercuryServerRequests4={};this.$MercuryServerRequests9=new (c('Set'))();this.__threadIDMap=c('MercuryThreadIDMap').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests5=c('MercuryDispatcher').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests6=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests7=new (c('MercuryServerSendMessageQueueOptions'))(function(z,aa){this.__handleUpdate(z,aa);}.bind(this),function(z){return this.$MercuryServerRequests10(z);}.bind(this),function(z){this.$MercuryServerRequests11(z);}.bind(this),function(z){return this.$MercuryServerRequests12(z);}.bind(this),c('MercuryServerRequestsConfig').sendMessageTimeout,c('MessagingConfig').SEND_CONNECTION_RETRIES);this.$MercuryServerRequests8=c('MercurySyncDeltaHolder').getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests13();}w.getForFBID=function(y){return x.getForFBID(y);};w.get=function(){return x.get();};w.prototype.fetchThreadlistInfo=function(y,z){var aa=arguments.length<=2||arguments[2]===undefined?c('MessagingTag').INBOX:arguments[2],ba=arguments[3],ca=arguments.length<=4||arguments[4]===undefined?k:arguments[4],da=ba?c('MercuryServerDispatcher').IMMEDIATE:null,ea={client:ca};ea[aa]={offset:y,limit:z,filter:ba};this.__sendRequest(c('MercuryServerURIs').THREADLIST_INFO,ea,da);};w.prototype.fetchUnseenThreadIDs=function(){var y=arguments.length<=0||arguments[0]===undefined?c('MessagingTag').INBOX:arguments[0],z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c('XMercuryUnseenThreadIDsController').getURIBuilder().getURI().toString(),{});};w.prototype.fetchUnreadThreadIDs=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c('MercuryServerURIs').UNREAD_THREADS,{folders:[y],client:z});};w.prototype.fetchThreadData=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];c('MercuryAssert').allThreadID(y);var aa={threads:{},client:z},ba=[],ca=[];y.forEach(function(ea){if(this.$MercuryServerRequests3[ea])return;this.$MercuryServerRequests3[ea]=true;var fa=this.__threadIDMap.getServerIDFromClientIDNow(ea),ga=c('MercuryIDs').tokenize(ea);if(ga.type=='user'){ba.push(ga.value);aa.threads.user_ids=ba;}else if(ga.type=='thread'){if(fa){ca.push(fa);}else ca.push(ga.value);aa.threads.thread_fbids=ca;}else if(ga.type=='root'){if(fa){ca.push(fa);aa.threads.thread_fbids=ca;}}else if(ga.type!='pending')throw new Error('Unknown thread type',ga);}.bind(this));this.$MercuryServerRequests5.inform('fetch-thread-data',aa);if(aa.threads.user_ids)aa.threads.user_ids.forEach(function(ea){if(!ea){j.error('empty user id',JSON.stringify(ba));c('ChatReliabilityInstrumentation').logERROR('Invalid user ID sent to thread_info.php: '+JSON.stringify(ba));}});if(aa.threads.thread_fbids)aa.threads.thread_fbids.forEach(function(ea){if(!ea)c('ChatReliabilityInstrumentation').logERROR('Invalid FBID sent to thread_info.php: '+JSON.stringify(y));});for(var da in aa.threads){this.__sendRequest(c('MercuryServerURIs').THREAD_INFO,aa);break;}};w.prototype.ensureThreadIsFetched=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!this.__threadIDMap.getClientIDFromServerIDNow(y)&&!this.$MercuryServerRequests3[y]){if(!y){c('ChatReliabilityInstrumentation').logERROR('Ensure invalid FBID sent to thread_info.php');j.error('attempting to fetch empty thread_fbid. Bad idea!');return;}this.$MercuryServerRequests3[y]=true;this.__sendRequest(c('MercuryServerURIs').THREAD_INFO,{threads:{thread_fbids:[y]},client:z});}};w.prototype.fetchThreadMessages=function(y,z,aa,ba,ca){var da=arguments.length<=5||arguments[5]===undefined?k:arguments[5];c('MercuryAssert').isThreadID(y);var ea=void 0,fa=void 0,ga=c('MercuryIDs').tokenize(y),ha=this.__threadIDMap.getServerIDFromClientIDNow(y),ia=false;if(ha){ea=ha;fa=ga.type=='user'?'user_ids':'thread_fbids';}else{ea=ga.value;switch(ga.type){case 'user':fa='user_ids';ia=true;break;case 'thread':fa='thread_fbids';break;}}var ja={messages:{},threads:{},client:da};if(fa){ja.messages[fa]={};ja.messages[fa][ea]={offset:z,timestamp:ba,limit:aa};if(ia)ja.threads[fa]=[ea];this.__sendRequest(c('MercuryServerURIs').THREAD_INFO,ja,ca);}else this.__threadIDMap.getServerIDFromClientID(y,function(ka){ja.messages.thread_fbids={};ja.messages.thread_fbids[ka]={offset:z,timestamp:ba,limit:aa};this.__sendRequest(c('MercuryServerURIs').THREAD_INFO,ja,ca);}.bind(this));};w.prototype.handleThreadInfoError=function(y){var z,aa=this,ba=y.getData(),ca=[];if(ba.messages){for(var da in ba.messages.thread_fbids){var ea=this.__threadIDMap.getClientIDFromServerIDNow(da);if(ea)ca.push(this.$MercuryServerRequests14(ea));}for(var fa in ba.messages.user_ids)ca.push(this.$MercuryServerRequests14('user:'+fa));for(var ga in ba.messages.group_ids)ca.push(this.$MercuryServerRequests14('group:'+ga));}if(ca.length)this.$MercuryServerRequests5.handleUpdate({actions:ca,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE});if(ba.threads&&(ba.threads.user_ids||ba.threads.thread_fbids||ba.threads.group_ids||ba.threads.thread_ids)){var ha=5,ia=true;if(!ba.retry_count){ba.retry_count=0;if(ba.messages)delete ba.messages;}else if(ba.retry_count>=ha&&!c('MercuryConfig').MR4E){ia=false;(ba.threads.thread_ids||[]).concat(ba.threads.thread_fbids||[]).forEach(function(ka){if(ka in this.$MercuryServerRequests3)delete this.$MercuryServerRequests3[ka];},this);}[].concat(ba.threads.thread_ids||[],ba.threads.thread_fbids||[],ba.threads.user_ids||[],ba.threads.group_ids||[]).forEach(function(ka){if(ka){this.$MercuryServerRequests9.add(ka);}else c('ChatReliabilityInstrumentation').logERROR('lost a thread id somehow');}.bind(this));if(ia){var ja=Math.pow(2,Math.min(ba.retry_count,ha))*1000;c('setTimeoutAcrossTransitions')(function(){j.log('retry_thread','{}');this.__sendRequest(c('MercuryServerURIs').THREAD_INFO,ba);}.bind(this),ja);ba.retry_count++;}if(this.$MercuryServerRequests9.size)(function(){var ka=[];aa.$MercuryServerRequests9.forEach(function(la){return ka.push(la);});j.debug('failed threads',JSON.stringify(ka));c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_SERVER_REQUESTS_FAIL,ka);})();}};w.prototype.markFolderAsRead=function(y){this.__sendRequest(c('MercuryServerURIs').MARK_FOLDER_READ,{folder:y});var z=[{action_type:c('MercuryGlobalActionType').MARK_ALL_READ,folder:y}];this.$MercuryServerRequests5.handleUpdate({global_actions:z,from_client:true,payload_source:c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS});};w.prototype.changeThreadReadStatus=function(y,z,aa,ba,ca,da){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(ea){var fa,ga={ids:(fa={},fa[ea]=z,fa),source:aa,watermarkTimestamp:ba,shouldSendReadReceipt:ca,commerce_last_message_type:da};j.log('initiate_change_read_status',JSON.stringify({thread_id:y,thread_fbid:ea,mark_as_read:z,watermarkTimestamp:ba}));this.__sendRequest(c('MercuryServerURIs').CHANGE_READ_STATUS,ga);}.bind(this));};w.prototype.changeThreadArchivedStatus=function(y,z,aa){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(ba){var ca={ids:{},source:aa};ca.ids[ba]=z;this.__sendRequest(c('MercuryServerURIs').CHANGE_ARCHIVED_STATUS,ca);}.bind(this));};w.prototype.changeThreadFolder=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={};ba[z]=[aa];this.__sendRequest(c('MercuryServerURIs').MOVE_THREAD,ba);}.bind(this));};w.prototype.changeMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('MercuryServerURIs').CHANGE_MUTE_THREAD,{thread_fbid:aa,mute_settings:z,payload_source:k});}.bind(this));};w.prototype.changeMentionsMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('XMessagingChangeMentionsMuteModeController').getURIBuilder().getURI(),{thread_fbid:aa,mentions_mute_mode:z,payload_source:k});}.bind(this));};w.prototype.changeReactionsMutingOnThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('XMessagingChangeReactionsMuteModeController').getURIBuilder().getURI(),{thread_fbid:aa,reactions_mute_mode:z,payload_source:k});}.bind(this));};w.prototype.markThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('MercuryServerURIs').MARK_SPAM,{id:aa,source:z});}.bind(this));};w.prototype.unmarkThreadSpam=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){this.__sendRequest(c('MercuryServerURIs').UNMARK_SPAM,{id:aa,source:z});}.bind(this));};w.prototype.deleteThread=function(y,z){c('MercuryAssert').isThreadID(y);this.__threadIDMap.getServerIDFromClientID(y,function(aa){var ba={ids:[aa],source:z};this.__sendRequest(c('MercuryServerURIs').DELETE_THREAD,ba);}.bind(this));};w.prototype.deleteMessages=function(y,z){c('MercuryMessageIDs').getServerIDs(z||[],function(aa){this.__sendRequest(c('MercuryServerURIs').DELETE_MESSAGES,{message_ids:aa});}.bind(this));};w.prototype.sendDeliveryReceipts=function(y,z){c('MercuryMessageIDs').getServerIDs(y||[],function(aa){this.__sendRequest(c('MercuryServerURIs').DELIVERY_RECEIPTS,{message_ids:aa,thread_ids:z});}.bind(this));};w.prototype.sendNewMessage=function(y){var z=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!y.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','missing_otid_on_send');if(y.client_state&&y.client_state!==c('MercuryMessageClientState').SEND_TO_SERVER)return;var aa=c('MercuryIDs').tokenize(y.thread_id),ba=aa.type,ca=babelHelpers['extends']({},y);ca.thread_id=null;if(ba=='user'){ca.other_user_fbid=aa.value;this.$MercuryServerRequests15(ca,z);}else if(ba=='thread'){ca.thread_fbid=aa.value;this.$MercuryServerRequests15(ca,z);}else if(ba=='root'&&aa.value==ca.offline_threading_id){ca.client_thread_id=y.thread_id;this.$MercuryServerRequests15(ca,z);}else{c('MercuryIDs').isLocalThread(y.thread_id)||i(0);this.__threadIDMap.getServerIDFromClientID(y.thread_id,function(da){ca.thread_fbid=da;this.$MercuryServerRequests15(ca,z);}.bind(this));}};w.prototype.$MercuryServerRequests15=function(y,z){c('Arbiter').inform(c('ChannelConstants').ATTEMPT_RECONNECT);this.$MercuryServerRequests4[y.message_id]=Date.now();c('MercuryServerSendMessageQueueRouter').getForFBID(this.$MercuryServerRequests1).enqueue(y.other_user_fbid||y.thread_fbid||y.client_thread_id,this.$MercuryServerRequests7,z,y);};w.prototype.markSeen=function(){var y=this.$MercuryServerRequests2;this.__sendRequest(c('MercuryServerURIs').MARK_SEEN,{seen_timestamp:y});};w.prototype.$MercuryServerRequests16=function(y,z,aa,ba){var ca=y.getData(),da=ca.message_batch||[ca];j.debug('handle_send_message_error_common',JSON.stringify({reliability_error_status:aa,request_error_status:z,error_data:ba,message_list:da}));var ea=da.map(function(ga){var ha={action_type:c('MercuryActionType').SEND_MESSAGE,other_user_fbid:ga.other_user_fbid,thread_fbid:ga.thread_fbid,client_message_id:ga.message_id,message_id:ga.message_id,client_thread_id:ga.client_thread_id,status:z,error_data:ba};return ha;});ea.forEach(function(ga){if(ga.action_type===c('MercuryActionType').SEND_MESSAGE&&ga.status===c('MercuryActionStatus').ERROR)this.__logMercurySendError(ga);},this);var fa={actions:ea,payload_source:c('MercuryPayloadSource').CLIENT_HANDLE_ERROR};this.$MercuryServerRequests6.handleUpdate(fa);};w.prototype.handleSendMessageError=function(y){var z=y.getPayload(),aa=null,ba=null;if(z&&z.error_payload){aa=c('MercuryActionStatus').UNCONFIRMED;ba='send_error';}else{aa=c('MercuryActionStatus').ERROR;ba='request_error'+n(y);}var ca=y.error;if(ca===1404102)c('AsyncResponse').verboseErrorHandler(y);var da=/<.*>/.test(y.getErrorDescription())?y.getErrorSummary():y.getErrorDescription();this.$MercuryServerRequests16(y.getRequest(),aa,ba,{type:c('MercuryErrorType').SERVER,code:y.getError(),description:da,is_transient:y.isTransient()});};w.prototype.handleSendMessageTransportError=function(y){this.$MercuryServerRequests16(y.getRequest(),c('MercuryActionStatus').ERROR,'transport_error'+n(y),{type:c('MercuryErrorType').TRANSPORT,code:y.getError(),is_transient:true});};w.prototype.handleSendMessageTimeout=function(y){this.$MercuryServerRequests16(y,c('MercuryActionStatus').ERROR,'transport_timeout',{type:c('MercuryErrorType').TIMEOUT,is_transient:true});};w.prototype.getLastActionTimestamp=function(){return this.$MercuryServerRequests2;};w.prototype.__logMercurySendError=function(y){c('MercurySendErrorLogger').log(y);};w.prototype.updateLastActionTimestamp=function(y){var z=Date.now()-1000*60*60*24;if(y&&y>z)this.$MercuryServerRequests2=Math.max(this.$MercuryServerRequests2,y);};w.prototype.markThreadFetched=function(y){delete this.$MercuryServerRequests3[y];if(this.$MercuryServerRequests9['delete'](y)&&!this.$MercuryServerRequests9.size){j.debug('no_failed_threads','{}');c('Arbiter').inform(c('MercurySyncConstants').ARBITER_EVENT_SERVER_REQUESTS_RECOVER);}};w.prototype.$MercuryServerRequests14=function(y){return {action_type:c('MercuryActionType').LOG_MESSAGE,thread_id:y,message_id:y,timestamp:Date.now(),is_unread:false,source:c('MercurySourceType').UNKNOWN,log_message_body:'',log_message_type:c('MercuryLogMessageType').SERVER_ERROR,log_message_data:{}};};w.prototype.__getForAsyncRequest=function(y){var z=y.getData(),aa=z.request_user_id?z.request_user_id:c('CurrentUser').getID();return w.getForFBID(aa);};w.prototype.__handleUpdate=function(y,z){this.__getForAsyncRequest(z).$MercuryServerRequests6.handleUpdate(y);};w.prototype.$MercuryServerRequests17=function(y){var z=this.__getForAsyncRequest(y);z.handleThreadInfoError(y);};w.prototype.$MercuryServerRequests10=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageError(y);};w.prototype.$MercuryServerRequests11=function(y){var z=this.__getForAsyncRequest(y.getRequest());z.handleSendMessageTransportError(y);};w.prototype.$MercuryServerRequests12=function(y){var z=this.__getForAsyncRequest(y);z.handleSendMessageTimeout(y);};w.prototype.$MercuryServerRequests13=function(){var y,z=null;if(c('MercuryServerRequestsConfig').msgrRegion)z={name:'X-MSGR-Region',value:c('MercuryServerRequestsConfig').msgrRegion};var aa=(y={},y[c('MercuryServerURIs').THREAD_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_DEFERRED_MULTI,customHeader:z,batch_function:o,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this),error_handler:function(ea){return this.$MercuryServerRequests17(ea.getRequest());}.bind(this),timeout_handler:function(ea){return this.$MercuryServerRequests17(ea);}.bind(this),timeout:m},y[c('MercuryServerURIs').MARK_FOLDER_READ]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').CHANGE_READ_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){this.__handleUpdate(ea,fa);var ga=(ea.threads||[]).map(function(ha){return ha&&ha.thread_id;});j.log('response_change_read_status',JSON.stringify({threads:ga}));}.bind(this)},y[c('MercuryServerURIs').MARK_SEEN]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:z,batch_function:r,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').THREADLIST_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:z,batch_function:q,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').MARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').UNMARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').UNREAD_THREADS]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE_UNIQUE,customHeader:z,batch_function:p,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').CHANGE_ARCHIVED_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:z,batch_function:t,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').DELETE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:z,batch_function:v,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').DELETE_MESSAGES]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').DELIVERY_RECEIPTS]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').MOVE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').BATCH_SUCCESSIVE,customHeader:z,batch_function:u,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y[c('MercuryServerURIs').CHANGE_MUTE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)},y),ba=c('XMercuryUnseenThreadIDsController').getURIBuilder().getURI().toString();aa[ba]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)};var ca=c('XMessagingChangeMentionsMuteModeController').getURIBuilder().getURI().toString();aa[ca]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)};var da=c('XMessagingChangeReactionsMuteModeController').getURIBuilder().getURI().toString();aa[da]={request_user_id:this.$MercuryServerRequests1,mode:c('MercuryServerDispatcher').IMMEDIATE,customHeader:z,handler:function(ea,fa){return this.__handleUpdate(ea,fa);}.bind(this)};c('MercuryServerDispatcher').registerEndpoints(aa);};w.prototype.__sendRequest=function(y,z,aa){if(c('MercuryConfig').MessengerCachiusUseClientSeqIDWWW)switch(y){case c('MercuryServerURIs').THREADLIST_INFO:case c('MercuryServerURIs').THREAD_INFO:z.cachius_min_seq_id=this.$MercuryServerRequests8.getLastSeqID();break;default:break;}c('MercuryServerDispatcher').trySend(y,z,aa,this.$MercuryServerRequests1);};w.prototype.__getFBID=function(){return this.$MercuryServerRequests1;};var x=new (c('MercurySingletonProvider'))(w);f.exports=w;}),null);
__d('MercuryThreadIDMap',['KeyedCallbackManager','MercuryAssert','MercuryIDs','MercurySingletonProvider'],(function a(b,c,d,e,f,g){'use strict';function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new (c('KeyedCallbackManager'))();this.$MercuryThreadIDMap3=new (c('KeyedCallbackManager'))();}h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return;}this.forceSetServerIDToClientID(j,k);};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j);};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k);};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j);};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j);}.bind(this));};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j);};h.prototype.getServerIDFromClientID=function(j,k){c('MercuryAssert').isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(['MercuryServerRequests'],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c('MercuryIDs').tokenize(j);if(n.length&&o.type!='root')m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n);}.bind(this));};h.prototype.hasClientIDForServerID=function(j){return !!this.getClientIDFromServerIDNow(j);};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j;};h.prototype.canLinkExternally=function(j){c('MercuryAssert').isThreadID(j);var k=c('MercuryIDs').tokenize(j);return k.type=='user'||!!this.getServerIDFromClientIDNow(j);};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryParticipantFetcher',['LogHistory','MercuryIDs','MercuryPayloadSource','MercuryServerPayloadPreprocessor','Set','ShortProfiles','setImmediate','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('LogHistory').getInstance('short_profiles');function i(k){this.$MercuryParticipantFetcher4=c('MercuryServerPayloadPreprocessor').getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new (c('Set'))();this.$MercuryParticipantFetcher3=new (c('Set'))();this.$MercuryParticipantFetcher5=setInterval(this.$MercuryParticipantFetcher7.bind(this),20*1000);}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher8(k);this.$MercuryParticipantFetcher7();};i.prototype.fetchMulti=function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher8(l);}.bind(this));this.$MercuryParticipantFetcher7();};i.prototype.$MercuryParticipantFetcher8=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k);};i.prototype.$MercuryParticipantFetcher7=function(){if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c('setImmediate')(function(){this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k);}.bind(this));this.$MercuryParticipantFetcher9(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3['delete'](l.id);}.bind(this));this.$MercuryParticipantFetcher10(k);if(this.$MercuryParticipantFetcher6)clearTimeout(this.$MercuryParticipantFetcher6);}.bind(this));this.$MercuryParticipantFetcher11();this.$MercuryParticipantFetcher2.clear();}.bind(this));};i.prototype.$MercuryParticipantFetcher11=function(){this.$MercuryParticipantFetcher6=c('setTimeoutAcrossTransitions')(function(){this.$MercuryParticipantFetcher3.forEach(function(k){return this.$MercuryParticipantFetcher2.add(k);}.bind(this));this.$MercuryParticipantFetcher3.clear();}.bind(this),11*1000);};i.prototype.$MercuryParticipantFetcher9=function(k,l){var m=[];k.forEach(function(n){var o=c('MercuryIDs').tokenize(n),p=o.type,q=o.value;p==='fbid'&&m.push(q);});if(m.length>0){c('ShortProfiles').getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error('server_fetch_participant_count_error',JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}));});h.debug('client_fetch_participants',JSON.stringify({userIDs:m}));}};i.prototype.$MercuryParticipantFetcher10=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c('MercuryPayloadSource').SERVER_FETCH_PARTICIPANTS});};function j(k,l){var m=babelHelpers['extends']({gender:k.gender,fbid:k.id||l,href:k.uri,id:c('MercuryIDs').getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation;}if(k.timezone||k.timezone===0)m.timezone=k.timezone;if(k.personal_id)m.personal_id=k.personal_id;if(k.work_id)m.work_id=k.work_id;return m;}f.exports=i;}),null);
__d('MercuryVanityIDMap',['Map','MercuryAssert'],(function a(b,c,d,e,f,g){'use strict';var h=new (c('Map'))(),i=new (c('Map'))(),j={getID:function k(l){return h.get(l.toLowerCase());},getVanity:function k(l){return i.get(l);},hasID:function k(l){return i.has(l);},hasVanity:function k(l){return h.has(l.toLowerCase());},set:function k(l,m){c('MercuryAssert').isParticipantID(m);var n=l.toLowerCase();h.set(n,m);i.set(m,n);}};f.exports=j;}),null);
__d('MercuryParticipants',['fbt','CurrentUser','EventEmitter','ImageSourceRequest','ImageSourceType','ImmutableObject','KeyedCallbackManager','MercuryAssert','MercuryIDs','MercuryParticipantFetcher','MercuryParticipantTypes','MercuryParticipantsConstants','MercuryDispatcher','MercuryVanityIDMap','PhotoResizeModeConst','Set','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i='change';function j(l){this.$MercuryParticipants1=l;this.$MercuryParticipants2=new (c('EventEmitter'))();this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();this.$MercuryParticipants4=new (c('MercuryParticipantFetcher'))(this.$MercuryParticipants1);this.$MercuryParticipants5=c('MercuryDispatcher').getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe('update-participants',function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants);}.bind(this));this.$MercuryParticipants5.subscribe('invalidate-global-state',function(){this.$MercuryParticipants7();}.bind(this));}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m);};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c('MercuryVanityIDMap').hasVanity(l))return c('MercuryVanityIDMap').getID(l);if(/^\d+$/.test(l))return c('MercuryIDs').getParticipantIDFromUserID(l);return undefined;};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l);};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m;};j.prototype.get=function(l,m){c('MercuryAssert').isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l]);});};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m);};j.prototype.getBigImageMulti=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=c('MercuryParticipantsConstants').BIG_IMAGE_SIZE;return this.$MercuryParticipants9(l,function(o){var p={},q=0,r=new (c('Set'))(),s=function(w,x){q++;p[w]=x;if(q===l.length){m(p);if(r.size>0)this.$MercuryParticipants10(r);}}.bind(this),t=function(w,x){var y=this.$MercuryParticipants3.getResource(w);if(!y)return;this.$MercuryParticipants3.setResource(w,c('ImmutableObject').set(y,{big_image_src:x.uri}));r.add(w);s(w,x.uri);}.bind(this);for(var u in o){var v=o[u];if(!v.big_image_src){new (c('ImageSourceRequest'))().setFBID(c('MercuryIDs').getUserIDFromParticipantID(u)).setType(c('ImageSourceType').PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c('PhotoResizeModeConst').COVER).setCallback(t.bind(null,u)).send();}else s(v.id,v.big_image_src);}}.bind(this));};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o];}));});};j.prototype.$MercuryParticipants9=function(l,m){c('MercuryAssert').allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){var q=c('MercuryIDs').tokenize(p),r=q.type,s=q.value;if(r==='email'){this.$MercuryParticipants11(p,s);return false;}if(r==='name'){this.$MercuryParticipants12(p,s);return false;}return true;}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n);};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c('MercuryIDs').tokenize(l),o=n.type,p=n.value;if(o==='email')m=this.$MercuryParticipants11(l,p);if(o==='name')m=this.$MercuryParticipants12(l,p);}return m;};j.prototype.$MercuryParticipants11=function(l,m){var n=new (c('ImmutableObject'))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants12=function(l,m){var n=new (c('ImmutableObject'))({gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n;};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l);};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id;});l=l.map(function(n){if(n.vanity)c('MercuryVanityIDMap').set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c('ImmutableObject').set(o,n):new (c('ImmutableObject'))(this.$MercuryParticipants14(n));}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c('createObjectFrom')(m,l));this.$MercuryParticipants10(new (c('Set'))(m));};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c('MercuryParticipantTypes').USER||l.type===c('MercuryParticipantTypes').FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Facebook User");l.name=n;l.short_name=n;}return l;};j.prototype.$MercuryParticipants13=function(l){return {remove:function(){this.$MercuryParticipants3.unsubscribe(l);}.bind(this)};};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new (c('KeyedCallbackManager'))();};function k(l,m){return {gender:c('MercuryParticipantsConstants').UNKNOWN_GENDER,href:null,id:l,image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,big_image_src:c('MercuryParticipantsConstants').EMAIL_IMAGE,name:m,short_name:m,employee:false,fbid:undefined,accepts_messenger_user_feedback:undefined,is_business_enabled:undefined,is_messenger_platform_bot:undefined,is_employee_away:undefined,is_friend:undefined,is_messenger_user:undefined,is_verified:undefined,type:undefined,vanity:undefined,timezone:undefined,personal_id:undefined,work_id:undefined};}f.exports=new j(c('CurrentUser').getID());}),null);
__d('MercuryMessageObject',['BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercurySendMessageFields'],(function a(b,c,d,e,f,g){h.getForFBID=function(l){'use strict';return k.getForFBID(l);};h.get=function(){'use strict';return k.get();};function h(l){'use strict';this.$MercuryMessageObject1=l;this.$MercuryMessageObject2=c('MercuryThreads').getForFBID(l);}h.prototype.constructUserGeneratedMessageObject=function(l,m,n,o,p){'use strict';var q=i(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,m,n);if(typeof l=='string')l=l.replace(/^\s+/,'').replace(/\s+$/,'');q.body=l;q.has_attachment=false;q.html_body=false;q.attachments=[];q.specific_to_list=o||[];q.creator_info=p;return q;};h.prototype.constructStickerMessageObject=function(l,m,n){'use strict';var o=i(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,m,n);o.has_attachment=true;o.html_body=false;o.attachments=[];o.sticker_id=l;o.specific_to_list=[];return o;};h.prototype.constructAttachmentMessageObject=function(l,m){'use strict';var n=i(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,l,m);n.attachments=[];n.specific_to_list=[];return n;};h.prototype.constructLogMessageObject=function(l,m,n,o){'use strict';var p=i(this.$MercuryMessageObject1,c('MercuryActionType').LOG_MESSAGE,l,m);p.log_message_type=n;p.log_message_data=o;if(o&&o.untypedData&&o.untypedData.ttl)p.ephemeral_ttl_mode=o.untypedData.ttl;return p;};h.prototype.constructCTAConfirmationMessageObject=function(l,m,n,o){var p=arguments.length<=4||arguments[4]===undefined?null:arguments[4];'use strict';var q=this.constructUserGeneratedMessageObject(l,m,n,null,null),r={};if(o){r={quick_replies:o,ignore_for_webhook:false};}else r={ignore_for_webhook:true};q.platform_xmd=JSON.stringify(r);if(p&&p.length>0)q.tags=p;return q;};h.prototype.normalizeNewMessage=function(l){'use strict';if(l.status===undefined)l.status=c('MercuryActionStatus').UNSENT;l.offline_threading_id=l.offline_threading_id||c('MercuryLocalIDs').generateOfflineThreadingID(l.timestamp);if(!l.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','invalid_otid_generated');l.message_id=l.message_id||l.offline_threading_id;var m=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryMessageObject1);l.specific_to_list=l.specific_to_list||[];if(l.specific_to_list.length&&l.specific_to_list.indexOf(m)===-1)l.specific_to_list.push(m);if(!l.thread_id){l.thread_id='root:'+l.offline_threading_id;}else{var n=this.$MercuryMessageObject2.getThreadMetaNow(l.thread_id);if(n&&n.ephemeral_ttl_mode!==null&&l.ephemeral_ttl_mode===undefined)l.ephemeral_ttl_mode=n.ephemeral_ttl_mode;}if(l.specific_to_list.length==1){l.thread_id='user:'+this.$MercuryMessageObject1;}else if(l.specific_to_list.length==2){var o=l.specific_to_list[0]==m?l.specific_to_list[1]:l.specific_to_list[0];l.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(o);}if(!l.specific_to_list.length){var p=c('MercuryIDs').tokenize(l.thread_id),q=p.type,r=p.value;if(q=='user')l.specific_to_list=['fbid:'+r,m];}if(!l[c('MercurySendMessageFields').MANUAL_RETRY_CNT])l[c('MercurySendMessageFields').MANUAL_RETRY_CNT]=0;};h.prototype.normalizeResendMessage=function(l){'use strict';l.status=c('MercuryActionStatus').RESENDING;l.timestamp=Date.now();l[c('MercurySendMessageFields').MANUAL_RETRY_CNT]+=1;};h.prototype.normalizeAddAttachmentPlaceholder=function(l,m,n){'use strict';if(n.preview_attachments.length>0){l.has_attachment=true;l.preview_attachments=n.preview_attachments;}l.client_state=c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER;l.status=c('MercuryActionStatus').RESENDING;l.upload_id=m;};function i(l,m,n,o){var p=j(n)?[c('MercuryMessageSourceTags').CHAT]:[],q=Date.now(),r={action_type:m,thread_id:o,author:c('MercuryIDs').getParticipantIDFromUserID(l),author_email:null,timestamp:q,is_unread:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:n,source_tags:p};return r;}function j(l){switch(l){case c('MercurySourceType').CHAT_WEB:case c('MercurySourceType').CHAT_JABBER:case c('MercurySourceType').CHAT_IPHONE:case c('MercurySourceType').CHAT_MEEBO:case c('MercurySourceType').CHAT_ORCA:case c('MercurySourceType').CHAT_TEST:case c('MercurySourceType').CHAT:return true;default:return false;}}var k=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],(function a(b,c,d,e,f,g){'use strict';function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c('MercuryMessageObject').getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryMessageActions1);}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id);};h.prototype.resend=function(i,j){var k=babelHelpers['extends']({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j);};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype['delete']=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c('MercuryActionType').DELETE_MESSAGES,k||c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES));};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c('MercuryActionType').UNWRAP_MESSAGE},c('MercuryPayloadSource').CLIENT_UNWRAP_MESSAGE));};h.prototype.__constructClientSingleMessagePayload=function(i,j){return {actions:[i],from_client:true,payload_source:j};};h.prototype.$MercuryMessageActions4=function(i,j){return {actions:[i],from_client:false,payload_source:j};};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return {actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l};};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingBlockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/block_messages\/",{});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingGroupSetJoinableController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_joinable_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingUnblockMessagesController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/unblock_messages\/",{});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','ReloadPage','URI','XGroupsJoinChatController','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupSetApprovalController','XMessagingGroupSetJoinableController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController','XMessagingBlockMessagesController','XMessagingUnblockMessagesController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.updateReactionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeReactionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{reactions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.blockOnMessengerDotCom=function(n){var o=c('XMessagingBlockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.unblockOnMessengerDotCom=function(n){var o=c('XMessagingUnblockMessagesController').getURIBuilder().getURI();new (c('AsyncRequest'))(o).setMethod('POST').setData({fbid:c('MercuryIDs').getUserIDFromThreadID(n)}).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setJoinableMode=function(n,o){var p=c('XMessagingGroupSetJoinableController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.chatJoinThroughHash=function(n){var o={link_hash:n},p=c('XGroupsJoinChatController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).setHandler(function(q){return c('ReloadPage').now();}).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','ChatNotificationConstants'],(function a(b,c,d,e,f,g){var h=false,i=c('AvailableList').getWebChatNotification&&c('AvailableList').getWebChatNotification(),j=h,k=true,l=Object.assign(new (c('Arbiter'))(),{ON_CHANGED:'changed',notifiesUserMessages:function n(){return i!==c('ChatNotificationConstants').NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function n(){return j;},showsTabUnreadUI:function n(){return k;}});function m(){l.inform(l.ON_CHANGED);}c('AvailableList').subscribe&&c('AvailableList').subscribe(c('AvailableListConstants').ON_CHAT_NOTIFICATION_CHANGED,function(){var n=i,o=c('AvailableList').getWebChatNotification();i=o;if(n!=o)m();});c('Arbiter').subscribe('chat/set_does_page_occlude_tabs',function(n,o){j=!!o;m();});c('Arbiter').subscribe('chat/set_show_tab_unread_ui',function(n,o){k=!!o;m();});f.exports=l;}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerSharedMediaActions',['MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i='MessengerSharedMedia',j={Types:h,Namespace:i,currentLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.CURRENT_LOADED,namespace:i,data:l});},deletePhotos:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m});},loadCurrent:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m});},loadMorePrevious:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n});},loadMoreLatest:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n});},previousLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l});},latestLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.LATEST_LOADED,namespace:i,data:l});}};f.exports=j;}),null);
__d('mercuryBlockedParticipantsRe',['Set','utilsRe','bs_caml_obj','bs_js_boolean','MercuryIDs','CurrentUser','bs_js_primitive','MercuryDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h={};function i(p,q){var r=h[p],s=q.participants;if(c('bs_js_primitive').is_nil_undef(s)){return [];}else if(r!==undefined){var t=s.filter(function(u){return c('bs_caml_obj').caml_notequal(u,c('MercuryIDs').getParticipantIDFromUserID(p));});return t.filter(function(u){return +(+r.has(u)!==0);});}else return [];}function j(p,q){return c('bs_js_boolean').to_js_boolean(1- +q.is_canonical&&+(i(p,q).length>0));}function k(p,q){if(q.is_canonical){return [];}else return i(p,q);}function l(p,q){var r=h[p],s=+q.is_canonical,t=q.participants;if(s!==0){if(c('bs_js_primitive').is_nil_undef(t)){return false;}else if(r!==undefined){var u=t.filter(function(v){return c('bs_caml_obj').caml_notequal(v,c('MercuryIDs').getParticipantIDFromUserID(p));});return c('bs_js_boolean').to_js_boolean(1- +u.every(function(v){return 1- +r.has(v);}));}else return false;}else return false;}function m(p){var q=h[p];if(q===undefined){h[p]=new (c('Set'))();var r=c('MercuryDispatcher').getForFBID(p);r.subscribe("update-blocked-users",function(s,t){var u=h[p],v=t.message_blocked_ids;if(!c('bs_js_primitive').is_nil_undef(v)){var w=new (c('Set'))(v);h[p]=w;}var x=c('utilsRe').$pipe$unknown(c('bs_js_primitive').null_undefined_to_opt(t.participants),[]);x.forEach(function(y){var z=c('utilsRe').nullUndefinedBooleanToOptionBool(y.is_messenger_blocked),aa=y.fbid;if(z){if(z[0]!==0){if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){u.add(c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else if(!c('bs_js_primitive').is_nil_undef(aa)&&u!==undefined){+u['delete'](c('MercuryIDs').getParticipantIDFromUserID(aa));return 0;}else return 0;}else return 0;});return 0;});}return {findIntersection:function s(t){return i(p,t);},isPresentInGroupThread:function s(t){return j(p,t);},inGroupThread:function s(t){return k(p,t);},isMessageBlocked:function s(t){return l(p,t);},__fbid:p};}function n(){return m(c('CurrentUser').getID());}var o=c('utilsRe').$pipe$unknown;g.$pipe$unknown=o;g.blockedIdsPerFBID=h;g.findIntersection=i;g.isPresentInGroupThread=j;g.inGroupThread=k;g.isMessageBlocked=l;g.getForFBID=m;g.get=n;}),null);
__d('HotLikeSound',['MercurySoundsConfig','SoundPlayer','StickerConstants'],(function a(b,c,d,e,f,g){'use strict';var h=[c('MercurySoundsConfig').hot_like_grow_mp3_url,c('MercurySoundsConfig').hot_like_grow_ogg_url],i=[c('MercurySoundsConfig').hot_like_pop_mp3_url,c('MercurySoundsConfig').hot_like_pop_ogg_url],j=[c('MercurySoundsConfig').hot_like_outgoing_small_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_small_ogg_url],k=[c('MercurySoundsConfig').hot_like_outgoing_medium_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_medium_ogg_url],l=[c('MercurySoundsConfig').hot_like_outgoing_large_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_large_ogg_url],m=function o(){return false;},n={setCheckSoundEnabledFunc:function o(p){m=p;},start:function o(){this._play(h);},stop:function o(){c('SoundPlayer').stop(h);},pop:function o(){this.stop();this._play(i);},snap:function o(p){this.stop();if(p===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function o(p){if(m())c('SoundPlayer').play(p);}};f.exports=n;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=u.thread_id&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=v==c('MercuryActionType').REACTION_UPDATE,z=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,aa=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages30(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages31(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages33(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages34(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages35(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages36(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages34(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages37(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages37=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages34(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));if(!s)delete v[t];this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.meta_ranges)t.meta_ranges=p.meta_ranges;if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages33=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages31=function(p,q){var r=this.$MercuryMessages38(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages38(p,q);this.$MercuryMessages37(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages38=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages35=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages34=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages34(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.reduce(function(r,s){var t=this.$MercuryMessages17(s);if(t)r.push(t);return r;}.bind(this),[]);return q.reverse();};l.prototype.$MercuryMessages36=function(p,q){var r=q.filter(function(s){return m(this.$MercuryMessages17(s));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('MercuryActionStatus').SUCCESS;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(o){return l.getForFBID(o);};k.get=function(){return l.get();};function k(o){i.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=o;this.$MercuryRoger4=c('MercuryDispatcher').getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=c('MercuryThreads').getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(p,q){for(var r in q){var s=this.$MercuryRoger1[r]||c('immutable').OrderedMap();s=s.withMutations(function(t){for(var u in q[r]){var v=this.$MercuryRoger5.getThreadMetaNow(r);if(v&&v.participants)if(v.participants.indexOf(u)==-1){this.$MercuryRoger2.push(n(this.$MercuryRoger1));continue;}var w=t.get(u),x=q[r][u];if(!w||x.watermark>w.watermark)t.set(u,x);}}.bind(this));this.$MercuryRoger1[r]=s.sort(function(t,u){return t.watermark-u.watermark;});}q&&this.inform('change',q);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(p,q){var r={};for(var s in this.$MercuryRoger1)if(Object.prototype.hasOwnProperty.call(this.$MercuryRoger1,s))r[s]=this.$MercuryRoger1[s].toObject();q.read_receipts={valid_receipts:r,bad_receipts:this.$MercuryRoger2};}.bind(this));}k.prototype.getSeenBy=function(o,p){if(!o)return [];var q=[],r=this.$MercuryRoger1[o.thread_id];if(!r)return q;r.forEach(function(s,t){if(m(o,s.watermark,t,p))q.push(t);});return q;};k.prototype.wasSeenByAll=function(o){if(!o)return false;var p=this.$MercuryRoger1[o.thread_id];if(!p)return false;return p.every(function(q,r){return m(o,q.watermark,r);});};k.prototype.getSeenTimestamps=function(o){var p=this.$MercuryRoger1[o];if(!p){p=c('immutable').OrderedMap();this.$MercuryRoger1[o]=p;}return p;};k.prototype.getSeenTimestamp=function(o,p){var q=this.$MercuryRoger1[o];return q?q.get(p):null;};k.prototype.$MercuryRoger6=function(){this.$MercuryRoger1={};this.$MercuryRoger2=[];};var l=new (c('MercurySingletonProvider'))(k);function m(o,p,q,r){return !!(p>=o.timestamp&&(o.status===undefined||o.status===j)&&(!r||q!=o.author));}function n(o){return c('mapObject')(o,function(p){return p.toJS();});}f.exports=k;}),null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','MercuryRoger','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','mixin','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){var h,i,j=c('MercuryConfig')['roger.seen_delay'];h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o);}.bind(this));}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c('MercuryRoger').getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe('change',function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p);}.bind(this));this.$MercuryDelayedRoger3=c('MercuryThreadInformer').getForFBID(m);this.$MercuryDelayedRoger6=c('MercuryMessages').getForFBID(m);this.$MercuryDelayedRoger7=c('MercuryThreads').getForFBID(m);this.$MercuryDelayedRoger3.subscribe('messages-received',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-reordered',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-updated',this.$MercuryDelayedRoger9);}k.prototype.getSeenBy=function(m,n){'use strict';if(this.$MercuryDelayedRoger5[m])return [];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n);};k.prototype.wasSeenByAll=function(m){'use strict';if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m));};k.prototype.$MercuryDelayedRoger10=function(m){'use strict';if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp};}return this.$MercuryDelayedRoger4[m];};k.prototype.$MercuryDelayedRoger11=function(m){'use strict';var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c('MercuryActionStatus').SUCCESS)q-=c('LiveTimer').getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m];}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c('setTimeoutAcrossTransitions')(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m);}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true;}.bind(this));return n;};k.prototype.$MercuryDelayedRoger8=function(m){'use strict';var n={};n[m]=true;this.$MercuryDelayedRoger12(n);};k.prototype.$MercuryDelayedRoger12=function(m){'use strict';this.inform('state-changed',m);this.inform('change');};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryFolders',['MercuryFoldersConfig','MessagingTag'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function j(){return h.filter(function(k){if(k===c('MessagingTag').PENDING){return !c('MercuryFoldersConfig').hide_message_filtered;}else if(k===c('MessagingTag').OTHER)return !c('MercuryFoldersConfig').hide_message_requests;return true;}).concat();},getFromMeta:function j(k){var l=k.folder;if(k.is_archived)l=c('MessagingTag').ACTION_ARCHIVED;return l;}};f.exports=i;}),null);
__d('MercuryUnreadState',['invariant','MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i=(c('MercuryFolders').getSupportedFolders()||[]).filter(function(p){return p!==c('MessagingTag').ACTION_ARCHIVED;}),j='unread_thread_hash',k='unseen_thread_list',l=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,m=c('LogHistory').getInstance('mercury_unread_state');n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercuryUnreadState1=p;this.$MercuryUnreadState2=c('MercuryServerRequests').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState3=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState4=c('MercuryThreadInformer').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState5=c('MercuryThreads').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState6=c('MercuryDispatcher').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState7={};this.$MercuryUnreadState8={};this.$MercuryUnreadState9={};this.$MercuryUnreadState10={};this.$MercuryUnreadState11={};i.forEach(function(q){this.$MercuryUnreadState9[q]=0;this.$MercuryUnreadState10[q]=false;this.$MercuryUnreadState11[q]=new (c('KeyedCallbackManager'))();}.bind(this));this.$MercuryUnreadState6.subscribe('update-unread',this.$MercuryUnreadState12.bind(this));this.$MercuryUnreadState6.subscribe('update-thread-ids',function(q,r){this.$MercuryUnreadState13(r);}.bind(this));}n.prototype.getUnreadCount=function(p){if(this.exceedsMaxCount(p)){m.error('unguarded_unread_count_fetch','{}');return 0;}return this.$MercuryUnreadState14(p);};n.prototype.exceedsMaxCount=function(p){return this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>l;};n.prototype.markFolderAsRead=function(p){if(this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>0)this.$MercuryUnreadState2.markFolderAsRead(p);};n.prototype.getIsThreadUnread=function(p,q){var r=q||c('MessagingTag').INBOX,s=this.$MercuryUnreadState15(r);return !!(s&&s[p]);};n.prototype.$MercuryUnreadState16=function(p,q){this.$MercuryUnreadState11[p].setResource(j,q);this.$MercuryUnreadState11[p].setResource(k,Object.keys(q));};n.prototype.$MercuryUnreadState17=function(p,q){var r=this.$MercuryUnreadState11[p].executeOrEnqueue(j,q),s=this.$MercuryUnreadState11[p].getUnavailableResources(r);if(s.length)this.$MercuryUnreadState2.fetchUnreadThreadIDs(p);};n.prototype.$MercuryUnreadState15=function(p){return this.$MercuryUnreadState11[p].getResource(j);};n.prototype.$MercuryUnreadState14=function(p){var q=this.$MercuryUnreadState11[p].getResource(k);if(q){return q.length;}else return this.$MercuryUnreadState9[p];};n.prototype.$MercuryUnreadState12=function(p,q){var r=void 0;(q.unread_thread_fbids||[]).forEach(function(s){r=s.folder;if(!this.$MercuryUnreadState18(r))return;var t=s.thread_fbids||[];t=t.concat(s.other_user_fbids||[]);var u=this.$MercuryUnreadState19(t);this.$MercuryUnreadState16(r,c('createObjectFrom')(u,true));if(u.length>l)this.$MercuryUnreadState10[r]=true;this.$MercuryUnreadState4.updatedUnreadState();}.bind(this));(q.message_counts||[]).forEach(function(s){if(s.unread_count===undefined)return;r=s.folder;if(s.unread_count>l){this.$MercuryUnreadState10[r]=true;this.$MercuryUnreadState16(r,{});this.$MercuryUnreadState4.updatedUnreadState();}else{this.$MercuryUnreadState9[r]=s.unread_count;if(this.$MercuryUnreadState9[r]===0)this.$MercuryUnreadState16(r,{});this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));(q.global_actions||[]).forEach(function(s){if(s.action_type===c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryUnreadState20(s.folder,s.timestamp);}.bind(this));(q.actions||[]).forEach(function(s){var t=c('MercuryActionType'),u=s.other_user_fbid?s.other_user_fbid:s.thread_fbid,v=s.thread_id?s.thread_id:u;if(s.action_type==t.DELETE_THREAD){i.forEach(function(x){this.$MercuryUnreadState21(x,v);}.bind(this));}else if(s.action_type==t.CHANGE_ARCHIVED_STATUS||s.action_type==t.CHANGE_FOLDER){var w=this.$MercuryUnreadState5.getThreadMetaNow(s.thread_id);!!w||h(0);r=c('MercuryFolders').getFromMeta(w);if(this.$MercuryUnreadState18(r)&&w.unread_count>0)this.$MercuryUnreadState22(r,v);i.forEach(function(x){if(x!=r)this.$MercuryUnreadState21(x,v);}.bind(this));}else{r=this.$MercuryUnreadState23(s);if(!this.$MercuryUnreadState18(r))return;if(s.action_type==t.CHANGE_READ_STATUS){if(s.mark_as_read){this.$MercuryUnreadState21(r,v,s.timestamp);}else this.$MercuryUnreadState22(r,v,s.timestamp);}else if(s.action_type==t.USER_GENERATED_MESSAGE||s.action_type==t.LOG_MESSAGE)if(s.is_unread)this.$MercuryUnreadState22(r,v,s.timestamp);}}.bind(this));};n.prototype.$MercuryUnreadState22=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState17(p,function(s){var t=this.$MercuryUnreadState7[p]||0,u=this.$MercuryUnreadState8[q]||0,v=r||Number.POSITIVE_INFINITY;if(v>=t&&v>=u&&!s[q]){s[q]=r||0;this.$MercuryUnreadState16(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState21=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState17(p,function(s){if(r){var t=this.$MercuryUnreadState8[q];if(!t||t<r)this.$MercuryUnreadState8[q]=r;}var u=s[q];if(r&&typeof u=='number'&&r<u)return;if(q in s){delete s[q];this.$MercuryUnreadState16(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState20=function(p,q){this.$MercuryUnreadState10[p]=false;this.$MercuryUnreadState16(p,{});this.$MercuryUnreadState7[p]=Math.max(this.$MercuryUnreadState7[p]||0,q||0);this.$MercuryUnreadState4.updatedUnreadState();};n.prototype.$MercuryUnreadState19=function(p){return p.map(this.$MercuryUnreadState3.convertThreadIDIfAvailable,this.$MercuryUnreadState3);};n.prototype.$MercuryUnreadState13=function(p){i.forEach(function(q){var r=this.$MercuryUnreadState15(q);if(!r)return;for(var s in p){var t=p[s];if(r[s]){r[t]=r[s];delete r[s];}}this.$MercuryUnreadState16(q,r);}.bind(this));};n.prototype.$MercuryUnreadState23=function(p){var q=p.thread_id?this.$MercuryUnreadState5.getThreadMetaNow(p.thread_id):null;return q?c('MercuryFolders').getFromMeta(q):p.folder?p.folder:'';};n.prototype.$MercuryUnreadState18=function(p){return c('arrayContains')(i,p);};var o=new (c('MercurySingletonProvider'))(n);f.exports=n;}),null);
__d('isInFocusMode',['WorkFocusModeController'],(function a(b,c,d,e,f,g){var h=c('WorkFocusModeController').WorkFocusMode,i=function j(k){return !!(h&&h.currentViewerInFocusMode(k));};f.exports=i;}),null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],(function a(b,c,d,e,f,g,h){var i=86400000,j=6*i,k={getFormatedTimestamp:function l(m){var n=m/1000;return k.getFormattedTimestampByBucket(n,this.getTimeBucket(m));},getAbsoluteTimestamp:function l(m){if(m==null){return null;}else{var n=k.getFormatedTimestamp(m);return n.absolute;}},getRelativeTimestamp:function l(m){var n=k.getFormatedTimestamp(m);return n.relative;},getFormattedTimestampByBucket:function l(m,n){switch(n){case c('MercuryTimePassed').TODAY:return {absolute:h._("Today"),relative:c('formatDate')(m,'g:ia')};case c('MercuryTimePassed').WEEK_AGO:return {absolute:c('formatDate')(m,'l'),relative:c('formatDate')(m,'D')};case c('MercuryTimePassed').CURRENT_YEAR:return {absolute:c('formatDate')(m,'F j'),relative:c('formatDate')(m,'M j')};default:return {absolute:c('formatDate')(m,'F j, Y'),relative:c('formatDate')(m,'n/j/y')};}},getTimeBucket:function l(m){var n=new Date(m),o=new Date(),p=new Date(o.getFullYear(),o.getMonth(),o.getDate());if(p<n){return c('MercuryTimePassed').TODAY;}else if(p-j<n){return c('MercuryTimePassed').WEEK_AGO;}else if(p.getFullYear()===n.getFullYear()){return c('MercuryTimePassed').CURRENT_YEAR;}else return c('MercuryTimePassed').OTHER_YEAR;},getPreciseTimestamp:function l(m){return c('formatDate')(new Date(m),k.getPreciseFormat(m));},getPreciseFormat:function l(m){var n=k.getTimeBucket(m);switch(n){case c('MercuryTimePassed').TODAY:return 'g:ia';case c('MercuryTimePassed').WEEK_AGO:return 'l g:ia';case c('MercuryTimePassed').CURRENT_YEAR:return 'F jS, g:ia';case c('MercuryTimePassed').OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=k;}),null);