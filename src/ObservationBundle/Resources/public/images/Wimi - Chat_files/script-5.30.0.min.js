var App;!function(a){!function(b){function c(b){var c={header:{app_token:b.app_token||Kore.APP_TOKEN,api_version:"1.2",msg_key:h(b),identification:{},token:Kore.getAuthToken(),target:[f(b.module),b.entity,b.action].join("."),debug:{indent_output:!0}},body:{data:null}};Kore.ACCOUNT_ID&&(c.header.identification.account_id=Kore.ACCOUNT_ID),a.Global.wimi()&&(c.header.identification.account_name=a.Global.wimi().account_name),b.auth&&(c.header.auth={login:b.auth.login,password:b.auth.password}),b.no_auth||(c.header.identification.user_id=a.Global.user().user_id);var d=Kore.getSocketId();if(d&&(c.header.socket=d),b.project&&(c.header.identification.project_id=b.project),b.objects&&$.extend(c.header.identification,b.objects),b.file&&(b.data=b.data||{},b.data.name=b.file.name,b.data.size=b.file.size),b.data){var i=function(b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];moment.isMoment(d)?b[c]=d.utc().format(a.Util.UTCFormat):"object"==typeof d&&(b[c]=i(d))}return b};c.body.data=i(b.data)}b.button&&b.button.loading(!0);var j=null;b.tooltip&&(j=new a.Util.SaveTooltip(b.tooltip),j.init());var l="";l=b.webdav?Kore.API_FILES_DOMAIN:b.zipper?Kore.ZIPPER_DOMAIN:Kore.API_DOMAIN;var m=JSON.stringify(c);e(c)||console.log("-> WAPI REQUEST "+c.header.msg_key+"\n",c);var n=function(d,f){var h=!0;return j&&j.onError(),$.isFunction(b.onError)&&(h=!1!==b.onError(d,f)),0==f.readyState?e(c)||a.Alert.show(a.Global.trans("error.offline")):h&&g(d,c,b),!1},o=function(d,f){if(e(c)||console.log("<- WAPI RESPONSE "+c.header.msg_key+"\n",d),d&&d.header&&d.header.custom_message){var g=d.header.custom_message;b.onMessage?b.onMessage(g):a.Alert.show(g)}if(d&&d.body&&d.body.error){var h=new k(d.body.error);return n(h,f)}if(d&&d.body&&d.body.data&&d.body.data.errors&&d.body.data.errors.length)for(var i in d.body.data.errors)if(d.body.data.errors.hasOwnProperty(i)){var l=new k(d.body.data.errors[i]);n(l,f)}if(j&&j.onSuccess(),b.onSuccess){var m=d&&d.body&&d.body.data?d.body.data:{};b.onSuccess(m,f)}Kore.updateCookie(!0),d&&Object.keys(d).length&&a.Push.dispatchMessage&&a.Push.dispatchMessage(d)},p=function(){b.button&&b.button.loading(!1,b.buttonDisable),$.isFunction(b.onComplete)&&b.onComplete()};b.file?a.Util.uploadFile(b.file,c,l,{onSuccess:o,onProgress:b.onProgress,onError:n,onComplete:p,sendDataByHeader:!0}):b.download?($("<form>",{method:"POST",html:"<input type='hidden' name='json' value='"+m+"'>",action:l}).appendTo("body").submit().remove(),o(null,null),p()):b.zipper?($("<form>",{method:"POST",html:"<input name="+m+">",action:l}).appendTo("body").submit().remove(),o(null,null),p()):$.ajax({url:l,data:m,type:"POST",dataType:"json",contentType:"application/json",async:!b.sync,success:function(a,b,c){return o(a,c)},error:function(a,b,c){console.log("*********** API REQUEST ERROR ***********"),console.log(a),console.log(b),console.log(c),a.responseJSON||console.warn("API response could not be parsed in JSON\n",a.responseText?a.responseText.slice(0,100):"");var d=new k({id:a.status,str:a.statusText});n(d,a)},complete:function(a,b){p()}})}function d(b,c){var d=a.Global.user().email,e=Kore.getAuthToken(),f=e.split(":")[1];a.API.Auth.login(d,b,f,c)}function e(b){return-1!==b.header.msg_key.indexOf([a.Global.MODULES.MAIN,a.Global.ENTITIES.USER,"setStatus"].join("."))}function f(b){var c={};c[a.Global.MODULES.AGENDA]="calendar",c[a.Global.MODULES.DOCUMENTS]="document",c[a.Global.MODULES.MEETINGS]="meeting",c[a.Global.MODULES.TASKS]="task";var d=c[b];return d||(d=b),d}function g(b,d,e){if(b){switch(b.id){case 400:var f=a.Global.conf();f&&f.ui.dev&&a.Alert.show(JSON.stringify(b).makeSafe()+"<br><br>"+JSON.stringify(d).makeSafe());break;case 401:return a.Global.showRelog(function(){c(e)})}i(b,!1),console.warn("API ERROR: code="+b.id+" debug_msg="+b.debug_msg+" str="+b.str)}}function h(b){var c=a.Util.uniqueKey();return[f(b.module),b.entity,b.action,c].join(".")}function i(b,c){var d=j(b);if(!d){if(c)return;d=b.str}a.Alert.show(d)}function j(b){if(!b.detail_id)return null;var c="api.error."+b.detail_id;return a.Global.traductionKeyExists(c)?a.Global.trans(c,b.data):null}var k=function(){function a(a){this.id=a.id,this.str=a.str,this.debug_msg=a.debug_msg,this.detail_id=a.detail_id,this.detail_str=a.detail_str,this.data=a.data}return a.prototype.showError=function(a){b.showError(this,a)},a.prototype.getDetailErrorMessage=function(){return j(this)},a}();b.WApiError=k,b.request=c,b.relog=d,b.showError=i,b.getDetailErrorMessage=j,function(a){a[a.WimiWApiUploadFileTooBig=1028]="WimiWApiUploadFileTooBig"}(b.APIError||(b.APIError={}));var l=(b.APIError,function(){function b(a){this.header=a.header,this.body=a.body}return b.prototype.getSocket=function(){return this.header.socket},b.prototype.getUser=function(){return this.header.identification.user_id?Model.User.getUser(this.header.identification.user_id):null},b.prototype.getProjectId=function(){return this.header.identification.project_id},b.prototype.getTarget=function(){return this.header.target},b.prototype.getTargetProjectId=function(){return this.header.identification.target_project_id},b.prototype.getModule=function(){return this.header.target.split(".")[0]},b.prototype.getEntity=function(){return this.header.target.split(".")[1]},b.prototype.getAction=function(){return this.header.target.split(".")[2]},b.prototype.getData=function(){return this.body.data},b.prototype.getError=function(){return this.body.error?new k(this.body.error):null},b.prototype.getResponseClass=function(){var a=this.header.original_target||this.header.target;return b.getResponseClassForTarget(a)},b.prototype.getDataAsResponseObject=function(){var a=this.getResponseClass();return a?new a(this.getData()):null},b.prototype.isCaller=function(){return this.getSocket()==Kore.getSocketId()},b.prototype.isCurrentProject=function(b){void 0===b&&(b=!1);var c=a.Global.project(),d=c&&this.getProjectId()==c.project_id;return!d&&b&&(d=c&&this.getTargetProjectId()==c.project_id),d},b.prototype.isCurrentModule=function(){var b=f(a.Global.module());return this.getModule()==b},b.getResponseClassNameForAction=function(a){return a.toUpperFirst()+"Response"},b.getResponseClassForTarget=function(b){var c=b.split("."),d=c[0].toUpperFirst(),e=c[1].toUpperFirst(),f=c[2].toUpperFirst(),g=this.getResponseClassNameForAction(f);if(a.API[d]&&a.API[d][e]&&a.API[d][e])for(var h in a.API[d][e])if(a.API[d][e].hasOwnProperty(h)&&g.toLowerCase()==h.toLowerCase())return a.API[d][e][h];return null},b}());b.WApiMessage=l}(a.API||(a.API={}))}(App||(App={}));var App;!function(a){!function(a){function b(){return[c(e.ORANGE),c(e.BLUE),c(e.GREEN),c(e.PURPLE),c(e.YELLOW),c(e.RED),c(e.BROWN),c(e.GREY)]}function c(a){switch(a){case e.ORANGE:return d("#f08700");case e.BLUE:return d("#0da4ee");case e.GREEN:return d("#56cf2a");case e.PURPLE:return d("#c369d8");case e.YELLOW:return d("#f2c000");case e.RED:return d("#ee2659");case e.BROWN:return d("#9a7d53");case e.GREY:return d("#84929a")}}var d=net.brehaut.Color;a.green=d("#72A329"),a.red=d("#E64C66"),a.orange=d("#E67E5E"),a.blue=d("#14A0CC"),a.grey=d("#AAAEB3"),a.lightGrey=d("#f0f2f4"),function(a){a[a.ORANGE=1]="ORANGE",a[a.BLUE=2]="BLUE",a[a.GREEN=3]="GREEN",a[a.PURPLE=4]="PURPLE",a[a.YELLOW=5]="YELLOW",a[a.RED=6]="RED",a[a.BROWN=7]="BROWN",a[a.GREY=8]="GREY"}(a.IColorsEnum||(a.IColorsEnum={}));var e=a.IColorsEnum;a.getColors=b,a.getColorForId=c}(a.Colors||(a.Colors={}))}(App||(App={}));var App;!function(a){!function(b){function c(){t={},$(document).on("click",".open-chat",function(a){d($(this),a)}),$(document).on("click",".open-air",function(a){i($(this),a)}),$(document).on("click",".open-messages",function(a){s($(this),a)}),b.$communicationCenter.on("mouseenter",function(){if(!b.$communicationCenter.hasClass("active")){b.$communicationCenter.addClass("active");var a=$(".communication-wheel",b.$communicationCenter);a.css("opacity","0"),a.fadeIn(0),a.stop(!0,!1).animate({opacity:1},{step:function(a){$(this).css("-webkit-transform","scale("+a+")"),$(this).css("-ms-transform","scale("+a+")"),$(this).css("-moz-transform","scale("+a+")"),$(this).css("transform","scale("+a+")")},duration:200,easing:"eazeOutBack"})}}).on("mouseleave",function(){var a=$(".communication-wheel",b.$communicationCenter);a.stop(!0,!1).animate({opacity:0},{step:function(a){$(this).css("-webkit-transform","scale("+a+")"),$(this).css("-ms-transform","scale("+a+")"),$(this).css("-moz-transform","scale("+a+")"),$(this).css("transform","scale("+a+")")},duration:200,complete:function(){b.$communicationCenter.removeClass("active"),a.fadeOut(0)},easing:"eazeInBack"})}),a.Lib.Tabs.isType("app")&&v.init()}function d(a,b){b.stopPropagation();var c=a.data("chat-user");if(c)return g([c]);var d=a.data("chat-channel");if(d)return f(d);e()}function e(b){void 0===b&&(b={});var c=a.Lib.Tabs.getChatTab();if(c)return b.chat?a.Lib.Tabs.transmit("chat.openChat",{chat_id:b.chat},c.uuid):b.users?a.Lib.Tabs.transmit("chat.openGroup",{users:b.users},c.uuid):b.project?a.Lib.Tabs.transmit("chat.openChannel",{project_id:b.project},c.uuid):a.Lib.Tabs.transmit("chat.open",{},c.uuid);var d=Kore.url("/chat/#/");b.chat?d+="?chat="+b.chat:b.users?d+="?users="+b.users.join(","):b.project&&(d+="?channel="+b.project),h(d)}function f(a){e({project:a})}function g(a){e({users:a})}function h(a){var b=.7*screen.height,c=(screen.height-.7*screen.height)/2,d=.05*screen.width;window.open(a,"","left="+d+",top="+c+",height="+b+",width=980")}function i(a,b){b.stopPropagation();var c=a.data("air-users");j({users:c?c.toString().split(","):[]})}function j(a){void 0===a&&(a={});var b=Kore.url("/airtime/#/"),c=[];a.room?c.push("room="+a.room):a.users&&a.users.length&&c.push("users="+a.users.join(",")),c.length&&(b+="?"+c.join("&")),k(b)}function k(a){var b=.7*screen.height,c=(screen.height-.7*screen.height)/2,d=.05*screen.width;window.open(a,"","left="+d+",top="+c+",height="+b+",width=980")}function l(b,c){var d=Model.User.getUserName(c);p(a.Popup.popup(a.Global.trans("airtime.user_calling",{user:d}),{controls:[a.Util.buttonHTML(a.Global.trans("accept"),{customClass:"accept-call button-green"}),a.Util.buttonHTML(a.Global.trans("decline"),{customClass:"decline-call button-red"})],onShown:function(c){c.on("click",".accept-call",function(){r(b),j({room:b}),a.Popup.hide(c)}).on("click",".decline-call",function(){r(b),a.API.AirTime.decline(b),a.Popup.hide(c)})}}),b);var e=a.Lib.Tabs.hasLP();e&&$.ionSound.play("air.incoming"),!a.Lib.Tabs.getFocusedTab()&&e&&a.WebNotifications.notify(a.Global.trans("airtime.user_calling.notification",{user:d}),{notification:function(a){q(a,b)},onclick:function(){j({room:b}),r(b)},sticky:!0})}function m(a){r(a)}function n(a){r(a)}function o(a){return t[a]=t[a]||{popups:[],notifications:[]},t[a]}function p(a,b){o(b).popups.push(a)}function q(a,b){o(b).notifications.push(a)}function r(b){if(t[b]){var c=t[b].popups;for(var d in c)c.hasOwnProperty(d)&&c[d]&&a.Popup.hide(c[d]);var e=t[b].notifications;for(var d in e)e.hasOwnProperty(d)&&e[d]&&e[d].close();delete t[b]}}function s(a,b){b.stopPropagation(),u.open()}b.$communicationCenter=$("#communication-center");var t;b.init=c,b.openChatClicked=d,b.openChat=e,b.openChatChannel=f,b.openChatGroup=g,b.openAirTimeClicked=i,b.openAirTime=j,b.onAirTimeInvite=l,b.onAirTimeJoined=m,b.onAirTimeDeclined=n,b.openMessagesClicked=s;!function(b){function c(b){return b=b||d(),a.Global.url("airtime/#/?room="+b)}function d(){return a.Util.uniqueKey(12).toLowerCase()}b.getURLForRoom=c,b.generateRoomName=d}(b.AirTime||(b.AirTime={}));var u;!function(b){function c(){var b=Model.User.getUsers(!1),c={customClass:"max-width",onShown:function(b){b.on("click","form .messages-send",function(){var b=$(this).closest("form").serializeArray();$.post("io-ajax/email-user.php",b,function(){a.Notifications.notifyInfo(a.Global.trans("message_sent"),{icon:"envelope-o"})})})}};a.Popup.popup(a.Templates.Global.messages({users:b}),c)}b.open=c}(u=b.Messages||(b.Messages={}));var v;!function(b){function c(){j=$("#communication-center"),a.API.Chat.getChats({onSuccess:function(b){var c=new a.API.Chat.Chat.GetListResponse(b);if(c.success)for(var d in c.chats)if(c.chats.hasOwnProperty(d)){var e=c.chats[d];i[e.chat_id]={project_id:e.project_id,new_count:e.new_count}}g()}})}function d(){for(var a in k)if(k.hasOwnProperty(a)){var b=k[a];b(i)}}function e(a){i[a]&&(i[a].new_count||(i[a].new_count=0),i[a].new_count+=1,g())}function f(a){i[a]&&(i[a].new_count=0,g())}function g(){var a=0;for(var b in i)i.hasOwnProperty(b)&&(a+=i[b].new_count);j.toggleClass("unread",!!a),j.find(".wheel-item.open-chat").attr("data-count",a),d()}function h(a){k.push(a),i&&a(i)}var i={},j=null,k=[];b.init=c,b.onNewMessageForChat=e,b.onChatUnreadMessagesCleared=f,b.subscribeForNewMessageCountChanges=h}(v=b.Wheel||(b.Wheel={}))}(a.Communication||(a.Communication={}))}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){var b=function(){function b(){}return b.newCustomApp=function(c){void 0===c&&(c="wimi"),c=c||"wimi";var d=c.toUpperFirst()+"AppCustom";return a[d]?new a[d]:(console.warn("App."+d+" class not found, no custom app for: "+c),b.newCustomApp())},b.prototype.hello=function(){alert("hello WIMI !")},b.prototype.configFromJSON=function(b){return new a.Config(b)},b.prototype.getLoadingImageURL=function(){return a.Global.urlStaticImageCustom("logo-inline.png")},b.prototype.customActionsForFile=function(a){return[]},b.prototype.customFileActionClicked=function(a,b){},b.prototype.shouldShowPoweredByWimi=function(){return!1},b.prototype.hasProjectTemplates=function(){return!1},b.prototype.onDirectoryPanelInit=function(a){},b.prototype.textForUserTitleField=function(){return a.Global.trans("titre_utilisateur")},b}();a.AppCustom=b;var c=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(b);a.WimiAppCustom=c}(App||(App={}));var App;!function(a){var b=function(){function b(b,c,d){this.$container=null,this.$dropzone=null,console.log("Upload");var e=this;this.$container=b,this.$dropzone=$(a.Templates.Global.dropZone());var f=!1,g=0;$("html").on("dragenter",function(a){if(g++,console.log("drag enter",f,a),!f){if(!c())return;var b=a.originalEvent;if(b.dataTransfer.types)for(var d=0;d<b.dataTransfer.types.length;d++)if("Files"==b.dataTransfer.types[d])return a.preventDefault(),f=!0,e.showDropZone(),!1}}).on("dragover",function(a){f&&a.preventDefault()}).on("dragleave",function(){if(g--,console.log("dragleave",g),!g&&f)return f=!1,e.hideDropZone(),!1}),this.$container.on("drop",function(a){if(console.log("drop"),f){a.stopPropagation(),a.preventDefault(),console.log("drop & upload file"),f=!1,g=0,e.hideDropZone();var b=a.originalEvent,c=b.dataTransfer.files;d(c)}})}return b.prototype.showDropZone=function(){var a=this;this.$container.append(this.$dropzone),setTimeout(function(){a.$dropzone.addClass("animate")},100)},b.prototype.hideDropZone=function(){this.$dropzone.removeClass("animate").remove()},b}();a.DropZone=b}(App||(App={}));var App;!function(a){!function(b){function c(){b.$footer=$("#footer"),b.$footer.on("change","#select-lang",function(){a.Global.changeLang($(this).val())}).on("click",".get-apps",function(){var b={popover:{trigger:$(this),options:{container:"body",placement:"top"}}},c=a.Global.conf(),d=c.ui.download.mobile.ios_app_id?"https://itunes.apple.com/app/"+c.ui.download.mobile.ios_app_id:null;a.Popup.popup(a.Templates.Global.apps({link_wd_pc:c.ui.download.disk.pc,link_wd_mac:c.ui.download.disk.mac,show_wimi_disk_howto:c.ui.show_wimi_disk_how_to_link,show_outlook_connector:c.ui.show_outlook_connector,link_ios:d,link_android:c.ui.download.mobile.android,link_outlook_pc:c.ui.download.outlook.pc,link_evebim_pc:c.ui.download.evebim.pc,link_evebim_mac:c.ui.download.evebim.mac}),b)}).on("click",".support",function(){var b={popover:{trigger:$(this),options:{container:"body",placement:"top"}}},c=a.Global.conf(),d=[];$.each(c.ui.support_links,function(b,c){if(c){var e=c.link?c.link:c.link_key?a.Global.trans(c.link_key):"#",f=c.text?c.text:c.text_key?a.Global.trans(c.text_key):"",g={link:e,text:f};c.icon&&(g.icon=c.icon),c.color&&(g.color=c.color),d.push(g)}}),a.Popup.popup(a.Templates.Global.support({links:d}),b)})}b.$footer=null,b.init=c}(a.Footer||(a.Footer={}))}(App||(App={}));var App;!function(a){!function(a){a[a.SEPARATOR=0]="SEPARATOR",a[a.VIEW=1]="VIEW",a[a.TEXT=2]="TEXT",a[a.EMAIL=3]="EMAIL",a[a.SELECT=4]="SELECT",a[a.RADIO=5]="RADIO",a[a.CHECKBOX=6]="CHECKBOX",a[a.PHONE=7]="PHONE",a[a.ADDRESS=8]="ADDRESS"}(a.FormRowType||(a.FormRowType={}));var b=a.FormRowType,c=function(){function c(a){this.onChange=null,this.labelCol="col-sm-5",this.controlCol="col-sm-6",this.showRequired=!1,this.$form=null,$.extend(this,a)}return c.prototype.onRowChanged=function(a,b,c,d,e){var f=a.onChange||this.onChange;f&&f(a,b,c,d,e)},c.prototype.render=function(c){var d=this,e=a.Global.conf().countries,f=a.Templates.Global.form_factory({form:this,country_codes:a.Global.conf().phones.countries,current_country_key:a.Global.getUserLocale().country_key,phone_types:a.Global.conf().phones.types,countries:e});d.$form=a.Global.viewLoaded($(f)),a.Global.viewLoaded(c.html(d.$form));var g=function(c){if(h.rows.hasOwnProperty(c)){var f=h.rows[c];switch(f.type){case b.SEPARATOR:case b.VIEW:return"continue";case b.TEXT:case b.EMAIL:case b.SELECT:case b.RADIO:d.$form.on("change",'input[name="'+f.name+'"], select[name="'+f.name+'"]',function(){d.onRowChanged(f,$(this).val(),$(this),$(this).closest(".form-group").find(".control-label-text").first(),function(){})});break;case b.CHECKBOX:d.$form.on("change",'input[name="'+f.name+'"]',function(){d.onRowChanged(f,$(this).is(":checked"),$(this),$(this).closest(".form-group").find(".control-label-text").first(),function(){})});break;case b.PHONE:var g=d.$form.find('.phone-form[data-name="'+f.name+'"]');g.on("change keyup","select, input",function(b){"keyup"==b.type&&-1!==$.inArray(b.keyCode,a.Keys.keysToIgnoreOnKeyUp())||(d.onChange||f.onChange)&&g.find(".phone-form-submit").removeClass("hidden")}).on("click",".phone-form-submit",function(){var a=$(this),b=new Model.Phone({});b.code=g.find('select[name="'+f.name+'[code]"]').val(),b.phone=g.find('input[name="'+f.name+'[number]"]').val(),b.type=g.find('select[name="'+f.name+'[type]"]').val(),b.phone_id=g.data("phone")||null,d.onRowChanged(f,b,$(this),$(this).closest(".form-group").find(".control-label-text").first(),function(b){b&&a.addClass("hidden")})});break;case b.ADDRESS:var i=function(a){var b=a.find('select[name="'+f.name+'[country]"]').val();if(b){var c=e[b];a.find('input[name="'+f.name+'[state]"]').parent().toggleClass("hidden",!!c.ignore_state)}},j=d.$form.find('.address-form[data-name="'+f.name+'"]');j.on("change keyup","select, input",function(b){"keyup"==b.type&&-1!==$.inArray(b.keyCode,a.Keys.keysToIgnoreOnKeyUp())||(i(j),(d.onChange||f.onChange)&&j.find(".address-form-submit").removeClass("hidden"))}).on("click",".address-form-submit",function(){var b=$(this),c=new Model.Address({});if(c.street=j.find('input[name="'+f.name+'[street]"]').val(),c.city=j.find('input[name="'+f.name+'[city]"]').val(),c.postal_code=j.find('input[name="'+f.name+'[postal_code]"]').val(),c.state=j.find('input[name="'+f.name+'[state]"]').val(),c.country=j.find('select[name="'+f.name+'[country]"]').val(),!(c.street&&c.city&&c.postal_code&&c.country))return void a.Alert.show(a.Global.trans("invalid_address"));d.onRowChanged(f,c,$(this),$(this).closest(".form-group").find(".control-label-text").first(),function(a){a&&b.addClass("hidden")})}),i(j)}}},h=this;for(var i in this.rows){g(i)}},c.prototype.getData=function(){var a=this,c={};for(var d in this.rows)if(this.rows.hasOwnProperty(d)){var e=this.rows[d];switch(e.type){case b.SEPARATOR:case b.VIEW:continue;case b.TEXT:case b.EMAIL:case b.SELECT:case b.RADIO:c[e.name]=a.$form.find('input[name="'+e.name+'"], select[name="'+e.name+'"]').val();break;case b.CHECKBOX:c[e.name]=a.$form.find('input[name="'+e.name+'"]').is(":checked");break;case b.PHONE:var f=a.$form.find('.phone-form[data-name="'+e.name+'"]'),g=new Model.Phone({});g.code=f.find('select[name="'+e.name+'[code]"]').val(),g.phone=f.find('input[name="'+e.name+'[number]"]').val(),g.type=f.find('select[name="'+e.name+'[type]"]').val(),g.phone_id=f.data("phone")||null,g.phone_id||g.phone?c[e.name]=g:c[e.name]=null;break;case b.ADDRESS:var h=a.$form.find('.address-form[data-name="'+e.name+'"]'),i=new Model.Address({});i.street=h.find('input[name="'+e.name+'[street]"]').val(),i.city=h.find('input[name="'+e.name+'[city]"]').val(),i.postal_code=h.find('input[name="'+e.name+'[postal_code]"]').val(),i.state=h.find('input[name="'+e.name+'[state]"]').val(),i.country=h.find('select[name="'+e.name+'[country]"]').val(),c[e.name]=i}}return c},c}();a.Form=c;var d=function(){function a(a){this.name="",this.label="",this.value=null,this.choices=null,this.rows=null,this.onChange=null,this.required=!1,$.extend(this,a)}return a}();a.FormRow=d}(App||(App={}));var App;!function(a){!function(b){function c(){if(Kore.onViewLoaded=function(a){return za(a)},Kore.onAlert=function(b,c){return a.Alert.show(b,c)},Kore.trans=function(a,b){return Ya(a,b)},Kore.onNotFound=function(){Mb?(Kore.clearView(b._mainContainer),Kore.onAlert("404: Route Not Found")):window.location.replace("/accueil")},Kore.relog=function(a){yb(a)},Kore.onRouteEnter=function(){if(i()){if(!(this.path==["#",b.MODULES.ACCOUNT,a.Script.Account.PAGES.offer.pages.subscription.page].join("/")))return a.Alert.show(b.trans("account_suspended.redirect"),function(){window.location.assign(p([b.MODULES.ACCOUNT,a.Script.Account.PAGES.offer.pages.subscription.page].join("/"),!0))}),!1}$("#popup-overlay .popup").each(function(){a.Popup.hide($(this))}),$('[data-toggle="tooltip"]').tooltip("destroy"),bc&&window.Intercom("update")},Kore.Routes=a.Routes,b._mainContainer=$("#main"),a.Util.bind(),h(),Mb){if(a.Lib.Tabs.add(_b||"app"),!na().app.user_info.tutorial_done)return void window.location.assign(p("tutorial",!1));e(),f(),window.Raven&&window.Raven.setUserContext({email:b.user().email,id:b.user().user_id}),a.API.Main.load({onSuccess:function(b){var c=new a.API.Main.Session.LoadResponse(b);moment.locale(xa());var d;switch(xa()){case"fr-fr":d="fr";break;default:d=""}$.datepicker.setDefaults($.datepicker.regional[d]),$.datepicker.setDefaults({dateFormat:ya().dateFormat}),w(c.users),L(c.projects);var e={};for(var f in c.categories)if(c.categories.hasOwnProperty(f)){var g=c.categories[f];e[g.category_id]=g}S(e),aa(c.account),ba(c.accounts),da(c.tags),new a.UserStatus.PresenceMonitoring(function(b){a.API.Main.setUserStatus(b)}),$.uniform.defaults.fileButtonHtml=a.Global.trans("choose_file"),$.uniform.defaults.fileDefaultHtml=a.Global.trans("no_file_selected"),$(".lang-block").removeClass("hidden"),$(document).on("click",".show-sidebar",function(){j()}),$(document).on("click","#project-overlay",function(){$("#sidebar").hasClass("open")&&j()}),$(document).on("click",".header_menu_container.onclick-active-once",function(a){if(!$(a.target).is(".header_menu_entry")&&!$(a.target).parents(".header_menu_entry").length)return $(a.target).is(".header_menu")||$(a.target).parents(".header_menu").length?(a.stopPropagation(),void a.stopImmediatePropagation()):void 0}),$(document).on("click",".onclick-active-once",function(){var a=$(this);a.hasClass("active")?a.removeClass("active"):(a.addClass("active"),$(document).one("click",function(){a.removeClass("active")}))}),$(document).on("click",".logout",function(){Kore.ajaxLogout("logout")}),Kore.onViewLoaded($("body")),new a.DropZone($("body"),function(){return!(!a.Global.project()||a.Global.module()!=a.Global.MODULES.DOCUMENTS)},function(b){var c=0;a.Global.module()==a.Global.MODULES.DOCUMENTS&&(c=a.Script.Documents.oTreeController.getCurrentFolder().dir_id),a.Script.Documents.addFiles(b,c)}),new a.DropZone($("body"),function(){return!(!a.Global.project()||a.Global.module()!=a.Global.MODULES.CHANNEL)},function(b){a.Script.Channel.addFiles(b)}),bb(),Kore.routing()}})}else console.log("NOT LOGGED"),Ob&&(console.log("GUEST"),a.Lib.Tabs.add(_b||"app"),bb(),Kore.routing())}function d(a){fc?a():ec.push(a)}function e(){if(!Kore.NODEJS_SERVER)return void console.log("/!\\ NodeJS deactivated or badly configured /!\\");var c=null;try{c=io.connect(Kore.NODEJS_SERVER,{transports:["websocket"],query:{authtoken:Kore.getAuthToken()}})}catch(a){console.log(a)}if(c){var d=null;c.on("connect",function(){console.log("Connected!"),fc=!0;for(var a in ec)ec.hasOwnProperty(a)&&ec[a]();ec=[]}).on("reconnect",function(){d&&d.is(":visible")||(d=a.Notifications.notifyWarning(b.trans("out_of_sync.message"),{duration:0,onClick:function(){location.reload()}}))}).on("generic",function(b){a.Push.onMessage(b)}).on("error",function(a){console.log("#### socket error"),console.log(a)})}Kore.setSocket(c)}function f(){if(Kb()){bc=!0;var a=na().app.intercom.intercom_app_env,c=a?a+"_":"";window.Intercom("boot",{app_id:na().app.intercom.intercom_app_id,name:b.user().first_name+" "+b.user().last_name,email:b.user().email,user_id:c+b.user().user_id,created_at:b.conf().app.user_info.date_create.format("X")})}}function g(a,b){void 0===b&&(b={}),Kore.getSocket().emit("generic",{event:a,data:b})}function h(){$.ionSound&&$.ionSound({sounds:[{name:"chat.message"},{name:"air.incoming"},{name:"air.join"},{name:"air.leave"},{name:"air.end"}],volume:1,path:q("sounds/"),preload:!0})}function i(){return!Nb}function j(){var a=$("#sidebar"),b=!a.hasClass("open");a.toggleClass("open",b),setTimeout(function(){$(".show-sidebar").toggleClass("active",b)},300)}function k(b,c){_b=b,c&&a.Lib.Tabs.setType(b)}function l(a){Mb=a}function m(a){Nb=a}function n(a){Ob=a}function o(){return Ob}function p(a,b,c){return a=(b?"/#/":"/")+a,c&&(a="/autologin?page="+a.replace("#","%23")),Kore.url(a)}function q(a,b,c){return void 0===b&&(b=!1),void 0===c&&(c=!1),a="/"+a,b&&(a="/custom/"+qa(!0)+a),Kore.urlStatic(a,c)}function r(a,b){return void 0===b&&(b=!1),q(a,!0,b)}function s(a,b){return void 0===b&&(b=!1),q("images/"+a,!1,b)}function t(a,b){return void 0===b&&(b=!1),q("images/"+a,!0,b)}function u(a){return a?Pb=new Model.User(a):Pb}function v(a){var b=u();return!!b&&b.role>=a}function w(a){return a.sort(function(a,b){var c=a.display_name.toLowerCase(),d=b.display_name.toLowerCase();return c<d?-1:c>d?1:0}),Qb=a}function x(a,b,c,d){void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1),void 0===d&&(d=!1);var e=[];for(var f in Qb)if(Qb.hasOwnProperty(f)){var g=Qb[f];if(g.user_id==u().user_id&&!b)continue;if(g.trash&&!c)continue;if(g.deleted&&!d)continue;e.push(g)}if(a){var h={};for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];h[g.user_id]=g}return h}return e}function y(a,b,c){return void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1),x(!1,a,b,c)}function z(a,b,c){return void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1),x(!0,a,b,c)}function A(a){void 0===a&&(a=!1);var b=[];return $.each(Qb,function(c,d){if(d.isFellow()){if(!a&&u().user_id==d.user_id)return;b.push(d)}}),b}function B(a){G(a.user_id),Qb.push(a)}function C(a){G(a.user_id),Qb.push(a)}function D(a){for(var b in Qb)if(Qb.hasOwnProperty(b)){var c=Qb[b];if(c.user_id==a){c.trash=!1;break}}}function E(a){for(var b in Qb)if(Qb.hasOwnProperty(b)){var c=Qb[b];if(c.user_id==a){c.trash=!0;break}}}function F(a){G(a)}function G(a){for(var b in Qb)if(Qb.hasOwnProperty(b)&&Qb[b].user_id===a){Qb.splice(parseInt(b),1);break}}function H(b,c){for(var d in Qb)if(Qb.hasOwnProperty(d)){var e=Qb[d];if(b===e.user_id){Qb[d].status=c,a.Sidebar.setUserStatus(b,c),$(".avatar[data-user="+e.user_id+"][data-status]").attr("data-status",c);for(var f in cc)cc.hasOwnProperty(f)&&cc[f](b,c);break}}}function I(a){cc.push(a)}function J(a){return void 0!==a&&(Rb=a||null),Rb}function K(a){var b=a.project_id;M(!0,!0,!0)[b]||Ub.push(a)}function L(a){return Ub=a}function M(a,b,c,d){void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1),void 0===d&&(d=!1);var e=[];for(var f in Ub)if(Ub.hasOwnProperty(f)){var g=Ub[f];if(!c&&!g.belong)continue;if(!b&&g.archive)continue;if(d&&(g.belong||c)&&!g.archive&&!g.trash)continue;e.push(g)}if(a){var h={};for(var f in e)if(e.hasOwnProperty(f)){var g=e[f];h[g.project_id]=g}return h}return e}function N(a,b,c){void 0===a&&(a=!1),void 0===b&&(b=!1),void 0===c&&(c=!1);var d=M(!1,b,a,c),e=T(),f={},g=[];$.each(d,function(a,b){f[b.category_id]||(f[b.category_id]={projects:[],name:e[b.category_id].category_name,id:b.category_id}),f[b.category_id].projects.push(b)});for(var h in f)f.hasOwnProperty(h)&&g.push(f[h]);var i=function(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0};g.sort(i);for(var j in g)g.hasOwnProperty(j)&&g[j].projects.sort(i);return g}function O(c,d){var e=M(!0,!0,!0);if(!e[d.project_id])return void console.warn("onUserAddedToProject - Project not found "+d.project_id);if(e[d.project_id].user_id_list.push(c),u().user_id==c&&(e[d.project_id].auth=d.auth,e[d.project_id].belong=!0),e[d.project_id].auth_list){var f=new Model.UserAuth({user_id:c,auth:d.auth});e[d.project_id].auth_list.push(f)}J()&&J().project_id==d.project_id&&(a.Sidebar.setProjectUsers(J()),a.Sidebar.setUserRights(b.module()))}function P(b,c){var d=M(!0,!0,!0)[c];if(!d)return void console.warn("onUsersRemovedFromProject - Project not found "+c);var e=J(),f=e&&e.project_id==c,g=!1;for(var h in b)if(b.hasOwnProperty(h)){var i=b[h];Q(i,d),f&&i==u().user_id&&(g=!0)}g?Kore.navigate("/"):f&&a.Sidebar.setProjectUsers(e)}function Q(b,c){if(c.user_id_list=a.Util.arrayRemove(c.user_id_list,b),b==u().user_id){c.belong=!1;for(var d in c.auth)c.auth.hasOwnProperty(d)&&(c.auth[d]=0)}if(c.auth_list)for(var e in c.auth_list)if(c.auth_list.hasOwnProperty(e)){var f=c.auth_list[e];if(f.user_id==b){c.auth_list.splice(parseInt(e),1);break}}}function R(b,c,d){console.log("onUserAuthEditedForProject: ",b,c,d);for(var e in Ub)if(Ub.hasOwnProperty(e)){var f=Ub[e];if(f.project_id==d){b==u().user_id&&(f.auth=c);var g=f.auth_list;for(var h in g)if(g.hasOwnProperty(h)){var i=g[h];if(i.user_id!==b)continue;var j=!1;if(b==u().user_id){var k=W(),l=i.auth[k],m=c[k];l!==m&&(j=!0)}i.auth=c,f.auth_list[h]=i,j?Kore.reload():J()&&a.ModuleBar.initForProject(a.Global.project()),J()&&a.Sidebar.setUserRights(W());break}}}}function S(a){return Vb=a}function T(){return Vb}function U(){var a=[];for(var b in Vb)if(Vb.hasOwnProperty(b)){var c=Vb[b];a.push(c)}return a.sort(function(a,b){return a.category_name<b.category_name?-1:a.category_name>b.category_name?1:0}),a}function V(b){null===Wb?a.API.Main.getProjectTemplates({onSuccess:function(c){var d=new a.API.Main.Account.GetProjectTemplatesResponse(c);Wb=d.templates,b(Wb)},onError:function(){return b([]),!1}}):b(Wb)}function W(b){if(b){var c=W();c&&a.Push.unsubcribeView(c),Sb=b}return Sb}function X(a){return Tb=a}function Y(){return Tb}function Z(a){return!!Y()[a]}function _(){return!aa().sharing_actions_disabled}function aa(a){return a&&(Xb=a),Xb}function ba(a){return Yb=a}function ca(){return Yb}function da(a){Zb={},a.forEach(function(a){Zb[a.tag_id]=a})}function ea(){var a=[];for(var b in Zb)if(Zb.hasOwnProperty(b)){var c=Zb[b];a.push(c)}return a}function fa(){var a=[];for(var b in Zb)if(Zb.hasOwnProperty(b)){var c=Zb[b];a.push(c.label)}return a}function ga(a){var b=fa(),c=new RegExp($.ui.autocomplete.escapeRegex(a),"i");return $.grep(b,function(a){return c.test(a)})}function ha(a){return Zb[a]||null}function ia(a){for(var b in Zb)if(Zb.hasOwnProperty(b)){var c=Zb[b];if(c.label==a)return c}return null}function ja(a){Zb[a.tag_id]=Zb[a.tag_id]||a}function ka(a){delete Zb[a]}function la(a){return!!Zb[a]}function ma(){var a=aa();return a?a.getCompanyName():Kore.getAccountName()}function na(a){return a&&($b=pa().configFromJSON(a)),$b}function oa(b){dc=a.AppCustom.newCustomApp(b)}function pa(){return dc}function qa(a){return na().ui.custom_resources_path||(a?"wimi":null)}function ra(b){
a.API.Main.setUserLanguage(b,{onSuccess:function(){location.reload()}})}function sa(){return na().app.user_info?na().app.user_info.date_format_family:"en-us"}function ta(){return a.Global.trans("date.format."+a.Global.getUserDateFormatFamily())}function ua(){return na().app.user_info?na().app.user_info.timezone:null}function va(){var a=na().app.user_info.locale_id;return na().getLocaleForId(a)}function wa(){return u()&&!!u().gapps_uid}function xa(){return na().ui._locale}function ya(){var a={};return a[b.UserDateFormats.FR]={eventTimeDisplay:"HH : mm",dateFormat:"DD/MM/YYYY",datetimeFormat:"DD/MM/YYYY LT"},a[b.UserDateFormats.EN]={eventTimeDisplay:"hh : mm a",dateFormat:"MM/DD/YYYY",datetimeFormat:"MM/DD/YYYY LT"},a[b.getUserDateFormatFamily()]}function za(b){if(!b)return console.log("no view to load"),null;$.fn.searchInput&&$("ul[data-search-input]",b).searchInput(),$("[autofocus]",b).focus(),$.fn.dynamicTextarea&&$("textarea[data-dynamic]",b).each(function(){var a=$(this);a.dynamicTextarea(null,!!a.attr("data-allow-new-line"))}),$("[data-shadow]:not(.shadow-on-scroll)").each(function(){var b=$(this),c=$(this).data("shadow-top")?$($(this).data("shadow-top")):null;a.Util.shadowOnScroll(b,c)}),a.Util.uniform();var c=$("input.input-date",b);return c.length&&"date"!==c.first()[0].type&&$.each(c,function(){$(this).date($(this).data("date"))}),b}function Aa(a,c,d,e){void 0===e&&(e=b._mainContainer),Kore.view(a,c,d,e)}function Ba(a,b,c,d,e){Ga(d,e,function(d){Kore.view(a,b,c,d)})}function Ca(a,b,c,d){Fa(c,function(c){Kore.view(a,b,d,c)})}function Da(a,b,c,d){Ha(d,function(d){Kore.view(a,b,c,d)})}function Ea(a,b,c){Ia(function(d){Kore.view(a,b,c,d)})}function Fa(c,d){J(null);var e=W();$("#user-module").length&&e===c?console.log("==> Layout already loaded"):(console.log("==> Load layout"),Aa(a.Templates.Global.userLayout,{user:u()}),a.Sidebar.initForUser(u()),a.MultiProject.setProject()),b._projectContainer=$("#project-content"),W(c),Sa(c),a.Panel.resetPanel(),Va(null,b.trans("modules."+c)),$.isFunction(d)&&d(b._projectContainer)}function Ga(c,d,e){console.log("__ ensureProjectLayout"),Ja(c,function(c){var f=!!$('#project[data-project="'+c.project_id+'"]').length;if(f)console.log("==> Layout already loaded");else{console.log("==> Load layout");var g=Qa(!1);Aa(a.Templates.Global.projectLayout,{modules:g,project:c}),a.Sidebar.initForProject(c),a.ModuleBar.initForProject(c),a.MultiProject.setProject(c)}b._projectContainer=$("#project-content");var h=W()==d;W(d),f&&h||(Ra(d),a.Panel.resetPanel()),Va(c.name,b.trans("modules."+d)),$.isFunction(e)&&e(b._projectContainer,c)},function(){return window.location.assign(b.url("",!0)),!0})}function Ha(c,d){J(null),$("#account-content").length?console.log("==> Account layout already loaded"):(console.log("==> Load account layout"),Aa(a.Templates.Account.accountLayout),a.Sidebar.Account.init(),a.MultiProject.setProject()),a.Sidebar.Account.setPage(c),b._projectContainer=$("#project-content"),W(b.MODULES.ACCOUNT),a.MultiProject.setModule(b.MODULES.ACCOUNT),a.Panel.resetPanel(),Va(null,b.trans("modules."+b.MODULES.ACCOUNT)+" - "+b.trans("account.page."+c)),d&&d(b._projectContainer)}function Ia(c){J(null),a.MultiProject.setProject(),b._projectContainer=null,W(b.MODULES.DASHBOARD),a.MultiProject.setModule(null),a.Panel.resetPanel(),Va(null,b.trans("modules."+b.MODULES.DASHBOARD)),c&&c(b._mainContainer)}function Ja(a,b,c){var d=J();if(d&&d.slug===a)return $.isFunction(b)?b(d):d;var e=Na(),f=Model.Project.getProjectBySlug(a);f.getUsersAuth(function(){Ma(e),J(f),b&&b(J())},null,function(){return Ma(e),!c||c()})}function Ka(a){return $('<div class="overlay-screen"><span class="middle inline-block section">'+a+"</span></div>")}function La(b){return b=b||Ya("loading"),Ka(a.Templates.Global.loadingScreen({message:b,loading_image_url:a.Global.custom().getLoadingImageURL()}))}function Ma(a){a.remove()}function Na(a){var c=La(a);return b._mainContainer.append(c),c}function Oa(a){var c=La(a);return b._projectContainer.append(c),c}function Pa(){if(b._projectContainer){var c=a.Templates.Global.unauthorizedModule({message:Ya("unauthorized_access")}),d=Ka(c);return b._projectContainer.html(d),d}}function Qa(c){var d=[],e=a.Rights.modulesAvailableForRightsEdition();return $.each(Y(),function(f,g){if(g&&(!c||-1!==$.inArray(f,e))){var h={};switch(f){case b.MODULES.DOCUMENTS:h={id:b.MODULES.DOCUMENTS,icon:"file-o"};break;case b.MODULES.TASKS:h={id:b.MODULES.TASKS,icon:"check"};break;case b.MODULES.AGENDA:h={id:b.MODULES.AGENDA,icon:"calendar"};break;case b.MODULES.MEETINGS:h={id:b.MODULES.MEETINGS,icon:"group"};break;case b.MODULES.ACTIVITY:h={id:b.MODULES.ACTIVITY,icon:"bell"};break;case b.MODULES.REPORTING:h={id:b.MODULES.REPORTING,icon:"bar-chart"};break;case b.MODULES.CHANNEL:h={id:b.MODULES.CHANNEL,icon:"hashtag"}}h.auth=a.Rights.authCodesForModule(f),h.trad="modules."+f,d.push(h)}}),d}function Ra(a){$("#module-list").find(".module").removeClass("active").filter("#menu-"+a).addClass("active"),Ta(a,!1)}function Sa(a){Ta(a,!0)}function Ta(b,c){void 0===c&&(c=!1),a.MultiProject.setModule(b),a.Sidebar.setModule(b,c)}function Ua(b){window.focus(),setTimeout(function(){a.Lib.Tabs.hasFocus()||alert(b)},100)}function Va(a,c){var d=[];a&&d.push(a),c&&d.push(c),d.push(b.getCompanyName()),d.push(b.conf().app.name),document.title=d.join(" - ")}function Wa(a,b){a&&!Xa(b)?(ac[b]=!0,$('[data-select-mode-off="'+b+'"]').addClass("hidden"),$('[data-select-mode-on="'+b+'"]').removeClass("hidden")):!a&&Xa(b)&&(ac[b]=!1,$('[data-select-mode-off="'+b+'"]').removeClass("hidden"),$('[data-select-mode-on="'+b+'"]').addClass("hidden"))}function Xa(a){return!!ac[a]}function Ya(a,b){if(!Za(a))return(na().ui.dev?"FIXTRAD_":"")+a;var c=l10n[a];if(void 0!==b)for(var d in b){var e=b instanceof Array,f=e?parseInt(d)+1:d;if(e)c=c.replace(new RegExp("%"+f,"g"),b[d]);else{var g=new RegExp("{"+f+"}","g");c=c.replace(g,b[d]);var h=new RegExp("%"+f,"g");c=c.replace(h,b[d])}}return c}function Za(a){return void 0!==l10n[a]}function $a(a){return a.replace(b.REGEX_URLS,'<a href="$1" target="_blank">$1</a>')}function _a(a){var b=["aac","ai","aiff","asp","avi","bmp","c","cpp","css","dat","dmg","doc","docx","dot","dotx","dwg","dxf","eps","evernote","exe","flv","gif","google","h","html","ics","iso","java","jpg","jpeg","js","key","m4v","mid","mov","mp3","mp4","mpg","mpeg","odp","ods","odt","otp","ots","ott","pdf","php","png","pps","ppt","pptx","psd","py","qt","rar","rb","rtf","sql","tga","tgz","tiff","txt","wav","xls","xlsx","yml","zip"];return $.inArray(a,b)>-1?a:"default"}function ab(a){return a.split(".").pop()}function bb(){$("#main-load").remove(),a.Search.init(),a.Footer.init(),a.MutliWimi.init(),a.MultiProject.init(),a.Communication.init(),a.Script.Documents&&a.Script.Documents.MyValidations&&a.Script.Documents.MyValidations.init()}function cb(a,c){if(void 0===c&&(c=!1),a!==J().slug||c){c?Kore.clearView(b._mainContainer):Kore.clearView(b._projectContainer);var d=W();a===J().slug?Kore.reload():Kore.navigate(a+"/"+d)}}function db(b,c,d){b=b||J().project_id;var e=M(!0,!0)[b],f={popover:{trigger:c,options:{container:"body",html:!0,placement:"bottom"}},onShown:function(c){c.on("click",".edit",function(){var e=$('input[name="name"]',c).val(),f=$('textarea[name="info"]',c).val(),g=$('select[name="category"]').val();eb(b,e,f,g,function(b){a.Popup.hide(c,{destroy:!0}),$.isFunction(d)&&d(b)})})}};a.Popup.popup(a.Templates.Global.projectEdit({project:e,categories:U()}),f)}function eb(b,c,d,e,f){var g={project_name:c,info:d,category_id:e};a.API.Main.updateProject(b,g,{onSuccess:function(b){var c=new a.API.Main.Project.UpdateResponse(b),d=c.project;$.isFunction(f)&&f(d)}})}function fb(a){var b=M(!1,!0,!0);for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d.project_id==a.project_id){d.name=a.name,d.slug=a.slug,d.info=a.info,d.category_id=a.category_id,d.category_name=a.category_name,d.archive=a.archive,d.trash=a.trash,d.custom_image_id=a.custom_image_id,d.modules=a.modules,lb(d);break}}}function gb(a,b){var c=M(!1,!0,!0);for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];if(e.project_id==a){e.addTag(b);break}}}function hb(b,c){var d=M(!1,!0,!0);for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];if(f.project_id==b){f.tags=a.Util.arrayRemoveElement(f.tags,c.tag_id,function(a){return a.tag_id});break}}}function ib(b){for(var c in Ub)if(Ub.hasOwnProperty(c)){var d=Ub[c];if(d.project_id==b)return void a.Util.arrayRemove(Ub,c,!0)}}function jb(a){if(M(!0,!1,!0)[a.project_id])return void console.warn("project already added! "+a.project_id);Ub.push(a),lb(a)}function kb(a){for(var b in Vb)if(Vb.hasOwnProperty(b)){var c=Vb[b];if(c.category_id==a.category_id){c.category_name=a.category_name;break}}}function lb(a){Vb[a.category_id]||(Vb[a.category_id]=new Model.Category({category_id:a.category_id,category_name:a.category_name,category_url_ico:null}))}function mb(c,d,e){var f=c.project_id,g=[],h={},i=Model.User.getUsersSorted(!0);$.each(c.auth_list,function(a,b){var c=i[b.user_id];g.push({user:c,auth:b.auth}),h[b.user_id]=b.auth});var j={destroy:!0,popover:{trigger:d,options:{container:"body",html:!0}},onShown:function(b){b.on("click",".switch-module-rights",function(){var a=$(this),b=a.closest("th").index(),c=null;a.closest("table").find("tbody tr").each(function(){var a,d=$(this),e=$("td",d).eq(b);null===c?(a=$(".control-switch-on",e),c=a.index()):(a=$(".control-switch",e).eq(c).addClass("control-switch-on"),a.siblings(".control-switch").removeClass(".control-switch-on")),a.trigger("click")}),a.focus()}).on("submit","form",function(){var c=[],d=$(".auth-edit-table .user-row");$.each(d,function(a,b){var d=new Model.UserAuth({});d.auth=new Model.Auth({});var e=$(b),f=$(".module-right",e);$.each(f,function(a,b){var c=$(b),e=c.data("module");d.auth[e]=$(".auth-control.control-switch-on",c).data("right")}),d.user_id=e.data("user"),d.auth.isEqual(h[d.user_id])||c.push(d)}),nb(f,c,function(){a.Popup.hide(b,{destroy:!0}),$.isFunction(e)&&e()})})}};a.Popup.popup(a.Templates.Global.projectEditRights({project:c,users_rights:g,modules:b.modulesToDisplay(!0)}),j)}function nb(b,c,d){for(var e in c)if(c.hasOwnProperty(e)){var f=c[e];a.API.Account.editUserProjectAuthList(f.user_id,b,f.auth.getModulesAuth())}d&&d()}function ob(b){var c=a.Templates.Main.createUser({roles:a.Roles.getAvailableRoles(),langs:na().app.lang,locale:xa()});a.Popup.popup(c,{onShown:function(c){c.on("click","[name=notify]",function(){var a=$(this).prop("checked");c.find("[name=message]").toggleClass("hidden",!a)}).on("change","[name=role]",function(){var b=$(this).closest("form"),c=b.find("[name=role]:checked");parseInt($.trim(c.val()))==a.Roles.ROLES.GUEST&&a.Popup.popup(a.Templates.Main.guestConfirm(),{onShown:function(b){var d=b.find(".confirm"),e=b.find(".cancel");b.on("change","#add-guest-confirm",function(){var a=$(this).prop("checked");d.prop("disabled",!a)}),d.click(function(){a.Popup.hide(b)}),e.click(function(){c.prop("checked",!1)})}})}).on("submit","form",function(){var d=$(this),e=d.find("button[type=submit]"),f=$.trim(d.find("[name=first_name]").val()),g=$.trim(d.find("[name=last_name]").val()),h=$.trim(d.find("[name=login]").val()),i=$.trim(d.find("[name=lang]").val()),j=parseInt($.trim(d.find("[name=role]:checked").val())),k=d.find("[name=notify]").prop("checked"),l=$.trim(d.find("[name=message]").val());a.API.Account.addUser(f,g,h,j,i,k,l,{button:e,onSuccess:function(d){if(a.Popup.hide(c),b){var e=new a.API.Main.Account.AddUserResponse(d),f=e.user;b(f)}}})})}})}function pb(a,b,c){var d=a.project_id,e=Model.User.getUsers(!0),f=a.user_id_list;Hb(e.filter(function(a){return-1===$.inArray(a.user_id,f)}),function(a){var b=a.map(function(a){return a.user_id});qb(d,b,function(a){$.isFunction(c)&&c(a)})},{title:Ya("add_user_to_project"),actionLabel:Ya("add"),popopver:{trigger:b},selectAll:!0,canCreate:!0})}function qb(b,c,d){for(var e in c)if(c.hasOwnProperty(e)){var f=c[e];a.API.Account.addUserProjectAuth(f,b)}}function rb(b,c,d,e){var f=b.project_id,g=Model.User.getUser(c),h={popover:{trigger:d,options:{container:"body",placement:"top"}},onShown:function(b){b.on("submit","form",function(){sb(f,[c],function(){a.Popup.hide(b,{destroy:!0}),$.isFunction(e)&&e()})})}};a.Popup.popup(a.Templates.Global.projectRemoveUser({user_name:g.display_name,project_name:b.name}),h)}function sb(b,c,d){a.API.Main.removeUsersFromProject(c,b,{onSuccess:function(){d&&d()}})}function tb(a){var b=na().app.services[a];return b||(console.warn("service not found: "+a),null)}function ub(a){var b=tb(a);return!!b&&(!!b.active&&!!b.enabled)}function vb(a,b){var c=tb(a);c&&(c.enabled=b)}function wb(a){var b=tb(a);return!!b&&!!b.active}function xb(b){var c=Model.User.getUser(b);if(!c)return console.warn("showUserDetails user not found",b);var d=a.Util.avatar(c.user_id,{size:64,html:!0,tooltip:!1,status:!0}),e=a.Templates.Global.userDetails({avatar:d,first_name:c.first_name,last_name:c.last_name,email:c.email,phone:c.phones[0],phone_bis:c.phones[1],title:c.title,titleField:a.Global.custom().textForUserTitleField(),department:c.department,company:c.company_name,skype:c.skype,tags:c.getTags().length?c.getTags():null,timezone:c.timezone,user_id:c.user_id,trash:c.trash,deleted:c.deleted});a.Popup.popup(e)}function yb(c){var d=a.Templates.Global.relog({email:b.user().email}),e={onShown:function(b){b.on("submit","form",function(){var d=$.trim($(this).find('[name="password"]').val());if(d){var e=b.find(".button[type=submit]"),f=b.find(".bad-password");f.addClass("hidden"),a.API.relog(d,{onSuccess:function(){c(),a.Popup.hide(b)},onError:function(){return f.removeClass("hidden"),!1},button:e})}})}};a.Popup.popup(d,e)}function zb(c,d){var e=ea(),f={};for(var g in c)if(c.hasOwnProperty(g)){var h=c[g];for(var i in h)if(h.hasOwnProperty(i)){var j=h[i];f[j.tag_id]=f[j.tag_id]||0,f[j.tag_id]++}}e=e.sort(function(a,b){var d,e=f[a.tag_id]>0?f[a.tag_id]==c.length?2:1:0,g=f[b.tag_id]>0?f[b.tag_id]==c.length?2:1:0;return e==g&&(d=a.label.toLowerCase()<b.label.toLowerCase()?-1:1),e>g&&(d=-1),e<g&&(d=1),d});var k=a.Templates.Global.manageItemsTags();a.Popup.popup(k,{onShown:function(a){function g(a){var d=f[a.tag_id]||0,e=d==c.length,g=$('<li class="checkbox-selector" data-tag="'+a.tag_id+'"><table class="full-width"><tr><td><input type="checkbox" class="icon-left"><span class="item-tag">'+a.label+'</span></td><td class="min nowrap">'+(d?'<button class="button button-link button-red button-icon tag-remove" data-toggle="tooltip" data-placement="top" title="'+b.trans("items_remove_tag")+'" data-container=".checkbox-selector[data-tag='+a.tag_id+']"><i class="fa fa-fw fa-minus"></i></button>':"")+(e?"":'<button class="button button-link button-green button-icon tag-add" data-toggle="tooltip" data-placement="top" title="'+b.trans("items_add_tag")+'" data-container=".checkbox-selector[data-tag='+a.tag_id+']"><i class="fa fa-fw fa-plus"></i></button>')+"</td></tr></table></li>");return g.find("input[type=checkbox]").prop({indeterminate:!!d&&!e,checked:!!e,disabled:!0}),g}for(var h in e)if(e.hasOwnProperty(h)){var i=e[h];a.find(".tag-list").append(g(i))}a.on("click",".tag-add",function(){if(d.onTagAdded){var a=$(this),b=a.closest("[data-tag]"),e=b.data("tag"),h=ha(e);d.onTagAdded(h,a,function(a){a&&(f[e]=c.length,b.replaceWith(g(h)))})}}).on("click",".tag-remove",function(){if(d.onTagRemoved){var a=$(this),b=a.closest("[data-tag]"),c=b.data("tag"),e=ha(c);d.onTagRemoved(e,a,function(a){a&&(f[c]=0,b.replaceWith(g(e)))})}})}})}function Ab(b){var c=ea().sort(function(a,b){return a.label.toLowerCase()<b.label.toLowerCase()?-1:1});a.Popup.popup(a.Templates.Global.tagPicker({tags:c}),{onShown:function(a){a.on("click","[data-tag]",function(){var a=parseInt($(this).data("tag")),c=ha(a);b(c)})}})}function Bb(){var a;try{a=JSON.parse(localStorage.getItem("wimi_pref")),"object"==typeof a&&null!==a||(a={})}catch(b){a={}}return a}function Cb(a,b){var c=Bb();return c[a]=b,localStorage.setItem("wimi_pref",JSON.stringify(c)),b}function Db(a,b){void 0===b&&(b=null);var c=Bb();return void 0!==c[a]?c[a]:b}function Eb(){var a=Path.routes.current,b=a.split("?");return b.length<2?{}:b[1].replace(/(^\?)/,"").split("&").map(function(a){return a=a.split("="),a[0].endsWith("List")&&(a[1]=a[1].split(","),1==a[1].length&&""==a[1]&&(a[1]=[])),this[a[0]]=a[1],this}.bind({}))[0]}function Fb(a){var b=Path.routes.current,b=b.split("?")[0],c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];c.push(d+"="+e)}"/"==b.slice(-1)&&(b=b.slice(0,-1)),c.length&&(b+="/?"+c.join("&")),"#"===b.charAt(0)&&(b=b.slice(1)),Kore.modifyRoute(b,!0)}function Gb(a,b){if($.isArray(b)){b=b.join(",")}var c=Eb();null!==b?c[a]=b:delete c[a],Fb(c)}function Hb(c,d,e){c=c||[];var f=e.selectedUserIds||[],g=!!e.selectAll;!g&&f.length&&console.warn("showUserPicker : cannot have 'selectedUserIds' set and 'selectAll' to false - ignoring 'selectedUserIds'");var h={destroy:!0,onShown:function(e){var h=new a.TableController({layoutView:function(){return'<div class="tree-container tree-compact"><table class="tree full-width"><thead></thead><tbody class="tree-body"></tbody></table></div>'},entryView:function(a,b){var c=b;return'<tr class="tree-row" data-entry="'+b.entry_getId()+'">'+(g?'<td class="user checkbox-selector min"><input type="checkbox"></td>':"")+'<td class="min"><span class="avatar no-margin" style="background-image: url(\''+c.avatarPath()+"')\">"+(c.hasAvatar()?"":c.initials)+"</span></td><td>"+c.fullName()+"</td></tr>"},emptyView:function(){return'<div class="tree-empty">'+b.trans("no_contrib_to_add")+"</div>"},headerView:function(){return"<tr>"+(g?'<th class="min"><input class="toggle-all" type="checkbox"></th>':"")+'<th></th><th data-sort="name">'+b.trans("name")+"</th></tr>"},sortCriteria:"name",sortOrder:a.TreeSortOrder.ASC,onSortEntries:function(b,c,d,e){var f=b,g=c,h=0;switch(d){case"name":default:h=f.fullName().toLowerCase()>g.fullName().toLowerCase()?1:-1}return h=e==a.TreeSortOrder.ASC?h:-1*h,h||(h=f.fullName().toLowerCase()>g.fullName().toLowerCase()?1:-1),h},loaded:function(b,c){g&&(c.selection=new a.Util.Selection(b.find("tbody"),'input[type="checkbox"]',{toggleCheckbox:b.find(".toggle-all"),onChanged:function(a,b){$(".select-users",e).prop("disabled",!a),b&&b.stopPropagation()}}))},onEntryClicked:function(b,c){if(g)h.toggleSelectionForEntryId(b.entry_getId(),c);else{d([b]),a.Popup.hide(e)}}});h.setFilter(e.find(".search-input")),h.setEntries(c),h.refreshData(),f.forEach(function(a){h.selectEntryForId(a,null)}),e.find(".users-table").html(h.$tree),e.on("click",".create-user",function(){ob(function(a){var b=h.addEntry(a,!0);h.selectEntryView(b,null)})}).on("submit","form",function(){var b=h.getSelection(),c=b.map(function(a){return h.getEntry(a)});a.Popup.hide(e,{destroy:!0}),d(c)})}};e.popopver&&(h.popover=e.popopver);var i=a.Templates.Global.projectAddUser({users:c,title:e.title,actionLabel:e.actionLabel,listId:"user_picker_"+a.Util.uniqueKey(),selectAll:!!e.selectAll,canCreate:!!e.canCreate}),j=a.Popup.popup(b.viewLoaded($(i)),h);b.viewLoaded(j)}function Ib(a){var c=b.conf().app.drive_protocol+"://action=openfile&file_id="+a+"&wimi="+b.wimi().account_name;return window.location.assign(c),!1}function Jb(a,b){var c=window.open(a,"","height=768,width=1024"),d=window.setInterval(function(){c&&!1!==c.closed&&(clearInterval(d),b())},200)}function Kb(){var a=na();return a&&a.app.intercom.active&&a.app.intercom.enabled&&!!window.Intercom}function Lb(b,c){var d=a.Templates.Global.exportParams(b);a.Popup.popup(d,{onShown:function(a){a.on("click",".export",function(){var d={};if(b.set_name){var e=$.trim(a.find("input[name=filename]").val());d.name=e}if(b.set_format){var f=$.trim(a.find("input[name=format]").val());d.format=f}if(b.set_delimiter){var g=$.trim(a.find('select[name="csv-delimiter"]').val());d.delimiter=g}c(d)})}})}var Mb=!0,Nb=!0,Ob=!1,Pb=null,Qb=[],Rb=null,Sb=null,Tb={},Ub=[],Vb={},Wb=null,Xb=null,Yb=[],Zb={},$b=null,_b=null,ac={},bc=!1,cc=[],dc=null;b._mainContainer=null,b._projectContainer=null,b.MODULES={ACCOUNT:"account",ACTIVITY:"activity",AGENDA:"calendar",AIRTIME:"airtime",AUTH:"auth",CHANNEL:"channel",CHAT:"chat",COMMUNICATION:"communication",DASHBOARD:"dashboard",DOCUMENTS:"documents",MAIN:"main",MEETINGS:"meetings",REPORTING:"reporting",SHARING:"sharing",TASKS:"tasks",THIRD_PARTY:"thirdparty"},b.ENTITIES={ACCOUNT:"account",AIRTIME:"air",CHAT:"chat",DIRECTORY:"directory",ENTRY:"entry",EVENT:"event",FILE:"file",FILTER:"filter",LIST:"tlist",MEETING:"meeting",PROJECT:"project",SEARCH:"search",SERVICE:"service",SESSION:"session",SHARING:"sharing",SUBTASK:"subtask",TASK:"task",TRASH:"trash",TAG:"tag",USER:"user",VALIDATION:"validation",ZAPIER:"zapier"},b.ServicesEnum={BOX:"box",DROPBOX:"dropbox",EVERNOTE:"evernote",GOOGLE:"google",ONEDRIVE:"onedrive",ONEDRIVEPRO:"onedrivepro",SKYPE:"skype",ZAPIER:"zapier"},b.REGEX_URLS=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/gi,b.init=c;var ec=[],fc=!1;b.onNodeConnected=d,b.initNode=e,b.emitPush=g,b.initSounds=h,b.isSuspended=i,b.toggleSidebar=j,b.setWindowType=k,b.setLogged=l,b.setActive=m,b.setGuest=n,b.isGuest=o,b.url=p,b.urlStatic=q,b.urlStaticCustom=r,b.urlStaticImage=s,b.urlStaticImageCustom=t,b.user=u,b.userHasPrivilege=v,b.setUsers=w,b.getUsers=y,b.getUsersSorted=z,b.fellowUsers=A,b.onUserAdded=B,b.onUserEdited=C,b.onUserActivated=D,b.onUserDeactivated=E,b.onUserDeleted=F,b.setUserStatus=H,b.listenToUserStatusChanged=I,b.project=J,b.addProject=K,b.setProjects=L,b.projects=M,b.projectsByCategories=N,b.onUserAddedToProject=O,b.onUsersRemovedFromProject=P,b._removeUserFromProject=Q,b.onUserAuthEditedForProject=R,b.setCategories=S,b.categoriesById=T,b.categories=U,b.getProjectTemplate=V,b.module=W,b.setModules=X,b.modules=Y,b.hasModule=Z,b.canUseSharingActions=_,b.wimi=aa,b.setWimis=ba,b.wimis=ca,b.setTags=da,b.tags=ea,b.tagsLabel=fa,b.tagsLabelForTerm=ga,b.getTag=ha,b.getTagByLabel=ia,b.ensureTag=ja,b.removeTag=ka,b.tagExists=la,b.getCompanyName=ma,b.conf=na,b.setCustom=oa,b.custom=pa,b.getCustomResourcesPath=qa,b.changeLang=ra,b.UserDateFormats={FR:"fr-fr",EN:"en-us"},b.getUserDateFormatFamily=sa,b.getUserDateFormat=ta,b.getUserTimezone=ua,b.getUserLocale=va,b.isGAppsUser=wa,b.getCurrentLocale=xa,b.getLangOptions=ya,b.viewLoaded=za,b.view=Aa,b.viewInProjectLayout=Ba,b.viewInUserLayout=Ca,b.viewInAccountLayout=Da,b.viewInDashboardLayout=Ea,b.ensureUserLayout=Fa,b.ensureProjectLayout=Ga,b.ensureAccountLayout=Ha,b.ensureDashboardLayout=Ia,b.loadProject=Ja,b.overlayScreen=Ka,b.loadingScreen=La,b.loadingEnd=Ma,b.mainLoadingStart=Na,b.projectLoadingStart=Oa,b.unauthorizedModule=Pa,b.modulesToDisplay=Qa,b.ensureProjectModuleLayout=Ra,b.ensureUserModuleLayout=Sa,b.getFocus=Ua,b.setPageTitle=Va,b.toggleSelectModeFor=Wa,b.isSelectModeFor=Xa,b.trans=Ya,b.traductionKeyExists=Za,b.urlsAsLinks=$a,b.iconForExtension=_a,b.getFileExtension=ab,b.ensureGlobalLayout=bb,b.switchProject=cb,b.showEditProject=db,b.editProject=eb,b.onProjectEdited=fb,b.onProjectTagAdded=gb,b.onProjectTagRemoved=hb,b.onProjectDeleted=ib,b.onProjectCreated=jb,b.onCategoryEdited=kb,b.showEditRightsForProject=mb,b.editRightsForProject=nb,b.showCreateUser=ob,b.showAddUserToProject=pb,b.addUserToProject=qb,b.showRemoveUserFromProject=rb,b.removeUserFromProject=sb,b.isServiceEnabled=ub,b.setServiceEnabled=vb,b.isServiceActive=wb,b.showUserDetails=xb,b.showRelog=yb,b.showManageTagsByItems=zb,b.showTagPicker=Ab,b.PREFS={GLOBAL:{ENTER_TO_SEND:"global.enter_to_send"},DASHBOARD:{PROJECT_VIEW:"dashboard.project_view",CONTACT_VIEW:"dashboard.contact_view"},DOCUMENTS:{NOTIFY:"documents.notify",SORT_CRITERIA:"documents.sort_criteria",SORT_ORDER:"documents.sort_order"},CALENDAR:{VIEW:"calendar.view",FILTERS:{1:"calendar.filters.event",2:"calendar.filters.task",3:"calendar.filters.meeting",4:"calendar.filters.event_other",5:"calendar.filters.task_other"},SHOW_BUSY:"calendar.show_busy"},AIRTIME:{GUEST_NAME:"airtime.guest_name"}},b.setPref=Cb,b.getPref=Db,b.getRouteOptions=Eb,b.setRouteOptions=Fb,b.routeOption=Gb,b.showUserPicker=Hb,b.openFileViaDrive=Ib,b.authenticateToService=Jb,b.isIntercomAvailable=Kb,b.showExport=Lb,Kore.onAppLoaded=c}(a.Global||(a.Global={}))}(App||(App={}));var trans=App.Global.trans;String.prototype.dblQuoted=function(){return'"'+this+'"'},String.prototype.toUpperFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},String.prototype.ucwords=function(){return this.replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(a){return a.toUpperCase()})},String.prototype.makeSafe=function(){return $("<div>").text(this).html()},String.prototype.nl2br=function(){return(this+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")},function(a){var b=a.fn.date;a.fn.date=function(c){var d=a(this).first();if(d.is("input.input-date")){if(void 0!==c){if("date"!==d[0].type)if(d.datepicker(),c){moment.isMoment(c)&&(c=c.format(App.Util.UTCFormatDate));var e=d.datepicker("option","dateFormat");d.datepicker("option","dateFormat",App.Util.UTCFormatDate),d.datepicker("setDate",c),d.datepicker("option","dateFormat",e)}else d.val("");else d.val(c);return d}if("date"===d[0].type)return d[0].valueAsDate;var f=d.val();if(f){var g=d.datepicker("option","dateFormat");return moment.utc(f,g)}return null}return void 0!==c?b.call(this,c):b.call(this)}}(jQuery),$.datepicker.defaultParseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(a,b){return b?moment(b,a).toDate():moment().toDate()},$.datepicker.defaultFormatDate=$.datepicker.formatDate,$.datepicker.formatDate=function(a,b){return moment(b).format(a)},$.datepicker.doWithDefaultParsing=function(a){var b=$.datepicker.parseDate;$.datepicker.parseDate=$.datepicker.defaultParseDate;var c=$.datepicker.formatDate;$.datepicker.formatDate=$.datepicker.defaultFormatDate,a(),$.datepicker.parseDate=b,$.datepicker.formatDate=c},function(a){a.fn.commentBox=function(b){function c(){var a=e.val();g.onSend(a,e),g.bClearOnSend&&(e.val(""),e.dynamicTextarea("refresh")),g.bShowControlsOnEditing&&i.addClass("hidden")}function d(b){g.bEnterToSend=b,a(".enter-to-send",h).prop("checked",g.bEnterToSend),a(".newline-info",h).toggleClass("hidden",!b),a('button[type="submit"]',h).toggleClass("hidden",b),App.Global.setPref(App.Global.PREFS.GLOBAL.ENTER_TO_SEND,b)}var e=a(this);if(e.is("textarea")){if("string"==typeof b){var f=b;switch(f){case"refresh":e.dynamicTextarea("refresh");break;case"send":e.closest("form").submit();break;default:console.warn('commentBox: action "'+f+'" undefined')}return}var g=b;e.addClass("comment-box");var h=a('<form action="#"></form>');h.insertBefore(e),e.appendTo(a("<div></div>")).appendTo(h);var i=a('<table class="full-width commentbox-controls"><tr><td><label><input type="checkbox" class="icon-left enter-to-send">'+App.Global.trans("enter_to_send")+'<span class="newline-info float-right">'+App.Global.trans("enter_to_send.new_line",{keys:'<span class="keyboard">Shift</span> + <span class="keyboard">Enter</span>'})+'</span><span class="clear"></span></label></td><td class="min"><button type="submit" class="button button-blue">'+App.Global.trans("envoyer")+"</button></td></tr></table>");h.append(i);var j=!0;e.dynamicTextarea(function(a){if(!a.shiftKey)return j||g.bHideControls?void(g.bEnterToSend&&(a.preventDefault(),c())):void a.preventDefault()}),h.on("change",".enter-to-send",function(){d(a(this).prop("checked")),e.focus()}),d(g.bEnterToSend),h.on("submit",function(){c()}),(g.bShowControlsOnEditing||g.bHideControls)&&(i.addClass("hidden"),j=!1,g.bHideControls||e.on("keyup",function(){i.removeClass("hidden"),j=!0}))}return e}}(jQuery),function(a){a.fn.dynamicTextarea=function(b,c){function d(a){var b=a.clone().val(a.val()),c=a.outerWidth();b.insertAfter(a),b.attr("style",b.attr("style")+"; width: "+c+"px !important; margin: 0px !important;"),b.height(1),a.innerHeight(b[0].scrollHeight),a.trigger("dynamicResize"),b.remove()}var e=a(this);if(e.is("textarea")){if("string"==typeof b){var f=b;switch(f){case"refresh":d(e);break;default:console.warn('dynamicTextarea: action "'+f+'" undefined')}return}e.css("resize","none"),d(e),e.on("keydown",function(a){a.stopPropagation()}),e.on("keyup change",function(b){d(a(this))}),e.on("keypress",function(d){if(d.keyCode===a.ui.keyCode.ENTER){if(b)return b(d);if(c)return;d.preventDefault(),e.blur(),e.focus()}}),d(e)}return e}}(jQuery),function(a){a.fn.searchInput=function(){function b(b,c){if(b.length&&c.length){a("li.active",c).removeClass("active"),b.addClass("active");var d,e=c,f=b.offset().top-e.offset().top+2*b.outerHeight();f>parseInt(e.outerHeight())&&(d=e.scrollTop()+(f-e.outerHeight()),e.stop(1,1).animate({scrollTop:d+"px"},200));var g=b.offset().top-e.offset().top-2*b.outerHeight();g<0&&(d=e.scrollTop()+g,e.stop(1,1).animate({scrollTop:d+"px"},200))}}return a.each(a(this),function(){var c=a(this);if(c.is("ul")){var d="false"!==c.attr("data-search-input-autofocus");c.removeAttr("data-search-input");var e=a("<input type='text' class='input text-input full-width searchinput' placeholder='"+App.Global.trans("rechercher_input")+"'>");d&&e.attr("autofocus","autofocus"),e.insertBefore(c),e.on("keyup",function(){var d=a(this).val(),e=a(this).attr("data-filter");d!=e&&(d||e)&&(a(this).attr("data-filter",d),App.Util.updateSearchFilterForList(d,c,null,!1,function(){b(a("li:visible",c).first(),c),c.trigger("scroll")}))}).on("keydown",function(d){var e,f=d.keyCode||d.which;if(f==App.Keys.up||f==App.Keys.down){d.stopPropagation(),d.preventDefault();var g=a("li.active:visible",c);f==App.Keys.down?(e=g.nextAll("li:visible").first(),e.length||(e=a("li:visible",c).first())):(e=a("li.active:visible",c).prevAll("li:visible").first(),e.length||(e=a("li:visible",c).last())),b(e,c)}else f==App.Keys.enter&&(d.stopPropagation(),d.preventDefault(),e=a("li.active:visible",c),e.trigger("click"))})}else console.warn("$.fn.searchInput can only be called on a ul element")}),a(this)}}(jQuery),$.expr[":"].containsNoCase=$.expr.createPseudo(function(a){return function(b){return $(b).text().toUpperCase().indexOf(a.toUpperCase())>=0}}),function(a){a.fn.valForAttr=function(b){return a(this).map(function(){return a(this).attr(b)}).get()||[]}}(jQuery),function(a){a.fn.requestFullScreen=function(){var b=a(this)[0];return b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen&&b.webkitRequestFullscreen(),a(this)}}(jQuery),function(a){a.fn.serializeObject=function(){var b=this,c={},d=b.serializeArray();return a.each(d,function(a,b){void 0!==c[b.name]?(c[b.name].push||(c[b.name]=[c[b.name]]),c[b.name].push(b.value||"")):c[b.name]=b.value||""}),c}}(jQuery),function(a){a.fn.loading=function(b,c){void 0===b&&(b=!0),void 0===c&&(c=!1);var d=a(this),e=parseInt(d.data("loading")||0);return e+=b?1:-1,d.data("loading",e),d.is(".button-icon")&&d.find("i").toggle(!e),(1==e&&b||!e&&!b)&&d.toggleClass("button-loading",!!b).prop("disabled",c||!!b),d}}(jQuery),function(a){a.fn.insertAtIndex=function(b,c,d){var e=a(this),f=b.children(d);return c?e.insertAfter(f.eq(c-1)):f.length?e.insertBefore(f.eq(0)):b.append(e),e}}(jQuery),function(a){a.fn.scrollToBottom=function(b,c){void 0===b&&(b=0),void 0===c&&(c="easeOutCubic");var d=a(this);return d.scrollTo(d[0].scrollHeight,b,c)}}(jQuery),function(a){a.fn.scrollTo=function(b,c,d){void 0===c&&(c=0),void 0===d&&(d="easeOutCubic");var e=a(this);return e.animate({scrollTop:b},c,d),e}}(jQuery),moment.fn.setUserTimezone=function(){var a=App.Global.getUserTimezone();return this.tz(a),this};var App;!function(a){!function(b){!function(b){function c(){a.Lib.Tabs.bLongPolling=!0}function d(){return a.Lib.Tabs.bLongPolling}function e(){return a.Lib.Tabs.sCurTabUUID}function f(c,d,e,f){if(void 0===d&&(d={}),f=f||a.Lib.Tabs.generateUUID(),"string"==typeof e){var g=e;e=[],e.push(g)
}else e=e||a.Lib.Tabs.getAllIds(!0);if(e.length){var h=(new Date).getTime(),i=a.Lib.Tabs.getAllMessages(),j=h-5e3;for(var k in i)if(i.hasOwnProperty(k)){for(var l=i[k],m=l.length,n=0;n<m;n++)void 0!==l[n]&&(void 0===l[n].ttl||l[n].ttl<j)&&(l.splice(n,1),n--);i[k]=l}$.each(e,function(a,e){void 0===i[e]&&(i[e]=[]);var g={msg_id:f,code:c,data:d,ttl:h};e==b.sCurTabUUID?S([g]):i[e].push(g)}),a.Lib.Tabs.saveAllMessages(i)}}function g(b){var c=b.originalEvent;if("longpolling"==c.key)return void(c.newValue==a.Lib.Tabs.sCurTabUUID&&a.Lib.Tabs.activateLP());"push"==c.key&&(console.log("received new event",b),S(a.Lib.Tabs.getMessages(),!1))}function h(){return JSON.parse(localStorage.getItem("push")||"{}")}function i(a){localStorage.setItem("push",JSON.stringify(a))}function j(){a.Lib.Tabs.saveAllMessages({})}function k(){return a.Lib.Tabs.getMessagesFor(a.Lib.Tabs.sCurTabUUID)}function l(){return a.Lib.Tabs.purgeMessagesFor(a.Lib.Tabs.sCurTabUUID)}function m(){return a.Lib.Tabs.saveMessagesFor(a.Lib.Tabs.sCurTabUUID)}function n(b){for(var c=a.Lib.Tabs.getAllMessages(),d=c[b]||[],e=(new Date).getTime()-5e3,f=d.length,g=0;g<f;g++)void 0!==d[g]&&(void 0===d[g].ttl||d[g].ttl<e)&&(d.splice(g,1),g--);return d}function o(b){a.Lib.Tabs.saveMessagesFor(b,[])}function p(b,c){var d=a.Lib.Tabs.getAllMessages();d[b]=c,a.Lib.Tabs.saveAllMessages(d)}function q(b){var c=!1,d=a.Lib.Tabs.getAll();for(var e in b)if(b.hasOwnProperty(e)){var f=!1;for(var g in d)if(e==g){f=!0;break}f||(c=!0,delete b[e])}return c}function r(b){var c=a.Lib.Tabs.generateUUID();a.Lib.Tabs.sCurTabUUID=c,a.Lib.Tabs.bHasFocus=document.hasFocus(),a.Lib.Tabs.sType=b;var d=a.Lib.Tabs.getAll(),e=0===a.Util.oLength(d);d[c]={type:b,focus:a.Lib.Tabs.bHasFocus?1:0,active:e,alive:Date.now(),uuid:c},setInterval(a.Lib.Tabs.keepAlive,1e3*a.Lib.Tabs.KEEP_ALIVE),a.Lib.Tabs.bLongPolling=e,e&&(a.Lib.Tabs.setActiveLongPolling(c),a.Lib.Tabs.activateLP()),a.Lib.Tabs.save(d),a.Lib.Tabs.saveMessages(),$(window).bind("beforeunload",a.Lib.Tabs.onUnload),$(window).focus(a.Lib.Tabs.onFocus).blur(a.Lib.Tabs.onBlur).on("storage",a.Lib.Tabs.receive)}function s(b,c){var d=a.Lib.Tabs.sCurTabUUID;b=b||a.Lib.Tabs.getAll(),(void 0===b[d]||c)&&(a.Lib.Tabs.bHasFocus=document.hasFocus(),b[d]={type:a.Lib.Tabs.sType,focus:a.Lib.Tabs.bHasFocus?1:0,active:a.Lib.Tabs.bLongPolling,alive:Date.now(),uuid:d},a.Lib.Tabs.save(b),a.Lib.Tabs.saveMessages())}function t(){var b=a.Lib.Tabs.sCurTabUUID;if(b){var c=a.Lib.Tabs.getAll();if(void 0!==c[b]){delete c[b],(a.Lib.Tabs.bLongPolling||1===a.Util.oLength(c))&&$.each(c,function(b){return c[b].active=!0,a.Lib.Tabs.setActiveLongPolling(b),!1}),a.Lib.Tabs.save(c);var d=a.Lib.Tabs.getAllMessages();delete d[b],a.Lib.Tabs.saveAllMessages(d)}}}function u(){var b=a.Lib.Tabs.sCurTabUUID,c=Date.now(),d=a.Lib.Tabs.getAll();void 0===d[b]?a.Lib.Tabs.readd(d):(d[b].alive=c,a.Lib.Tabs.save(d)),d=a.Lib.Tabs.getAll();var e=a.Lib.Tabs.getAllMessages(),f=!1,g=!1,h=a.Lib.Tabs.getActiveLongPolling();$.each(d,function(b,i){i.alive<c-1e3*a.Lib.Tabs.DEAD_TIMEOUT&&(b==h&&(f=!0),delete e[b],delete d[b],g=!0)}),g&&(a.Lib.Tabs.save(d),a.Lib.Tabs.saveAllMessages(e)),f&&(d=a.Lib.Tabs.getAll(),$.each(d,function(b){return d[b].active=!0,a.Lib.Tabs.setActiveLongPolling(b),b==a.Lib.Tabs.sCurTabUUID&&a.Lib.Tabs.activateLP(),!1}))}function v(){return localStorage.getItem("longpolling")}function w(a){localStorage.setItem("longpolling",a)}function x(b){void 0===b&&(b=!0);var c=a.Lib.Tabs.sCurTabUUID,d=a.Lib.Tabs.getAll(),e=[];return $.each(d,function(a){b&&a==c||e.push(a)}),e}function y(){return JSON.parse(localStorage.getItem("tabs")||"{}")}function z(){a.Lib.Tabs.save({}),a.Lib.Tabs.purgeAllMessages()}function A(a){localStorage.setItem("tabs",JSON.stringify(a))}function B(b){a.Lib.Tabs.bHasFocus=b;var c=a.Lib.Tabs.getAll();$.each(c,function(a){c[a].focus=0}),void 0!==c[a.Lib.Tabs.sCurTabUUID]&&(c[a.Lib.Tabs.sCurTabUUID].focus=b?1:0,a.Lib.Tabs.save(c))}function C(){}function D(a){b.sType=a,s(null,!0)}function E(b){return b==a.Lib.Tabs.sType}function F(){return a.Lib.Tabs.bHasFocus}function G(){var b=a.Lib.Tabs.getAll();for(var c in b)if(b.hasOwnProperty(c)&&b[c].focus)return b[c];return!1}function H(b){var c=a.Lib.Tabs.getAll();for(var d in c)if(c.hasOwnProperty(d)&&c[d].type===b)return c[d];return!1}function I(){return a.Lib.Tabs.getTabForType("chat")}function J(){return a.Lib.Tabs.getTabForType("app")}function K(){a.Lib.Tabs.focus(!0)}function L(){a.Lib.Tabs.focus(!1)}function M(){a.Lib.Tabs.remove()}function N(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)})}function O(a){void 0===a&&(a=!0);var c=JSON.parse(localStorage.getItem("read_push")||"{}"),d=e(),f=q(c);if(void 0===c[d])return f&&localStorage.setItem("read_push",JSON.stringify(c)),{};var g=(new Date).getTime(),h=g-b.READ_MSG_DURATION,i=!1,j=c[d];for(var k in j)(void 0===j[k]||j[k]<h)&&(delete j[k],i=!0);return c[d]=j,(f||i&&(void 0===a||a))&&localStorage.setItem("read_push",JSON.stringify(c)),c}function P(a){return void 0!==O(!1)[a]}function Q(a,b){var c=O(!1);c[a]=b,R(c)}function R(a){var b=JSON.parse(localStorage.getItem("read_push")||"{}");b[e()]=a,localStorage.setItem("read_push",JSON.stringify(b))}function S(b,c){if(0===b.length)return!1;void 0===c&&(c=!0);for(var d,e,g,h,i=b.length,j=(new Date).getTime(),k=0;k<i;k++)d=b[k],P(d.msg_id)||(Q(d.msg_id,j),e=d.code.split("."),g=e[0].charAt(0).toUpperCase()+e[0].slice(1),h="on"+e[1].charAt(0).toUpperCase()+e[1].slice(1),a.InternalMessaging&&a.InternalMessaging[g]&&$.isFunction(a.InternalMessaging[g][h])?(a.InternalMessaging[g][h](d.data),c&&f(d.code,d.data,null,d.msg_id)):console.log("onNewMessage push handle not found !",g,h))}b.KEEP_ALIVE=3,b.DEAD_TIMEOUT=5,b.sCurTabUUID=null,b.bHasFocus=null,b.sType=null,b.bLongPolling=!1,b.activateLP=c,b.hasLP=d,b.getUUID=e,b.transmit=f,b.receive=g,b.getAllMessages=h,b.saveAllMessages=i,b.purgeAllMessages=j,b.getMessages=k,b.purgeMessages=l,b.saveMessages=m,b.getMessagesFor=n,b.purgeMessagesFor=o,b.saveMessagesFor=p,b.purgeReadPush=q,b.add=r,b.readd=s,b.remove=t,b.keepAlive=u,b.getActiveLongPolling=v,b.setActiveLongPolling=w,b.getAllIds=x,b.getAll=y,b.clean=z,b.save=A,b.focus=B,b.debug=C,b.setType=D,b.isType=E,b.hasFocus=F,b.getFocusedTab=G,b.getTabForType=H,b.getChatTab=I,b.getAppTab=J,b.onFocus=K,b.onBlur=L,b.onUnload=M,b.generateUUID=N,b.READ_MSG_DURATION=2e4,b.getAllReadMsgs=O,b.isMsgRead=P,b.setReadMsg=Q,b.updateReadMsgs=R,b.onNewMessages=S}(b.Tabs||(b.Tabs={}))}(a.Lib||(a.Lib={}))}(App||(App={}));var App;!function(a){!function(b){function c(b){var c,d=b.getUserAuth(a.Global.user().user_id);for(c in d)if(d.hasOwnProperty(c)){var e=a.Rights.modulesForAuth(c),f=b.hasModuleEnabled(e),g=!f;if(!g){var h=a.Rights.authCodeForModule(d[c],e);g=h==a.Rights.AuthType.DENIED}var i=$("#menu-"+e);i.toggleClass("hidden",g)}return a.ModuleBar}b.initForProject=c}(a.ModuleBar||(a.ModuleBar={}))}(App||(App={}));var App;!function(a){!function(b){function c(){b.$multiProject.on("mouseenter",function(){var b=$(this);if(!b.hasClass("init")&&(b.addClass("init"),!b.find("ul li").length)){var c=$("<ul>"),d=a.Global.projectsByCategories();for(var e in d){var f=d[e];c.append('<li class="account_wimis_row account_wimi_cat">'+f.name+"</li>");for(var g in f.projects){var h=f.projects[g],i={name:h.name,slug:h.slug,image_url:h.getImageURL(),project_has_custom_image:!!h.custom_image_id};c.append(a.Templates.Global.multiProjectRow(i))}}b.find(".header_menu").prepend(c),c.on("click","a",function(){var b=$(this).parents("[data-project]").data("project");a.Global.switchProject(b)})}})}function d(a){a?b.$multiProject.removeClass("hidden").find(".project-name").html(a.name):b.$multiProject.addClass("hidden").find(".project-name").html("")}function e(c){c?b.$moduleProject.removeClass("hidden").find(".module-name").html(a.Global.trans("modules."+c)):b.$moduleProject.addClass("hidden").find(".module-name").html("")}b.$multiProject=$("#multi-project"),b.$moduleProject=$("#multi-project-module"),b.init=c,b.setProject=d,b.setModule=e}(a.MultiProject||(a.MultiProject={}))}(App||(App={}));var App;!function(a){!function(b){function c(){b.$mutliWimi.on("mouseenter",function(){var b=$(this);if(!b.hasClass("init")&&(b.addClass("init"),!b.find("ul li").length)){var c=a.Global.wimis(),d=$("<ul>");$.each(c,function(b,c){var e=c.account,f=e.getCompanyName().toUpperFirst(),g={name:f,url:e.getURL(),initials:f[0]};e.custom_image_id&&(g.avatar=Kore.url("ui/custom-image.php?id="+e.custom_image_id)),d.append(a.Templates.Global.multiWimiRow(g))}),b.find(".header_menu").prepend(d)}})}b.$mutliWimi=$("#multi-wimi"),b.init=c}(a.MutliWimi||(a.MutliWimi={}))}(App||(App={}));var App;!function(a){!function(b){function c(b,c){function d(){clearTimeout(h),j(g,1,e.onRemoved),$.isFunction(e.onClosed)&&e.onClosed()}void 0===c&&(c={});var e={duration:a.Notifications.eventDuration,leftContent:null,customClass:null,onClick:null,onClosed:null,onRemoved:null};$.extend(e,c);var f=$("#notifications"),g=$('<div class="notification'+(e.customClass?" "+e.customClass:"")+'"><table class="full-width"><tr class="notification-container"><td class="full-width word-wrap">'+b+'</td><td class="close-notif"><i class="fa fa-remove"></i></td></tr></table></div>');e.onClick&&g.addClass("notification-clickable"),e.leftContent&&$(".notification-container",g).prepend($('<td class="notification-left-content"></td>').html(e.leftContent)),f.prepend(g),g.fadeOut(0).fadeIn();var h=j(g,e.duration);return g.on("click",".close-notif",function(a){a.stopPropagation(),d()}).click(function(a){$.isFunction(e.onClick)&&(e.onClick(g,a),d())}).hover(function(){clearTimeout(h)},function(){h=j(g,e.duration,e.onRemoved)}),g}function d(b,c){return h(b,a.Notifications.typeSuccess,c)}function e(b,c){return h(b,a.Notifications.typeInfo,c)}function f(b,c){return h(b,a.Notifications.typeWarning,c)}function g(b,c){return h(b,a.Notifications.typeError,c)}function h(b,d,e){void 0===e&&(e={});var f=null,g=null,h=d;if(e.icon)f=e.icon;else switch(d){case a.Notifications.typeSuccess:f="check-circle";break;case a.Notifications.typeInfo:f="info-circle";break;case a.Notifications.typeWarning:f="exclamation-triangle";break;case a.Notifications.typeError:f="exclamation-circle"}return f&&(g='<i class="fa fa-'+f+'"></i>'),c(b,$.extend({leftContent:g,customClass:h},e))}function i(b,d,e){void 0===e&&(e={});var f=null,g=$.extend({avatarSize:36,avatarClass:"no-margin"},e),h=a.Util.avatar(d,{customClass:g.avatarClass,size:g.avatarSize,html:!0});return h&&(f=h),c(b,$.extend({leftContent:f},g))}function j(a,b,c){return b?setTimeout(function(){a.fadeOut(function(){a.remove(),$.isFunction(c)&&c()})},b):null}b.eventDuration=5e3,b.notify=c,b.typeSuccess="success",b.typeInfo="info",b.typeWarning="warning",b.typeError="error",b.notifySuccess=d,b.notifyInfo=e,b.notifyWarning=f,b.notifyError=g,b.notifyWithType=h,b.notifyWithUser=i,b.hideNotification=j}(a.Notifications||(a.Notifications={}))}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){!function(b){function c(a,c){b.oPushSubcriptions[a]=b.oPushSubcriptions[a]||[],b.oPushSubcriptions[a].push(c)}function d(c,d){a.Util.arrayRemove(b.oPushSubcriptions[c],d)}function e(a,d,e){b.oSubcriptionsByView[a]=b.oSubcriptionsByView[a]||{},b.oSubcriptionsByView[a][d]=b.oSubcriptionsByView[a][d]||[],b.oSubcriptionsByView[a][d].push(e),c(d,e)}function f(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];e(a,c,d)}}function g(a){var c=b.oSubcriptionsByView[a];if(c){for(var e in c)if(c.hasOwnProperty(e)){var f=c[e];for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];d(e,h)}}delete b.oSubcriptionsByView[a]}}function h(b){var c=b.event.split(".");if(3===c.length){if(b.data.header.socket==Kore.getSocketId())return;i(b.data)}else{"main.userStatus"!==b.event&&console.log("*** WOS push",b);var d=Kore.getSocketId()==b.data.__socket,e=c[0];e=e[0].toUpperCase()+e.substr(1);var f=c[1];f=f[0].toUpperCase()+f.substr(1),b.data._event=f,a.Push&&a.Push[e]&&a.Push[e]["on"+f]?$.isFunction(a.Push[e].handleEvent)?a.Push[e].handleEvent("on"+f,b.data,d):d?console.log("App.Push."+e+".on"+f+"() is implemented but this socket is the caller !"):a.Push[e]["on"+f](b.data):console.log("App.Push."+e+".on"+f+"() is not a valid push handler!")}}function i(c){var d=c.header.target,e=c.header.target.split(".",3).join("."),f=j(e);for(var g in f)if(f.hasOwnProperty(g)){var h=f[g];"main.user.status"!==h&&console.log("*** onPushEvent",c,h,e);var i=h.split("."),k=i[0].toUpperFirst(),l=i[1].toUpperFirst(),m=i[2],n=m+"_impl";c.header.original_target=d;var o=d.split(".");o[0]=i[0],o[1]=i[1],o[2]=i[2],c.header.target=o.join(".");var p=new a.API.WApiMessage(c),q=!1;if(a.Push[k]&&a.Push[k][l])for(var r in a.Push[k][l])if(a.Push[k][l].hasOwnProperty(r)&&(r.toLowerCase()==m.toLowerCase()||r.toLowerCase()==n.toLowerCase())){var s=new a.Push[k][l][r](p);s.action(),q=!0;break}q||console.log("App.Push."+k+"."+l+"."+m+"() is not a valid push handler!");var t=h.toLowerCase(),u=b.oPushSubcriptions[t];if(u&&u.length){var v=p.getDataAsResponseObject();if(v)for(var w in u)if(u.hasOwnProperty(w)){var x=u[w];x(v,p)}}}}function j(a){return{"chat.chat.postmessage":["chat.chat.postMessage","channel.chat.postMessage","communication.chat.postMessage"],"chat.chat.addattachment":["chat.chat.addAttachment","channel.chat.addAttachment","communication.chat.addAttachment"],"chat.chat.clearunseen":["chat.chat.clearUnseen","channel.chat.clearUnseen","communication.chat.clearUnseen"],"chat.chat.editmessage":["chat.chat.editMessage","channel.chat.editMessage"],"chat.chat.deletemessage":["chat.chat.deleteMessage","channel.chat.deleteMessage"],"chat.chat.favoritemessage":["chat.chat.favoriteMessage","channel.chat.favoriteMessage"],"chat.chat.unfavoritemessage":["chat.chat.unfavoriteMessage","channel.chat.unfavoriteMessage"],"chat.chat.getchat":["chat.chat.getChat","communication.chat.getChat"],"sharing.sharing.upload":["document.sharing.upload"],"main.user.setstatus":["main.user.status"],"main.user.setusersession":["main.user.status"],"main.user.removeusersession":["main.user.status"]}[a.toLowerCase()]||[a]}b.oPushSubcriptions={},b.oSubcriptionsByView={},b.subscribe=c,b.unsubscribe=d,b.subscribeForView=e,b.subscribeListForView=f,b.unsubcribeView=g,b.onMessage=h,b.dispatchMessage=i;var k=function(){function b(a){this.message=null,this.message=a}return b.prototype.action=function(){if(this.shouldProcess()){this.execute(this.message.getData(),this.message);var a=this.message.getDataAsResponseObject();a&&this.doesImplementWApiResponse()&&this.executeWithWApiResponseObject(a,this.message)}},b.prototype.getWApiResponseImplementaion=function(){return this.onMessage},b.prototype.doesImplementWApiResponse=function(){return!!this.getWApiResponseImplementaion()},b.prototype.executeWithWApiResponseObject=function(a,b){this.getWApiResponseImplementaion()(a,b)},b.prototype.shouldProcess=function(){if(this.shouldProcessOnlyForCurrentProject()&&a.Global.project()&&this.message.getProjectId()&&!this.message.isCurrentProject(!0))return console.log("push message does not match current project"),!1;if(this.shouldProcessOnlyForCurrentModule()&&!this.message.isCurrentModule())return console.log("push message does not match current module"),!1;var b=this.message.getError();return!b||(console.log("push message error",b),this.error(b,this.message),!1)},b.prototype.shouldProcessOnlyForCurrentProject=function(){return!0},b.prototype.shouldProcessOnlyForCurrentModule=function(){return!0},b.prototype.execute=function(a,b){},b.prototype.error=function(a,b){},b}();b.Action=k;!function(b){!function(b){function c(b,c){if(!a.Lib.Tabs.getFocusedTab()&&a.Lib.Tabs.hasLP())return!0;if(a.Lib.Tabs.hasFocus()){if(a.Lib.Tabs.isType("chat"))return!1;if(a.Global.module()==a.Global.MODULES.CHANNEL){var d=a.Script.Channel.oChat;if(d&&d.chat&&d.chat.chat_id==c)return!1}return!0}return!1}function d(b,d){if(c(b,d)){var e=b.getUser(),f=Model.User.getUserNameFor(e)+" : "+b.content;a.WebNotifications.notify("Wimi Chat",{body:f,onclick:function(){a.Communication.openChat({chat:d})}}),console.log("play sound: chat.message"),$.ionSound.play("chat.message")}}function e(b,c){return g[c]&&g[c][b.index]?void console.warn("double message detected",b,c):(g[c]=g[c]||{},g[c][b.index]=b,b.user_id!=a.Global.user().user_id&&(d(b,c),void(a.Lib.Tabs.isType("app")&&a.Communication.Wheel.onNewMessageForChat(c))))}function f(b,c){a.Lib.Tabs.isType("app")&&c==a.Global.user().user_id&&a.Communication.Wheel.onChatUnreadMessagesCleared(b)}var g={},h=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},b.prototype.onMessage=function(a,b){e(a.message,a.chat_id)},b}(k);b.postMessage=h;var i=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},b.prototype.onMessage=function(a,b){e(a.message,a.chat_id)},b}(k);b.addAttachment=i;var j=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},b.prototype.onMessage=function(a,b){f(a.chat_id,a.user_id)},b}(k);b.clearUnseen=j}(b.Chat||(b.Chat={}));!function(b){var c=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},c.prototype.onMessage=function(b,c){b.user_id!=a.Global.user().user_id&&a.Communication.onAirTimeInvite(b.room,b.user_id)},c}(k);b.invite=c;var d=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},c.prototype.onMessage=function(b,c){a.Communication.onAirTimeJoined(b.room)},c}(k);b.join=d;var e=function(b){function c(){b.apply(this,arguments)}return __extends(c,b),c.prototype.shouldProcessOnlyForCurrentModule=function(){return!1},c.prototype.onMessage=function(b,c){a.Communication.onAirTimeDeclined(b.room)},c}(k);b.decline=e}(b.Air||(b.Air={}))}(b.Communication||(b.Communication={}))}(a.Push||(a.Push={}))}(App||(App={}));var App;!function(a){!function(b){function c(){return[a.Global.MODULES.AGENDA,a.Global.MODULES.DOCUMENTS,a.Global.MODULES.MEETINGS,a.Global.MODULES.TASKS,a.Global.MODULES.REPORTING,a.Global.MODULES.CHANNEL]}function d(){var b={};return b[a.Global.MODULES.AGENDA]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.READ,a.Rights.AuthType.FULL],b[a.Global.MODULES.DOCUMENTS]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.READ,a.Rights.AuthType.FULL],b[a.Global.MODULES.MEETINGS]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.FULL],b[a.Global.MODULES.TASKS]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.SELF,a.Rights.AuthType.FULL],b[a.Global.MODULES.REPORTING]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.FULL],b[a.Global.MODULES.ACTIVITY]=[a.Rights.AuthType.FULL],b[a.Global.MODULES.CHANNEL]=[a.Rights.AuthType.DENIED,a.Rights.AuthType.FULL],b}function e(a){var b=d();return b[a]?b[a]:(console.warn("authCodeForModule module not found: "+a),null)}function f(b,c){var e=d();return e[c]?e[c][b]:(console.warn("authCodeForModule module not found: "+c),a.Rights.AuthType.FULL)}function g(a){switch(a){case m.DENIED:return"red";case m.SELF:case m.READ:return"orange";case m.FULL:return"green"}}function h(a){switch(a){case m.DENIED:return"fa-ban";case m.SELF:return"fa-user";case m.READ:return"fa-eye";case m.FULL:return"fa-pencil"}}function i(b,c){switch(b){case m.DENIED:return a.Global.trans("access_denied");case m.SELF:return c==a.Global.MODULES.TASKS?a.Global.trans("my_task"):"";case m.READ:return a.Global.trans("read_only");case m.FULL:return c==a.Global.MODULES.TASKS?a.Global.trans("all_task"):a.Global.trans("read_write")}}function j(a){return a.toLowerCase()}function k(a,b){return l(b)>=a}function l(b){var c=a.Global.project();return c?f(c.getUserAuth(a.Global.user().user_id)[b],b):(console.warn("getProjectRight can only be called if we are in a project"),null)}!function(a){a[a.DENIED=0]="DENIED",a[a.SELF=1]="SELF",a[a.READ=2]="READ",a[a.FULL=3]="FULL"}(b.AuthType||(b.AuthType={}));var m=b.AuthType;b.modulesAvailableForRightsEdition=c,b.authCodesByModule=d,b.authCodesForModule=e,b.authCodeForModule=f,b.colorForAuthType=g,b.iconForAuthType=h,b.labelForAuthType=i,b.modulesForAuth=j,b.hasModuleRight=k,b.getModuleRight=l}(a.Rights||(a.Rights={}))}(App||(App={}));var App;!function(a){!function(b){function c(b){var c=a.Global.conf().app.roles,e=[];for(var f in c)(a.Global.wimi().allow_external_guest||parseInt(f)!=g.GUEST)&&c.hasOwnProperty(f)&&(b||parseInt(f)!==g.OWNER)&&e.push(d(parseInt(f)));return e=e.sort(function(a,b){return a.id<b.id?-1:1})}function d(b){return{id:b,code:a.Global.conf().app.roles[b],icon:e(b),description:f(b)}}function e(a){var b=[];switch(a){case g.GUEST:b=["fa-briefcase"];break;case g.ADMIN:b=["fa-star"];break;case g.GENERAL_ADMIN:b=["fa-star","fa-star"];break;case g.OWNER:b=["fa-star","fa-star","fa-star"];break;case g.USER:default:b=["fa-user"]}return"<span>"+b.map(function(a){return'<i class="fa '+a+'"></i>'}).join("")+"</span>"}function f(b){var c;switch(b){case g.GUEST:c="a_guest_etc";break;case g.ADMIN:c="a_project_administrator_etc";break;case g.GENERAL_ADMIN:c="a_general_administrator_etc";break;case g.OWNER:c="the_wimi_manager_etc";break;case g.USER:default:c="a_contributor_etc"}return a.Global.trans(c)}!function(a){a[a.GUEST=-5]="GUEST",a[a.USER=0]="USER",a[a.ADMIN=1]="ADMIN",a[a.GENERAL_ADMIN=2]="GENERAL_ADMIN",a[a.OWNER=3]="OWNER"}(b.ROLES||(b.ROLES={}));var g=b.ROLES;b.getAvailableRoles=c,b.getRole=d,b.iconForRoleId=e,b.descriptionForRoleId=f}(a.Roles||(a.Roles={}))}(App||(App={}));var App;!function(a){!function(b){function c(){b.projectId=b.$input.data("project"),b.$inputTags.tagsInput({width:"100%",height:"auto",placeholderColor:"rgba(0,20,40,0.4)",defaultText:a.Global.trans("tags")+"...",onAddTag:function(a){a&&l(p(),q())},onRemoveTag:function(a){a&&l(p(),q())},interactive:!0,autocomplete_url:function(b,c){c(a.Global.tagsLabelForTerm(b.term))}}),g(),s(),d()}function d(){b.$globalSearch.on("click",function(a){a.stopPropagation()}),b.$globalSearchButton.on("click",function(a){a.stopPropagation(),b.$globalSearch.hasClass("active")?f():e()}),b.$input.on("keydown",function(c){var d,e=c.keyCode||c.which;if(e==a.Keys.up||e==a.Keys.down){c.stopPropagation(),c.preventDefault();var g=$("li.browsable.active:visible",b.$dropdown);if(e==a.Keys.down){if(d=g.next(),!d.length){var h=g.parents(".search-cat").next();h.length||(h=$(".search-cat:visible",b.$dropdown).first()),d=$("li.browsable:visible",h).first()}}else if(d=$("li.browsable.active:visible",b.$dropdown).prev(),!d.length){var j=g.parents(".search-cat").prev();j.length||(j=$(".search-cat:visible",b.$dropdown).last()),d=$("li.browsable:visible",j).last()}i(d,!0)}else e==a.Keys.enter?(c.stopPropagation(),c.preventDefault(),d=$("li.browsable.active:visible",b.$dropdown),d.trigger("click")):e==a.Keys.escape&&(b.$input.blur(),f())}).on("keyup",function(){var a=$(this);if($.trim(a.val())!=$.trim(a.attr("data-value"))){l($.trim(a.val()),q(),300)}}),b.$dropdown.on("click",".search-result",function(){var c=$(this),d=c.data("type"),e=c.data("id"),g=c.data("project"),h="/",i="",k=!0;switch(d){case b.searchTypes.documents:var l=c.is("[data-isdir]");i="/"+g+"/"+a.Global.MODULES.DOCUMENTS+"/?"+(l?"directory":"file")+"="+e;break;case b.searchTypes.tasks:i="/"+g+"/"+a.Global.MODULES.TASKS+"/detail/"+e;break;case b.searchTypes.agenda:i="/"+g+"/"+a.Global.MODULES.AGENDA+"/?event="+e;break;case b.searchTypes.meetings:k=!1,h="/reunions",i="expose:"+e}var m=m,n={query:c.parents(".search-results").data("search"),project:b.projectId,module:m==b.searchTypes.all?null:m};$.post("/io-ajax/se-hist-add.php",n),f(),g&&!k&&(h="/"+g+h),j(h,i)}).on("click",".search-query",function(){var a=$(this),c=$(".entry-label",a).text();b.$input.val(c),l(c,q()),b.$input.focus()}).on("click",".search-type",function(){var a=$(this);if(!a.hasClass("active")){o(a.data("type")),b.$input.attr("data-value",b.$input.val()),b.$input.focus()}}).on("click",".search-more",function(){o($(this).data("type")),b.$input.focus()}).on("click",".clear-history",function(a){a.stopPropagation(),g(),b.$input.focus(),$.get("/io-ajax/se-hist-clear.php",function(){b.searchHistory=[]})}).on("mouseenter",".search-cat li",function(){i($(this))}),$(".search-content",b.$globalSearch).scroll(function(){var a=$(this),c=!!a.scrollTop();$(".search-header",b.$dropdown).toggleClass("shadow",c)})}function e(){b.$globalSearch.addClass("active"),$("body").one("click",function(){f()}),null===b.searchHistory&&(b.searchHistory=[],k(function(){h()})),h(),b.$input.focus()}function f(){b.$globalSearch.removeClass("active")}function g(){var c=$(".search-recent",b.$dropdown),d='<div class="search-info">'+a.Global.trans("start_writing_to_search")+"</div>";c.html(d)}function h(){return i($("li.browsable:visible",b.$dropdown).first(),!0)}function i(a,c){if(a.length){if(c=c||!1,$("li.browsable",b.$dropdown).removeClass("active"),a.addClass("active"),c){var d,e=$(".search-content",b.$dropdown),f=a.offset().top-e.offset().top+2*a.outerHeight();f>e.outerHeight()&&(d=e.scrollTop()+(f-e.outerHeight()),e.stop(!0,!0).animate({scrollTop:d+"px"},200));var g=a.offset().top-e.offset().top-2*a.outerHeight();g<0&&(d=e.scrollTop()+g,e.stop(!0,!0).animate({scrollTop:d+"px"},200))}return a}}function j(a,b){if(window.location.pathname==a)window.location.hash=b,window.location.reload();else{var c=a+"#"+b;window.location.assign(c)}}function k(c){$.post("/io-ajax/se-hist-get.php",function(d){if(b.searchHistory=d,d.length){var e=$(".search-recent",b.$dropdown),f='<div class="search-cat"><div class="search-cat-header"><i class="fa fa-fw fa-clock"></i><span class="search-cat-name">'+a.Global.trans("recents")+'</span><span class="float-right clear-history colorable-text">'+a.Global.trans("clear_history")+"</span></div><ul></ul></div>";e.html(f),$.each(d,function(a,c){c.module=c.module||b.searchTypes.all;var d='<li class="search-query colorable-border-left-active browsable" data-type="'+c.module+'"><span class="inner"><i class="entry-icon fa fa-fw fa-search"></i><div class="truncate entry-label">'+c.query+"</div></span></li>";$("ul",e).append(d)}),$.isFunction(c)&&c()}})}function l(a,c,d){void 0===d&&(d=0),b.$input.attr("data-value",b.$input.val()),a.length>2||c.length?x(function(){n(a,c)},d):s()}function m(a,c){var d=-1!==a.indexOf(b.noResultString),e=!b.noResultTags.filter(function(a){return c.indexOf(a)<0}).length;return!d||!e}function n(c,d){if(m(c,d))b.noResultString=null,b.noResultTags=[],b.iXHR||b.$globalSearch.addClass("searching"),b.iXHR++,a.API.Main.search(c,d,b.searchType==b.searchTypes.all?null:b.searchType,{onSuccess:function(e){var f=new a.API.Main.Search.SearchResponse(e);$(".search-recent",b.$dropdown).hide();var g=$(".search-results",b.$dropdown);g.html(""),g.attr("data-search",c);var i=!0;for(var j in f.results)if(f.results.hasOwnProperty(j)){var k=f.results[j];if(k.results.length){i=!1;var l=k.count,m=b.searchTypes[j],n=u(m,l);g.append(n);var o=$("ul",g).last();if(k.results.forEach(function(a){var d=a.project_name,e=v(m,a,d,c,b.searchType);o.append(e)}),l>10&&b.searchType==b.searchTypes.all){var p="";m!=b.searchTypes.all&&void 0!==b.searchTypes[m]&&(p=a.Global.trans("show_more_"+m));var q='<li class="search-more colorable-border-left-active browsable" data-type="'+m+'"><span class="inner"><i class="entry-icon fa fa-fw fa-search"></i><div class="truncate entry-label">'+p+"</div></span></li>";o.append(q)}}}i&&(b.noResultString=c,b.noResultTags=d,r(c,b.searchType)),h(),$(".search-content",b.$globalSearch).scrollTop(0)},onComplete:function(){--b.iXHR||b.$globalSearch.removeClass("searching")}});else{$(".search-recent",b.$dropdown).hide(),r(c,b.searchType)}}function o(a){$('.search-type[data-type="'+a+'"]',b.$dropdown).addClass("active colorable-text colorable-border").siblings(".search-type").removeClass("active colorable-text colorable-border"),b.searchType!==b.searchTypes.all&&(b.noResultString=null,b.noResultTags=[]),b.searchType=a,l($.trim(b.$input.val()),q())}function p(){return $.trim(b.$input.val())}function q(){return b.$inputTags.getTagList()}function r(c,d){c=a.Util.htmlentities(c);var e="";void 0!==b.searchTypes[d]&&(e=a.Global.trans("search_no_result_"+b.searchTypes[d],{search:c}));var f='<div class="search-info"><i class="fa fa-fw fa-search"></i> '+e+"</div>";$(".search-results",b.$dropdown).html(f)}function s(){var a=$(".search-results",b.$dropdown);a.attr("data-search",""),a.html(""),$(".search-recent",b.$dropdown).show(),h()}function t(a){var c;switch(a){case b.searchTypes.documents:c="fa-file-o";break;case b.searchTypes.tasks:c="fa-check";break;case b.searchTypes.agenda:c="fa-calendar";break;case b.searchTypes.meetings:c="fa-group";break;case"folder":c="fa-folder-o"}return c}function u(c,d){var e="";switch(c){case b.searchTypes.documents:e="documents";break;case b.searchTypes.tasks:e="taches";break;case b.searchTypes.agenda:e="evenements";break;case b.searchTypes.meetings:e="reunions"}return name=a.Global.trans(e),'<div class="search-cat"><div class="search-cat-header"><i class="fa fa-fw '+t(c)+'"></i><span class="search-cat-name">'+name+'</span><span class="search-cat-count">'+(d>50?"50+":d)+'</span><div class="float-right"></div></div><ul></ul></div>'}function v(c,d,e,f,g){var h,i="",j="",k="";switch(f=a.Util.htmlentities(f),h=w(d.label,f),c){case b.searchTypes.documents:i+='<div class="extra truncate"><i class="fa fa-fw fa-folder"></i>'+e+"/"+(d.path?d.path:"")+"</div>",i+=d.description&&d.description.length?'<div class="extra truncate"><i class="fa fa-fw fa-info-circle"></i>'+w(d.description,f)+"</div>":"",k='data-id="'+d.id+'"',d.path_id&&d.path_id.length&&(k+=' data-directory="'+d.path_id+'"'),"folder"==d.type&&(k+=" data-isdir"),j=d.tags.map(function(a){return"<span class='item-tag'>"+a.label+"</span>"}).join("");break;case b.searchTypes.tasks:g==b.searchTypes.all&&(i+='<div class="extra truncate"><i class="fa fa-fw fa-folder"></i>'+e+"</div>"),k='data-id="'+d.id+'"',j=d.tags.map(function(a){return"<span class='item-tag'>"+a.label+"</span>"}).join("");break;case b.searchTypes.agenda:g==b.searchTypes.all&&(i+='<div class="extra truncate"><i class="fa fa-fw fa-folder"></i>'+e+"</div>"),i+=d.description&&d.description.length?'<div class="extra truncate"><i class="fa fa-fw fa-info-circle"></i>'+w(d.description,f)+"</div>":"",i+=d.place&&d.place.length?'<div class="extra truncate"><i class="fa fa-fw fa-map-marker"></i>'+w(d.place,f)+"</div>":"",k='data-id="'+d.id+'" data-date="'+d.date.split(" ")[0]+'"';break;case b.searchTypes.meetings:g==b.searchTypes.all&&(i+='<div class="extra truncate"><i class="fa fa-fw fa-folder"></i>'+e+"</div>"),i+=d.description&&d.description.length?'<div class="extra truncate"><i class="fa fa-fw fa-info-circle"></i>'+w(d.description,f)+"</div>":"",i+=d.place&&d.place.length?'<div class="extra truncate"><i class="fa fa-fw fa-map-marker"></i>'+w(d.place,f)+"</div>":"",k='data-id="'+d.id+'"'}return d.project_slug&&(k+=' data-project="'+d.project_slug+'"'),'<li class="search-result colorable-border-left-active browsable" data-type="'+c+'" '+k+'><span class="inner"><i class="fa fa-fw entry-icon '+t(c==b.searchTypes.documents&&"folder"==d.type?"folder":c)+'"></i><div class="truncate entry-label">'+h+"</div>"+(j?'<div class="entry-tags icon-right">'+j+"</div>":"")+i+'<div style="clear: both;"></div></span></li>'}function w(b,c){return a.Util.wrapText(b,c,"boldified",!0)}b.$globalSearch=$("#global-search"),b.$globalSearchButton=$("#global-search-show"),b.$input=$("#global-search-input"),b.$inputTags=$("#global-search-tags-input"),b.$dropdown=$("#search-dropdown"),b.searchTypes={all:"all",documents:"documents",tasks:"tasks",agenda:"agenda",
meetings:"meetings"},b.searchType="all",b.noResultString=null,b.noResultTags=[],b.searchHistory=null,b.projectId=null,b.iXHR=0,b.init=c,b.bind=d,b.open=e,b.close=f,b.initRecent=g,b.activeFirstResult=h,b.activeResult=i,b.redirect=j,b.getHistory=k,b.search=l,b.changeSearchType=o,b.getSearchedQuery=p,b.getSearchedTagList=q,b.notFound=r,b.resetResults=s,b.getIconNameForType=t,b.getHeaderHTMLForType=u,b.getEntryHTMLForType=v;var x=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}()}(a.Search||(a.Search={}))}(App||(App={}));var App;!function(a){!function(b){function c(b,c){var e=b.url_image&&!b.custom_image_id?b.url_image.split(".")[0]+" preset":null,g=b.custom_image_id?"ui/custom-image.php?id="+b.custom_image_id:e?a.Global.urlStaticImageCustom("project-folder-empty.png"):a.Global.urlStaticImageCustom("project-folder-default.png"),h={project_has_custom_image:!!b.custom_image_id,project_name:b.name,image_url:g,image_preset_class:e,can_edit_project:a.Global.userHasPrivilege(a.Roles.ROLES.ADMIN)};return a.Global.view(a.Templates.Global.sidebarProject,h,function(e){e.on("click",".edit-project",function(){a.Global.showEditProject(b.project_id,$(this),function(b){var c=a.Global.project();c&&c.project_id===b.project_id&&a.Global.switchProject(b.slug,!0)})}).on("click",".edit-project-rights",function(){a.Global.showEditRightsForProject(a.Global.project(),$(this))}).on("click",".add-user-to-project",function(){a.Global.showAddUserToProject(a.Global.project(),$(this),function(){console.log("added to project !")})}).on("click",".remove-user-from-project",function(){var b=$(this).parents(".user").data("user");a.Global.showRemoveUserFromProject(a.Global.project(),b,$(this),function(){console.log("removed from project !")})}),c&&f(c),d(b)},$("#sidebar")),a.Sidebar}function d(b){var c=b.getUserList(!0);c.sort(function(a,b){return a.display_name.toUpperCase()<b.display_name.toUpperCase()?-1:a.display_name.toUpperCase()>b.display_name.toUpperCase()?1:0});var d=[];for(var e in c)c[e].user_id!=a.Global.user().user_id&&d.push(c[e].email);var f={user_id:a.Global.user().user_id,mailto_users:d.join(";"),airtime_active:a.Global.conf().modules.air.active,users:c,can_add_user_to_project:a.Global.userHasPrivilege(a.Roles.ROLES.ADMIN),can_edit_rights:a.Global.userHasPrivilege(a.Roles.ROLES.ADMIN),can_remove_user_from_project:a.Global.userHasPrivilege(a.Roles.ROLES.ADMIN)};a.Global.view(a.Templates.Global.sidebarProjectUsers,f,null,$("#sidebar-users"))}function e(b,c){return a.Global.view(a.Templates.Global.sidebarUser,{},function(a){},$("#sidebar")),c&&f(c,!0),a.Sidebar}function f(b,c){return void 0===c&&(c=!1),$("#sidebar-module").html(""),c?i(b):g(b),a.Sidebar}function g(b){var c=a.Global.project(),d=c.auth_list;return $.each(d,function(c,d){var e=b,f=d.auth[e],g=a.Rights.authCodeForModule(f,b);$(".user[data-user="+d.user_id+"]").attr("data-auth",g)}),a.Sidebar}function h(b,c){return $('#sidebar .user[data-user="'+b+'"] .avatar').attr("data-status",c),a.Sidebar}function i(c){if($("#sidebar-projects").length)return a.Sidebar;b.aProjectSelectionHandler=[];var d=a.Global.projectsByCategories();return a.Global.view(a.Templates.Global.sidebarProjects,{projectsByCat:d,module:c},null,$("#sidebar")),a.Sidebar}function j(){var a=$("#sidebar-projects-list");return a.length?a.find("input.sidebar-project:checked").map(function(){return parseInt($(this).closest("li[data-project]").data("project"))}).get():void console.warn("Sidebar getSelectedProjectList - No project list")}function k(a){b.aProjectSelectionHandler.push(a)}b.initForProject=c,b.setProjectUsers=d,b.initForUser=e,b.setModule=f,b.setUserRights=g,b.setUserStatus=h,b.setProjects=i,b.getSelectedProjectList=j,b.onProjectSelectionChanged=k;!function(b){function c(){var b=a.Script.Account.PAGES;$("#sidebar").html(a.Templates.Account.accountSidebar({pagesByCategory:b,displayPowered:a.Global.custom().shouldShowPoweredByWimi()}))}function d(a){var b=$("#sidebar #account-menu .account-menu-page");b.removeClass("active");var c=b.filter('[data-page="'+a+'"]');if(!c.length)return console.warn("Account menu page not found : "+a);c.addClass("active")}b.init=c,b.setPage=d}(b.Account||(b.Account={}))}(a.Sidebar||(a.Sidebar={}))}(App||(App={})),$(document).ready(function(){$(document).on("click","#sidebar-projects-list .list-section",function(){var a=$(this).next("ul").find("input[type=checkbox]"),b=a.filter(":not(:checked)");b.length?b.click():a.click()}).on("click","#project-users .user",function(){var a=$(this).data("user");App.Global.showUserDetails(a)}).on("click","#project-users .user .controls .control",function(a){a.stopPropagation()}).on("click",".sidebar-project",function(){for(var a in App.Sidebar.aProjectSelectionHandler)if(App.Sidebar.aProjectSelectionHandler.hasOwnProperty(a)){var b=App.Sidebar.aProjectSelectionHandler[a];b(App.Sidebar.getSelectedProjectList())}})});var App;!function(a){var b=function(){function b(a,b){this.file=a,this.maxFileSize=b}return b.prototype.setName=function(a){this.name=a},b.prototype.upload=function(b){if(!this.file||!this.file.name)return void console.warn("Object is not a file: ",this.file);if(this.file.size>this.maxFileSize){var c=a.Global.trans("upload.file.too_big",{file:this._getFileName(),size:a.Util.naturalSize(this.file.size),max:a.Util.naturalSize(this.maxFileSize)});return void a.Notifications.notifyError(c,{duration:0})}var d=this;this.onBeforeUpload?this.onBeforeUpload(function(){d._upload(b)}):this._upload(b)},b.prototype._getFileName=function(){return this.name||this.file.name},b.prototype._upload=function(b){var c=this,d=a.Templates.Global.uploadProgress({filename:this._getFileName()}),e=a.Notifications.notify(d,{duration:0,leftContent:$('<span class="avatar icon-left"><i class="fa fa-cloud-upload"></i></span>')});b(function(a,b){var c=Math.round(a/b*100);e.find(".upload-percentage").text(c),e.find(".upload-bar-inner").css("width",c+"%")},function(){console.log("file uploaded");var b=a.Notifications.notifySuccess(a.Global.trans("upload.file.success",{file:c._getFileName()}));e.is(":visible")&&e.replaceWith(b)},function(b){var d={duration:0},f="";f=a.Global.traductionKeyExists("documents.upload.error."+b.detail_id)?a.Global.trans("documents.upload.error."+b.detail_id,{file:c._getFileName()}):a.Global.trans("documents.upload.error",{file:c._getFileName()});var g=a.Notifications.notifyError(f,d);return e.is(":visible")&&e.replaceWith(g),!1})},b}();a.Uploader=b}(App||(App={}));var App;!function(a){!function(a){a.UserStatusOnline="online",a.UserStatusIdle="idle",a.UserStatusBusy="busy",a.UserStatusAway="away",a.UserStatusOffline="offline";var b=1,c=3,d=10,e=function(){function e(b){this.onStatusChanged=b,this.status=a.UserStatusOnline,this.init()}return e.prototype.init=function(){var e=this;this.statusChange={},this.statusChange[a.UserStatusIdle]={timer:null,minutesBeforeChange:b},this.statusChange[a.UserStatusBusy]={timer:null,minutesBeforeChange:c},this.statusChange[a.UserStatusAway]={timer:null,minutesBeforeChange:d},this.resetTimers(),$(document).on("mousemove click keyup",function(){e.resetTimers()})},e.prototype.resetTimers=function(){var b=this;this.status!==a.UserStatusOnline&&(this.onStatusChanged(a.UserStatusOnline),this.status=a.UserStatusOnline);var c=function(a){d.statusChange.hasOwnProperty(a)&&(clearTimeout(d.statusChange[a].timer),b.statusChange[a].timer=window.setTimeout(function(){b.onStatusChanged(a),b.status=a},1e3*d.statusChange[a].minutesBeforeChange*60))},d=this;for(var e in this.statusChange)c(e)},e}();a.PresenceMonitoring=e}(a.UserStatus||(a.UserStatus={}))}(App||(App={}));var App;!function(a){!function(b){function c(a){return b.aWebcalDays[a]}function d(a){return $.inArray(a,b.aWebcalDays)}function e(){return[b.aWebcalDays[0],b.aWebcalDays[6]]}function f(){return[b.aWebcalDays[1],b.aWebcalDays[2],b.aWebcalDays[3],b.aWebcalDays[4],b.aWebcalDays[5]]}function g(a,b){return a.tz(b),a.utcOffset()}function h(c){var d=b.timezoneOffsetForDate(c,a.Global.getUserTimezone());return c.subtract(d,"minutes")}function i(a,b,c){for(var d=!1,e=a.length;e--;)if(c&&e==b||!c&&a[e]==b){d=!0,a.splice(e,1);break}return d||console.warn("arrayRemove did not found the item to remove: ",b,a),a}function j(a,b,c){for(var d=!1,e=a.length;e--;){if(b===c(a[e])){d=!0,a.splice(e,1);break}}return d||console.warn("arrayRemove did not found the item to remove: ",b,a),a}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function l(){$(document).on("click",".checkbox-selector",function(a){if($(a.target).is('input[type="checkbox"]')){var b=$(this),c=$(a.target),d=c.prop("checked");b.toggleClass("active",d)}else $('input[type="checkbox"]',$(this)).trigger("click")}),$(document).on("click",function(a){$.fn.popover&&!0!==$(a.target).data("popover")&&0===$(a.target).parents('[data-popover="true"]').length&&0===$(a.target).parents(".popup").length&&0===$(a.target).parents(".popover").length&&$(".popover").popover("hide")}),$(document).on("click",".uncheckAll[data-check-container]",function(){var b=$(this);a.Util.toggleCheckboxesForContainer($("#"+b.data("check-container")),!1,b.data("check-visible"))}).on("click",".checkAll[data-check-container]",function(){var b=$(this);a.Util.toggleCheckboxesForContainer($("#"+b.data("check-container")),!0,b.data("check-visible"))}),$(document).on("submit",'form[action="#"]',function(a){a.preventDefault()}),$(document).on("click",'a[href="#"]',function(a){a.preventDefault()}),$(document).on("click","[data-url]",function(){Kore.navigate($(this).data("url"))}).on("click","[data-url-absolute]",function(){Kore.navigate($(this).data("url"),!0)}),$(document).on("click",".input-autoselect",function(){$(this)[0].select()}),$(document).on("click",".popover .dismiss",function(){$(this).parents(".popover").first().popover("hide")}).on("click",".popover .destroy",function(){$(this).parents(".popover").first().popover("destroy")}),$(document).on("click",".button-multi-push .button",function(){var a=$(this);a.addClass("active").siblings(".button").removeClass("active"),a.parent().hasClass("button-multi-push-primary")&&a.addClass("button-primary").siblings(".button").removeClass("button-primary")}),$(document).on("click",".control-switch-group .control-switch",function(){var a=$(this),b=a.next(".control-switch");b.length||(b=a.parents(".control-switch-group").first().find(".control-switch").first()),b.addClass("control-switch-on").siblings(".control-switch-on").removeClass("control-switch-on"),b.focus().trigger("control-switched")}),$(document).on("click",".print",function(){window.print();var a=$(".float-left");a.removeClass("float-left"),setTimeout(function(){a.addClass("float-left")},1);var b=$(".float-right");b.removeClass("float-right"),setTimeout(function(){b.addClass("float-right")},1)}),$(document).on("click",".button-push",function(a){var b=!$(this).hasClass("active");$(this).toggleClass("active",b),$(this).hasClass("button-push-primary")&&$(this).toggleClass("button-primary",b)}),$(document).on("click",".button.button-switch:not(.active)",function(a){var b=$(this);b.siblings(".button-switch.active").removeClass("active"),b.addClass("active"),b.trigger("change")}).on("click",".button-switch .button:not(.active)",function(a){var b=$(this);b.closest(".button-switch").find(".button.active").removeClass("active"),b.addClass("active"),b.trigger("change")}),$(document).on("click",".locked",function(a){a.stopPropagation(),a.preventDefault()}),$(document).on("click activate",".tabbar .tab[data-tab]",function(){var a=$(this),b=a.parents(".tabbar"),c=b.data("tabs"),d=a.data("tab");$(".tab",b).removeClass("active"),a.addClass("active"),$('.tab-content[data-tabs="'+c+'"].active').removeClass("active").trigger("hidden"),$('.tab-content[data-tabs="'+c+'"][data-tab='+d+"]").addClass("active").trigger("shown")}),$(document).on("click","[data-toggle-hidden]",function(){var a=$(this).data("toggle-hidden"),b=$("#"+a);b.toggleClass("hidden"),b.is("hidden")||b.find("input").first().focus()}),$(document).on("mouseenter","[data-toggle=tooltip]:not([data-original-title])",function(){$(this).tooltip({trigger:"manual"}).tooltip("show")}).on("mouseenter","[data-toggle=tooltip][data-original-title]",function(){$(this).tooltip("show")}).on("mouseleave","[data-toggle=tooltip]",function(){$(this).tooltip("hide")})}function m(a,b,c){void 0===b&&(b=!1),c=c?c+":visible":"",console.log("sSelectorVisible",c);var d=c+" input[type=checkbox]",e=a.find(d);b?e.filter(":not(:checked)").click():e.filter(":checked").click()}function n(a,b,c,d){void 0===b&&(b=null),void 0===c&&(c=null),a.hasClass("shadow-on-scroll")||(d=void 0===d?!!a.attr("data-shadow-on-side"):d,b=b||a,c=c||a,a.addClass("shadow-on-scroll").scroll(function(){var a=$(this),e=!!a.scrollTop();b.toggleClass("shadow-on-top",e);var f=a.outerHeight(),g=a[0].scrollHeight,h=g&&g-f!==a.scrollTop();if(c.toggleClass("shadow-on-bottom",h),d){var i=!!a.scrollLeft();b.toggleClass("shadow-on-left",i);var j=a.width(),k=a[0].scrollWidth,l=k-j!==a.scrollLeft();c.toggleClass("shadow-on-right",l)}}).trigger("scroll"))}function o(a,b){void 0===b&&(b=!1);var c,d="IE",e=document.createElement("B"),f=document.documentElement;return a&&(d+=" "+a,b&&(d=b+" "+d)),e.innerHTML="\x3c!--[if "+d+']><b id="iecctest"></b><![endif]--\x3e',f.appendChild(e),c=!!document.getElementById("iecctest"),f.removeChild(e),c}function p(a){void 0===a&&(a={}),$("select:not(.uniformed)").each(function(){var b=$(this);b.uniform(a).addClass("uniformed"),b.parents(".selector").addClass(b.data("classes"))}),$('input[type="file"]:not(.uniformed)').each(function(){var b=$(this),c={},d=b.data("filenameclass");d&&(c.filenameClass=d);var e=b.data("filebuttonhtml");e&&(c.fileButtonHtml=e),$.extend(a,c),b.uniform(a).addClass("uniformed"),b.parents(".uploader").find(".action").addClass(b.data("button"))})}function q(a){var b=$(a);$.uniform.update(a),b.parents(".selector").addClass(b.data("classes"));var c=$("option:selected",b).data("color");return c&&b.parents(".selector").first().removeClass(function(a,b){var c=b.match(/color-\d+/g)||[];return c.length?c.join(" "):""}).addClass("color-"+c),b}function r(a){a.find('select, input[type="checkbox"], input[type="radio"], input[data-date], button').prop("disabled",!0),a.find('input[type="text"], input[type="number"], textarea').prop("readonly",!0)}function s(a){var b=window.chrome,c=window.navigator,d=c.vendor,e=c.userAgent.indexOf("OPR")>-1,f=c.userAgent.indexOf("Edge")>-1;if(c.userAgent.match("CriOS")){if(a)return!0}else if(null!==b&&void 0!==b&&"Google Inc."===d&&0==e&&0==f)return!0;return!1}function t(a){if(Object.keys)return Object.keys(a).length;var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}function u(a){var b={};return a.filter(function(a){return!b.hasOwnProperty(a)&&(b[a]=!0)})}function v(a,b,c){if(void 0===c&&(c=!1),!a)return[];a.sort(function(a,d){var e=a[b].toLowerCase(),f=d[b].toLowerCase();return e<f?c?1:-1:e>f?c?-1:1:0})}function w(a,b,c){void 0===b&&(b=null),void 0===c&&(c=700);var d=a.css("background-color");a.finish(),a.css("background-color","#fffce5"),a.animate({backgroundColor:"#fffce5"},c,function(){a.animate({backgroundColor:d},1e3,function(){a.css("background-color",""),$.isFunction(b)&&b()})})}function x(a,b){void 0===b&&(b=null),a.css("background-color","#fffce5"),a.animate({backgroundColor:"#fffce5"},400,function(){a.slideUp(700,"easeOutExpo",function(){a.remove(),$.isFunction(b)&&b()})})}function y(a){a.hasClass("locked")||(a.addClass("locked"),a.fadeTo(0,.5))}function z(a){a.fadeTo(0,1),a.removeClass("locked")}function A(a){var b=moment(),c=b.diff(a)/1e3;return c<43200?a.fromNow():c<172800?a.calendar():B(a,!0)}function B(b,c){switch(a.Global.getUserDateFormatFamily()){case a.Global.UserDateFormats.FR:return b.format("D MMMM YYYY"+(c?" HH:mm":""));case a.Global.UserDateFormats.EN:default:return b.format("MMMM D YYYY"+(c?" h:mm A":""))}}function C(b,c,d,e){if(void 0===e&&(e={}),!window.FormData)return a.Alert.show("Your browser does not support HTML5 file upload");var f,g=Kore.createApiXhr(d);if(e.sendDataByHeader)g.setRequestHeader("X-Wimi-WApi",encodeURIComponent(JSON.stringify(c))),f=b;else{var h=new FormData;h.append("file",b),$.each(c,function(a,b){h.append(a,b)}),f=h}g.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;console.log(b+"% uploaded"),e.onProgress&&$.isFunction(e.onProgress)&&e.onProgress(a.loaded,a.total)}},g.onload=function(){try{var a=JSON.parse(this.response);200!=this.status||a.error?(Kore.handleResponseError(a),console.log("Upload error:",a),$.isFunction(e.onError)&&e.onError(a,this)):(console.log("Upload success:",a),$.isFunction(e.onSuccess)&&e.onSuccess(a,this))}catch(a){console.warn("Error: "+a);var b={id:g.status,str:g.statusText,debug_msg:a.message,detail_id:a.name,detail_str:a.message};$.isFunction(e.onError)&&e.onError(b,this)}$.isFunction(e.onComplete)&&e.onComplete()},g.send(f)}function D(a){window.location.assign(a)}function E(a,b){return void 0===b&&(b=!1),a.toggleClass("loading",!!b).prop("disabled",!!b)}function F(a,b){void 0===a&&(a=20),void 0===b&&(b="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");for(var c="",d=a;d>0;--d)c+=b[Math.floor(Math.random()*b.length)];return c}function G(a,c,d,e){var f="g";e&&(f+="i");var g=new RegExp("(("+b.escapeStringForRegex(c)+"))",f);return a.replace(g,"<span class='"+d+"'>$1</span>")}function H(a,b){return a=a.replace(/(^|[\n ])([\w]*?)((www|ftp)\.[^ \,"\t\n\r<]*)/gi,"$1$2http://$3"),a.replace(/(^|[\n ])([\w]*?)((ht|f)tp(s)?:\/\/[\w]+[^ \,"\n\r\t<]*)/gi,"<a href='$&' target='_blank' class='"+b+"'>$&</a>")}function I(a){var b=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],c=RegExp("["+b.join("\\")+"]","g");return a.replace(c,"\\$&")}function J(a,b,c){if(void 0===c&&(c=0),!a||!b)return null;if(a.diff(b,"days")>-1*c){var d=b.clone();return d.year(a.year()).dayOfYear(a.clone().add(c,"day").dayOfYear()),a.isAfter(d)&&d.add(1,"day"),d}return null}function K(a,b,c){if(void 0===c&&(c=0),!a||!b)return null;if(a.diff(b,"days")>-1*c){var d=a.clone();return d.year(b.year()).dayOfYear(b.clone().subtract(c,"day").dayOfYear()),d.isAfter(b)&&d.subtract(1,"day"),d}return null}function L(c){return c.find(".message:not(.rendered)").each(function(){var c=$(this),d=c.find(".content");d.is(".deleted")?d.prepend('<span class="message-deleted"><i class="fa fa-trash icon-left"></i><span class="italic">'+a.Global.trans("message_deleted")+"</span></span>"):(d.is(".edited")&&d.prepend('<i class="fa fa-pencil icon-left message-edited" data-toggle="tooltip" title="'+a.Global.trans("chat.edited_message")+'"></i>'),d.html(WDTEmoji.render(c.find(".content").html())),d.html(b.linkify(c.find(".content").html(),"message-hyperlink"))),c.addClass("rendered")}),a.Global.viewLoaded(c)}function M(a){for(var b=1024,c=a,d=0,e=["o","ko","Mo","Go"];c>b&&d<e.length;)c=parseFloat((c/b).toFixed(2)),d++;return c+" "+e[d]}function N(a,b){void 0===b&&(b=2);var c=a.split(" ");return c=c.splice(0,b),c.map(function(a){if(a.length)return a[0]}).join("")}function O(a,b){void 0===b&&(b={});var c={customClass:null,size:null,tooltip:!0,html:!1};$.extend(c,b);var d=N(a),e=$('<span class="avatar" title="'+a+'">'+d+"</span>");return c.tooltip&&e.attr("data-toggle","tooltip"),c.customClass&&e.addClass(b.customClass),c.size&&e.css({height:b.size+"px",width:b.size+"px",lineHeight:b.size+"px"}),c.html?e.get(0).outerHTML:e}function P(a,b){return void 0===b&&(b={}),Q(Model.User.getUser(a),b)}function Q(a,b){void 0===b&&(b={});var c={customClass:null,size:null,tooltip:!0,html:!1,status:!1};$.extend(c,b);var d=Model.User.getUserInitialsFor(a),e=Model.User.getUserNameFor(a),f=a&&a.hasAvatar()?a.avatarPath():null,g=a?a.status:"offline",h=$('<span class="avatar" title="'+e+'">'+d+"</span>");return h.attr("data-user",a?a.user_id:null),c.status&&h.attr("data-status",g),c.tooltip&&h.attr("data-toggle","tooltip"),f&&h.css({backgroundImage:"url('"+f+"')",color:"transparent"}),c.customClass&&h.addClass(b.customClass),c.size&&h.css({height:b.size+"px",width:b.size+"px",lineHeight:b.size+"px"}),c.html?h.get(0).outerHTML:h}function R(a,b,c){var d=b.href?$("<a>").attr("href",b.href):$("<button>");if(d.addClass("button").html(a),b.href&&b.hrefTarget&&d.attr("target",b.hrefTarget),b.type&&d.addClass(b.type),b.customClass&&d.addClass(b.customClass),b.autofocus&&d.attr("autofocus","autofocus"),b.iconLeft&&d.prepend($('<i class="fa">').addClass(b.iconLeft).addClass("icon-left")),b.iconRight&&d.append($('<i class="fa">').addClass(b.iconRight).addClass("icon-right")),d.is("button")){var e=b.submit?"submit":"button";d.attr("type",e)}return c?d.get(0).outerHTML:d}function S(a,b){return R(a,b,!0)}function T(a,b,c,d,e){var f="containsNoCase";d&&(f="contains");var g="li";if(c&&(g=c),a){var h=b.find(g+":not( .not-matching:"+f+"("+a+") )");h.hide(),h.addClass("not-matching");var i=b.find(g+".not-matching:"+f+"("+a+")");i.show(),i.removeClass("not-matching")}else{var h=b.find(g+".not-matching");h.show(),h.removeClass("not-matching")}e&&e()}function U(a,c,d){var e=$.extend({canRemove:!0,onRemoved:null,avatarOptions:{}},d),f={tooltip:!0};$.extend(f,e.avatarOptions);var g=b.avatar(a,f);return g.attr("data-user",a),e.canRemove&&(g.append('<button class="button-bare avatar-remove" type="button"><i class="fa fa-remove"></i></button>'),$(".avatar-remove",g).click(function(b){b.stopPropagation(),$(this).closest(".avatar").tooltip("hide").tooltip("destroy").remove(),$.isFunction(e.onRemoved)&&e.onRemoved(a)})),c.append(g),g.tooltip(),g}function V(c,d,e,f){var g=0;switch(e){case b.SortCriteria.SIZE:var h=c.size,i=d.size;g=h<i?-1:h>i?1:0;break;case b.SortCriteria.DATE:var j=c.date,k=d.date;g=j<k?-1:j>k?1:0;break;case b.SortCriteria.TRASH_DATE:var j=c.trash_date,k=d.trash_date;g=j<k?-1:j>k?1:0;break;case b.SortCriteria.USER:var l=Model.User.getUserName(c.user_id,""),m=Model.User.getUserName(d.user_id,"");g=l<m?-1:l>m?1:0;break;case b.SortCriteria.TRASH_USER:var l=Model.User.getUserName(c.trash_user_id,""),m=Model.User.getUserName(d.trash_user_id,"");g=l<m?-1:l>m?1:0;break;case b.SortCriteria.NAME:default:var n=c.name.toUpperCase(),o=d.name.toUpperCase();g=n<o?-1:n>o?1:0}return f==a.TreeSortOrder.DESC&&(g*=-1),g}function W(c,d,e,f){var g=0;switch(e){case b.SortCriteria.DATE:case b.SortCriteria.TRASH_DATE:var h=c.date,i=d.date;g=h<i?-1:h>i?1:0;break;case b.SortCriteria.SIZE:case b.SortCriteria.USER:case b.SortCriteria.TRASH_USER:case b.SortCriteria.NAME:default:var j=c.name.toUpperCase(),k=d.name.toUpperCase();g=j<k?-1:j>k?1:0}return f==a.TreeSortOrder.DESC&&(g*=-1),g}b.UTCFormatDate="YYYY-MM-DD",b.UTCFormatTime="HH:mm:ss",b.UTCFormat=b.UTCFormatDate+" "+b.UTCFormatTime,b.aWebcalDays=["SU","MO","TU","WE","TH","FR","SA"],b.dayNumberToWebcal=c,b.webcalDayToNumber=d,b.webcalWeekendDays=e,b.webcalWeekDays=f,b.timezoneOffsetForDate=g,b.localDateToUTC=h,b.arrayRemove=i,b.arrayRemoveElement=j,b.htmlentities=k,b.bind=l,b.toggleCheckboxesForContainer=m,b.shadowOnScroll=n,b.isIE=o,b.uniform=p,b.uniformUpdate=q,b.readonly=r,b.isChrome=s,b.oLength=t,b.distinct=u,b.sortArrayforObjectKey=v,b.didAdd=w,b.didRemove=x,b.lock=y,b.unlock=z;var X=function(){function b(a){var b;void 0===a.attr("data-before-save-title")?(b=a.attr("title")||a.data("original-title")||"",a.attr("data-before-save-title",b)):b=a.attr("data-before-save-title"),this.$element=a,this.titleBeforeSave=b}return b.prototype.init=function(){this._show('<span class="nowrap"><i class="fa fa-save icon-left"></i>'+a.Global.trans("tooltip.saving")+"</span>")},b.prototype.onSuccess=function(){this._show('<span class="nowrap"><i class="fa fa-check icon-left"></i>'+a.Global.trans("tooltip.saved")+"</span>",2e3)},b.prototype.onError=function(){this._show('<span class="nowrap"><i class="fa fa-times icon-left"></i>'+a.Global.trans("error")+"</span>",2e3)},b.prototype._show=function(a,b){var c=this.$element.data("save-timeout");if(c&&clearTimeout(c),this.$element.tooltip("destroy").tooltip({placement:this.$element.data("placement")||"top",html:!0,trigger:"manual"}).attr("title",a).tooltip("fixTitle").tooltip("show"),b){var d=this,e=setTimeout(function(){d.$element.tooltip("destroy").attr("title",d.titleBeforeSave).tooltip("fixTitle").attr("data-original-title",d.titleBeforeSave).data("original-title",d.titleBeforeSave)},b);this.$element.data("save-timeout",e)}},b}();b.SaveTooltip=X,b.naturalDate=A,b.userFormat=B,b.uploadFile=C,b.downloadFileURL=D,b.buttonLoading=E,b.uniqueKey=F,b.wrapText=G,b.linkify=H,b.escapeStringForRegex=I,b.ensureEndDateIsAfter=J,b.ensureStartDateIsBefore=K,b.messageViewLoaded=L,b.naturalSize=M,b.initialsFor=N,b.avatarForName=O,b.avatar=P,b.avatarFor=Q,b.ButtonType={PRIMARY:"button-primary",ACCEPT:"button-accept",BLUE:"button-blue",RED:"button-red",GREEN:"button-green",ORANGE:"button-orange"},b.button=R,b.buttonHTML=S,b.updateSearchFilterForList=T,b.addUserInCollection=U,b.SortCriteria={NAME:"name",DATE:"date",TRASH_DATE:"trash_date",USER:"user",TRASH_USER:"trash_user",SIZE:"size"},b.sortFiles=V,b.sortDirectories=W;var Y=function(){function a(a,b,c){void 0===c&&(c={}),this.$list=a,this.checkboxSelector=b,this.options=c,this.init()}return a.prototype.init=function(){var a=this;this.$list.on("click",this.checkboxSelector,function(b){var c=$(this);a.onCheckboxClicked(c,c.is(":checked"),b)}),this.options.toggleCheckbox&&this.addCheckboxToggle(this.options.toggleCheckbox)},a.prototype.onCheckboxClicked=function(a,b,c){var d=this;if(b)if(c.shiftKey&&d.$lastSelected)for(var e=d.$list.find(d.checkboxSelector).index(d.$lastSelected),f=d.$list.find(d.checkboxSelector).index(a),g=e<=f?e:f,h=g+Math.abs(e-f),i=g;i<h;i++){var j=$(d.$list.find(d.checkboxSelector).get(i+1));d.select(j,c)}else d.select(a,c);else d.deselect(a,c);c.shiftKey&&document.getSelection().removeAllRanges(),d.$lastSelected=a},a.prototype.addCheckboxToggle=function(a){var b=this;a.on("click",function(){$(this).is(":checked")?b.selectAll():b.deselectAll()})},a.prototype._select=function(a,b,c){a.prop("checked",b);var d=this.options["on"+(b?"Selected":"Deselected")];$.isFunction(d)&&d(a,c),this.update(c)},a.prototype.select=function(a,b){this._select(a,!0,b)},a.prototype.deselect=function(a,b){this._select(a,!1,b)},a.prototype.getSelectedCount=function(){return this.getSelected().length},a.prototype.getSelected=function(){return this.$list.find(this.checkboxSelector).filter(":checked")},a.prototype.deselectAll=function(){this.$list.find(this.checkboxSelector+":checked").click(),this.options.toggleCheckbox&&this.options.toggleCheckbox.prop("checked",!1)},a.prototype.selectAll=function(){this.$list.find(this.checkboxSelector+":not(:checked)").click()},a.prototype.update=function(a){if($.isFunction(this.options.onChanged)){var b=this.getSelectedCount();this.options.onChanged(b,a)}},a}();b.Selection=Y}(a.Util||(a.Util={}))}(App||(App={}));var App;!function(a){!function(b){function c(b,c){var d={delay:150,duration:a.Effect.duration,ease:a.Effect.ease,offset:150,begin:null,complete:null,max:0};$.extend(d,c);var e=0;b.hide(0).each(function(a){var b=$(this);setTimeout(function(){b.show(0),(!d.max||d.max&&a<d.max)&&b.css({opacity:.1,top:d.offset+"px",bottom:"-"+d.offset+"px"}).animate({opacity:1,top:"0px",bottom:"0px"},d.duration,d.ease,function(){$.isFunction(d.complete)&&d.complete(b)}),$.isFunction(d.begin)&&d.begin(b)},e),(!d.max||d.max&&a<d.max)&&(e+=d.delay)})}b.duration=500,b.ease="easeOutExpo",b.showCollection=c}(a.Effect||(a.Effect={}))}(App||(App={}));var App;!function(a){!function(b){function c(a,b){var c=$("#popup-overlay");return c.length||(c=$('<div id="popup-overlay"></div>'),$("body").append(c)),a.on("click",".dismiss",function(){d(a),$.isFunction(b)&&b()}),c.find(".popup").hide(),c.append(a),Kore.onViewLoaded(a),a}function d(a,b){if(void 0===b&&(b={}),a){if(a.hasClass("popover"))return a.popover(b.destroy?"destroy":"hide");a.remove();var c=$("#popup-overlay"),d=c.find(".popup");d.length?d.last().show():c.remove()}}function e(a,b){return a.has(".title-bar")&&a.addClass("has-title"),a.has(".controls")&&a.addClass("has-controls"),b.fullsize&&a.addClass("fullsize"),b.fullscreen&&a.addClass("fullscreen"),b.verticalFit&&a.addClass("vertical-fit"),b.autoWidth&&a.addClass("auto-width"),b.maxWidth&&a.addClass("max-width"),b.minWidth&&a.addClass("min-width"),b.customClass&&a.addClass(b.customClass),b.customId&&a.attr("id",b.customId),b.scrollable&&(a.addClass("popup-scrollable"),a.find(".message-inner").first().attr("data-shadow","true")),a}function f(b,d,f){void 0===d&&(d=null),void 0===f&&(f=null);var g,h=$.extend({controls:[],popover:{}},f),i=h.controls;h.cancel&&i.unshift(a.Util.buttonHTML(a.Global.trans("cancel"),{customClass:"dismiss"}));var j="";i.length&&(j='<div class="controls"><div class="float-right">'+h.controls.join("")+'</div><div class="clear"></div></div>');var k=h.popover.trigger;if(k){var l=h.popover.options||{};if(k.tooltip("hide").attr("data-popover","true").data("popover",!0),k.data("bs.popover")){var m=k.data("bs.popover").tip().hasClass("in");if(f.destroy&&k.popover("destroy"),!m)return}"auto"==l.placement&&(l.placement=function(a,b){var c=$(b).offset(),d=$(document).outerHeight(),e=$(document).outerWidth(),f=.5*d-c.top,g=f>0?"bottom":"top",h=.5*e-c.left,i=h>0?"right":"left";return Math.abs(h)>Math.abs(f)?i:g});var n=(b instanceof jQuery?b:$("<span>"+b+"</span>")).find(".content").first(),o=n.length?n.parent().append(j):b;g=k.popover($.extend({content:o,html:!0},l)).data("bs.popover").tip(),$._data(k.get(0),"events").shown||(k.on("shown.bs.popover",function(){if(g.off(),k.hasClass("popup-prevent-closing-others")||$(".popover:not(#"+g.attr("id")+")").popover("hide"),"bottom-left"===l.custom_placement){var a=$(".arrow",g),b=k.offset().left-$(l.container).offset().left,c=k.offset().top-$(l.container).offset().top+k.outerHeight();a.css("left",k.outerWidth()/2),g.css("top",c+"px"),g.css("left",b+"px")}l.onTop&&g.addClass("on-top"),$.isFunction(h.onShown)&&h.onShown(g),Kore.onViewLoaded(g)}),e(g,h),k.popover("show"),$.isFunction(h.onCreated)&&h.onCreated(g))}else{if(g=$('<div class="popup"><div class="message"><div class="message-inner"></div></div></div>'),g.find(".message-inner").append(b),j){var n=g.find(".content").first();n.length?n.parent().append(j):g.find(".message-inner").append(j)}e(g,h),g=c(g,d),$.isFunction(h.onShown)&&h.onShown(g)}return g}function g(a,b){return void 0===b&&(b={}),f(a,null,b)}function h(a,b,c){return void 0===c&&(c={}),c=$.extend({fullscreen:!0},c),g('<div class="iframe-header"><table class="full-width"><tr><td class="text-center bold">'+b+'</td><td class="min"><button class="control-light dismiss"><i class="fa fa-fw fa-times"></i></button></td></tr></table></div><div class="iframe-body absolute fullscreen"><iframe src="'+a+'" width="100%" height="100%"></div>',c)}function i(b,c,d,e,f,h){var i='<form action="#">'+(b?'<div class="title-bar">'+b+"</div>":"")+'<div class="content">'+c+"</div></form>",j=$.extend({submit:!0,autofocus:!0},f);return d=$.extend({onShown:function(a){a.on("submit","form",function(){h(a)})},cancel:!0,controls:[a.Util.buttonHTML(e,j)],destroy:!0},d),g(i,d)}function j(b,c){return i(a.Global.trans("del"),a.Global.trans("really_sure_del"),b,a.Global.trans("delete").toUpperFirst(),{iconLeft:"fa-trash-o",type:a.Util.ButtonType.RED},c)}b.hide=d,b.show=f,b.popup=g,b.iframe=h,b.confirm=i,b.confirmDelete=j}(a.Popup||(a.Popup={}))}(App||(App={}));var App;!function(a){!function(b){function c(b,c){return void 0===c&&(c=null),a.Popup.show(b,c,{controls:[a.Util.buttonHTML("Ok",{autofocus:!0,type:a.Util.ButtonType.ACCEPT,customClass:"dismiss"})]})}b.show=c}(a.Alert||(a.Alert={}))}(App||(App={}));var App;!function(a){!function(a){function b(){return[a.left,a.up,a.right,a.down,a.escape,a.tab,a.shift]}a.enter=13,a.left=37,a.up=38,a.right=39,a.down=40,a.escape=27,a.tab=9,a.shift=16,a.keysToIgnoreOnKeyUp=b}(a.Keys||(a.Keys={}))}(App||(App={}));var App;!function(a){!function(b){function c(b,c){
void 0===c&&(c={});var e={icon:a.Global.urlStaticImageCustom("notification-icon.png"),body:"",timeout:6e3,sticky:!1,onclick:null};if(c=$.extend(e,c),!c.sticky&&c.timeout||(c.timeout=0,c.sticky=!0),!("Notification"in window)){if(!c.sticky)return;return void(confirm(b+(c.body?"\n"+c.body:"")+"\n\n("+a.Global.trans("notif.change_browser")+")")&&c.onclick&&c.onclick())}d(function(a){var d=new Notification(b,c);c.notification&&c.notification(d),c.onclick&&(d.onclick=c.onclick),c.sticky||setTimeout(function(){d.close()},c.timeout)})}function d(a){return"Notification"in window?"granted"===Notification.permission?!a||a(!0):void Notification.requestPermission(function(b){Notification.permission!==b&&(Notification.permission=b),"granted"!==b&&console.log("permission denied"),a&&a("granted"===Notification.permission)}):!!a&&a(!1)}b.notify=c}(a.WebNotifications||(a.WebNotifications={}))}(App||(App={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},App;!function(a){var b=function(b){function c(d,e){b.call(this,d,$.extend({itemsForDirectoryRef:function(b,d){a.API.Document.getEntries(b,!1,!0,{onSuccess:function(b){var e=new a.API.Document.Entry.ListResponse(b),f=[],g=e.dirs,h=e.files;f=f.concat(c.directoriesToItems(g)),f=f.concat(c.filesToItems(h)),d(f)},onError:function(){return d([]),!1}})}},e))}return __extends(c,b),c.filesToItems=function(b){return b.map(function(b){return{ref:b.file_id,name:b.name,type:a.ITreeBoxItemType.FILE,originalItem:b}})},c.directoriesToItems=function(b){return b.map(function(b){return{ref:b.dir_id,name:b.name,type:a.ITreeBoxItemType.DIRECTORY,nb_dirs:b.nb_dirs,nb_files:b.nb_files,originalItem:b}})},c}(a.TreeBox);a.WimiTree=b}(App||(App={})),this.App=this.App||{},this.App.Templates=this.App.Templates||{},this.App.Templates.Global=this.App.Templates.Global||{},this.App.Templates.Global=function(){function encodeHTMLSource(){var a={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},b=/&(?!#?w+;)|<|>|"|'|\//g;return function(){return this?this.replace(b,function(b){return a[b]||b}):this}}String.prototype.encodeHTML=encodeHTMLSource();var tmpl={};return tmpl.apps=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div><div class="title-bar">'+trans("get_apps")+'</div></div><div class="section-padding" id="get-apps"><div class="property property-block"><span class="property-name">'+trans("wimi_disk")+'</span><span class="property-info">'+trans("infobulle_wimi_disk_footer")+'</span><span class="property-value"><div><a class="button full-width" href="'+view.link_wd_pc+'"><i class="fa fa-windows icon-left"></i>'+trans("download").toUpperFirst()+' (PC)</a></div><div><a class="button full-width" href="'+view.link_wd_mac+'"><i class="fa fa-apple icon-left"></i>'+trans("download").toUpperFirst()+" (MAC)</a></div>";return view.show_wimi_disk_howto&&(out+='<div><a class="button full-width" target="_blank" href="'+trans("tutorial_wimi_disk")+'"><i class="fa fa-book icon-left"></i>'+trans("popup.wimi_disk.didacticiel")+"</a></div>"),out+="</span></div>",view.show_outlook_connector&&view.link_outlook_pc&&(out+='<div class="property property-block"><span class="property-name">'+trans("outlook_connector")+'</span><div><a class="button full-width" target="_blank" href="'+view.link_outlook_pc+'"><i class="fa fa-windows icon-left"></i>'+trans("download").toUpperFirst()+" (PC)</a></div></div>"),view.link_evebim_pc&&view.link_evebim_mac&&(out+='<div class="property property-block"><span class="property-name">eveBIM</span><span class="property-value"><div><a class="button full-width" href="'+view.link_evebim_pc+'"><i class="fa fa-windows icon-left"></i>'+trans("download").toUpperFirst()+' (PC)</a></div><div><a class="button full-width" href="'+view.link_evebim_mac+'"><i class="fa fa-apple icon-left"></i>'+trans("download").toUpperFirst()+" (MAC)</a></div></span></div>"),(view.link_ios||view.link_android)&&(out+='<div class="property property-block"><span class="property-name">'+trans("mobile_apps")+'</span><span class="property-value">',view.link_ios&&(out+='<div><a class="button full-width" target="_blank" href="'+view.link_ios+'"><i class="fa fa-apple icon-left"></i>iPhone / iPad</a></div>'),view.link_android&&(out+='<div><a class="button full-width" target="_blank" href="'+view.link_android+'"><i class="fa fa-android icon-left"></i>Android</a></div>'),out+="</span></div>"),out+="</div>"},tmpl.attachedItem=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="attached-item reveal-hover" data-item="'+view.id+'" data-type="'+view.doc_type+'" data-doc="'+view.doc_id+'" data-external="'+view.is_external+'" data-project="'+view.project_id+'"><div class="item"><div class="thumbnail-background"></div><div class="thumbnail"><div class="thumbnail-inner"><span class="file-icon '+view.icon_extension+'">';return view.display_extension?out+=""+view.display_extension:out+="&nbsp;",out+='</span></div></div><div class="content"><div class="title">'+view.name+"</div><div>"+trans("added_by",{user:view.username})+'</div></div><div class="clear"></div></div><div class="meta"><table><tr><td class="full-width">',view.trash?out+='<span><i class="fa fa-trash-o"></i> '+trans("file.deleted")+"</span>":(view.can_download&&(out+='<span class="control-light item-download" data-toggle="tooltip" title="'+trans("download").toUpperFirst()+'" data-container="body"><i class="fa fa-fw fa-download"></i></span>'),view.can_preview&&(out+='<span class="control-light item-preview" data-toggle="tooltip" title="'+trans("preview")+'" data-container="body"><i class="fa fa-fw fa-search"></i></span>'),view.can_unversion&&(out+='<span class="control-light item-unversion" data-toggle="tooltip" title="'+trans("restore")+'" data-container="body"><i class="fa fa-fw fa-refresh"></i></span>'),view.goto_link&&(out+='<a class="control-light" href="'+view.goto_link+'" target="_blank" data-toggle="tooltip" title="'+trans("go_to_file")+'" data-container="body"><i class="fa fa-fw fa-arrow-circle-o-right"></i></a>'),view.is_external&&(out+='<span class="icon-right"><i class="fa fa-hdd-o"></i> '+trans("external_file")+"</span>")),out+='</td><td class="nowrap line-height-normal"><span class="added-date unless-hover">'+view.added_date+'</span><span class="remove on-hover"><button class="button button-red button-link item-remove"><i class="fa fa-trash-o icon-left"></i>'+trans("supprimer")+"</button></span></td></tr></table></div></div>"},tmpl.detail_comments=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="panel-section">';return view.title&&(out+='<div class="panel-section-title">'+view.title+'<div class="clear"></div></div>'),out+='<div class="comments"></div><div class="section-sub margin-top"><textarea name="comment" class="input text-input full-width bottom-margin-medium"></textarea></div></div>'},tmpl.detail_comments_comment=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="message';return view.is_mine&&(out+=" message-mine"),out+='" data-message="'+view.comment_id+'" title="'+App.Util.userFormat(view.date,!0)+'">',view.show_meta&&(out+='<div class="meta"><span class="date" data-date="'+view.date+'">'+view.display_date+"</span>",(view.airtime_user_id||view.chat_user_id)&&(out+='<span class="user-info-extra">',view.airtime_user_id&&(out+='<span class="open-air link" data-air-users="'+view.airtime_user_id+'"><i class="fa fa-video-camera icon-left"></i>'+trans("call_via_airtime")+"</span>"),view.chat_user_id&&(out+='<span class="open-chat link" data-chat-user="'+view.airtime_user_id+'"><i class="fa fa-comments icon-left"></i>Chat</span>'),out+="</span>"),out+='<span class="user-info">'+view.avatar+'<span class="user-name">'+view.username+'</span></span><div class="clear"></div></div>'),out+='<table class="full-width"><tr>',view.is_mine&&(out+='<td class="message-actions nowrap min">',view.can_edit&&(out+='<button type="button" class="control-light button-icon message-edit"><i class="fa fa-fw fa-pencil"></i></button>'),view.can_favorite&&(out+='<button type="button" class="control-light button-icon message-favorite',view.favorite&&(out+=" is-favorite"),out+='"><i class="fa fa-fw fa-star-o"></i></button>'),out+="</td>"),out+='<td class="message-col"><div class="message-content"><div class="message-box">',view.attachment&&(out+='<div class="message-attachment-container"><div class="message-attachment" data-attachment="'+view.attachment.attachment_id+'"><table><tr><td><span class="icon-left">'+view.attachment.getIcon()+'</span></td><td><span class="message-attachment-name">'+view.attachment.name+'</span></td><td class="min nowrap">',view.attachment.previewable_isAutomaticPreviewMode()&&(out+='<button class="button button-link button-icon attachment-preview" type="button" data-toggle="tooltip" title="'+trans("preview").toUpperFirst()+'" data-container=".message-box"><i class="fa fa-fw fa-eye"></i></button>'),out+='<button class="button button-link button-icon attachment-download" type="button" data-toggle="tooltip" title="'+trans("download").toUpperFirst()+'" data-container=".message-box"><i class="fa fa-fw fa-download"></i></button></td></tr></table></div></div>'),out+='<div class="content'+(view.content?"":" empty")+(view.deleted?" deleted":view.edited?" edited":"")+'">'+encodeHTML(view.deleted?"":view.content)+"</div></div></div></td>",view.is_mine||(out+='<td class="message-actions nowrap min">',view.can_favorite&&(out+='<button type="button" class="control-light button-icon message-favorite',view.favorite&&(out+=" is-favorite"),out+='"><i class="fa fa-fw fa-star-o"></i></button>'),out+="</td>"),out+="</tr></table></div>"},tmpl.detail_event_files_upload=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="content"><ul class="list-menu"><li class="list-menu-section">'+trans("from_location")+'</li><li class="list-menu-item dismiss add-file-from-wimi"><table><tr><td><i class="fa fa-fw fa-cloud list-menu-icon"></i></td><td>'+trans("PRODUCT_NAME")+'</td></tr></table></li><li class="list-menu-item no-padding dismiss add-file-from-local"><input type="file" multiple="true" name="file" data-button="" class="add-file" data-filenameclass="hidden" data-filebuttonhtml="<table><tr><td><i class=\'fa fa-fw fa-hdd-o list-menu-icon\'></i></td><td>'+trans("this_computer")+'</td></tr></table>"></li></ul><div class="alert alert-info margin-top">'+trans("panel_dragndrop_info")+"</div></div>";return out},tmpl.dropZone=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="dropzone"><div class="inner"><div class="inline-block middle"><span class="file-icons"><i class="fa fa-file-image-o"></i><i class="fa fa-file-text-o"></i><i class="fa fa-file-archive-o"></i></span><span class="upload-icon"><i class="fa fa-cloud-upload"></i></span></div></div></div>';return out},tmpl.exportActivity=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form method="post" action="#" name="export-activity"><div class="title-bar">'+trans("export_activity")+'</div><div class="content"><table class="table-form-horizontal full-width"><tr><td><label>'+trans("date")+'</label></td><td class="full-width"><table class="full-width table-input"><tr><td class="half-width"><input type="text" class="text-input input-date" required data-date="'+moment().subtract(1,"month").format(App.Util.UTCFormatDate)+'" name="min-date" placeholder="'+App.Global.getUserDateFormat()+'"></td><td><button class="button disabled" disabled>'+trans("date.to")+'</button></td><td class="half-width"><input type="text" class="text-input input-date" required data-date="'+moment().format(App.Util.UTCFormatDate)+'" name="max-date" placeholder="'+App.Global.getUserDateFormat()+'"></td></tr></table></td></tr><tr><td><label>'+trans("separateur_champs")+'</label></td><td><select name="csv-delimiter" required><option value=";">;</option><option value=",">,</option></select></td></tr></table></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button class="button button-blue"><i class="fa fa-cloud-download icon-left"></i>'+trans("export")+'</button></div><div class="clear"></div></div></form>';return out},tmpl.exportParams=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="title-bar">'+(view.title||trans("export"))+'</div><div class="content">';return view.set_name&&(out+='<div class="property property-block"><div class="property-value"><span class="button-multi"><input type="text" name="filename" class="input text-input middle" placeholder="'+trans("nom_fichier")+'">',view.set_format&&(out+='<select required name="format"><option value="csv">.csv</option><option value="vcf">.vcf</option></select>'),out+="</span></div></div>"),view.set_delimiter&&(out+='<div class="property"><div class="property-name">'+trans("separateur_champs")+'</div><div class="property-value"><select name="csv-delimiter" required><option value=";">;</option><option value=",">,</option></select></div></div>'),out+='</div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button type="button" class="button button-blue dismiss export"><i class="fa fa-cloud-download icon-left"></i>'+trans("export")+'</button></div><div class="clear"></div></div>'},tmpl.form_factory=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out="";if(view.form){out+='<div class="form-horizontal">';var arr1=view.form.rows;if(arr1){var row,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)if(i1=keys1?keys1[idx1]:idx1,row=arr1[i1],row.type==App.FormRowType.SEPARATOR)out+='<div class="line-separator"></div>';else{if(out+='<div class="form-group"><label class="'+view.form.labelCol+' control-label"><span class="control-label-text">'+trans(row.label),view.form.showRequired&&row.required&&(out+=" *"),out+='</span></label><div class="'+view.form.controlCol+'">',row.type==App.FormRowType.VIEW)out+='<div class="form-control-static">'+row.value+"</div>";else if(row.type==App.FormRowType.SELECT){out+='<select name="'+row.name+'" data-classes="full-width"',row.required&&(out+=" required"),out+=">";var arr2=row.choices;if(arr2){var choice,i2=-1,bObj="object"==typeof arr2,keys2=bObj?Object.keys(arr2):null,l2=keys2?keys2.length:arr2.length;for(idx2=0;idx2<l2;idx2++)i2=keys2?keys2[idx2]:idx2,choice=arr2[i2],out+='<option value="'+choice.value+'">'+encodeHTML(trans(choice.label))+"</option>"}out+="</select>"}else if(row.type==App.FormRowType.RADIO){var arr3=row.choices;if(arr3){var choice,i3=-1,bObj="object"==typeof arr3,keys3=bObj?Object.keys(arr3):null,l3=keys3?keys3.length:arr3.length;for(idx3=0;idx3<l3;idx3++)i3=keys3?keys3[idx3]:idx3,choice=arr3[i3],out+='<div class="form-control-static"><label><input name="'+row.name+'" value="'+choice.value+'" type="radio" class="icon-left"',choice.value==row.value&&(out+=' checked="checked"'),row.required&&(out+=" required"),out+=">"+encodeHTML(trans(choice.label))+"</label></div>"}}else if(row.type==App.FormRowType.CHECKBOX)out+='<div class="form-control-static"><input name="'+row.name+'" type="checkbox"',row.value&&(out+=' checked="checked"'),out+="></div>";else if(row.type==App.FormRowType.PHONE){out+='<table data-name="'+row.name+'" class="full-width phone-form" ',row.value&&(out+='data-phone="'+row.value.phone_id+'"'),out+='><tr><td><table class="full-width table-input"><tr><td class="min"><select class="phone-country-select" name="'+row.name+'[code]" data-classes="selector-auto">';var arr4=view.country_codes;if(arr4){var country_code,country_key=-1,bObj="object"==typeof arr4,keys4=bObj?Object.keys(arr4):null,l4=keys4?keys4.length:arr4.length;for(idx4=0;idx4<l4;idx4++)country_key=keys4?keys4[idx4]:idx4,country_code=arr4[country_key],out+='<option data-map="(+'+encodeHTML(country_code.code)+')" value="'+country_key+'" ',(row.value?country_key.toLowerCase()==row.value.code.toLowerCase():country_key.toLowerCase()==view.current_country_key)&&(out+='selected="selected"'),out+=">"+encodeHTML(country_code.name.toLowerCase().ucwords())+" (+"+encodeHTML(country_code.code)+")</option>"}out+='</select></td><td><input type="text" class="input text-input" name="'+row.name+'[number]" placeholder="'+trans("telephone")+'" value="'+encodeHTML(row.value?row.value.phone:"")+'"',row.required&&(out+=" required"),out+='></td><td class="min"><select name="'+row.name+'[type]" data-classes="selector-auto">';var arr5=view.phone_types;if(arr5){var phone_type,i5=-1,bObj="object"==typeof arr5,keys5=bObj?Object.keys(arr5):null,l5=keys5?keys5.length:arr5.length;for(idx5=0;idx5<l5;idx5++)i5=keys5?keys5[idx5]:idx5,phone_type=arr5[i5],out+='<option value="'+phone_type+'" ',row.value&&row.value.type==phone_type&&(out+='selected="selected"'),out+=">"+trans(phone_type)+"</option>"}out+='</select></td></tr></table></td><td class="min phone-form-submit hidden"><span class="icon-right"><button type="button" class="button button-green no-margin button-icon" data-toggle="tooltip" title="'+trans("save")+'"><i class="fa fa-fw fa-save"></i></button></span></td></tr></table>'}else if(row.type==App.FormRowType.ADDRESS){out+='<div class="row address-form" data-name="'+row.name+'"><div class="col-xs-12 margin-bottom"><input name="'+row.name+'[street]" type="text" class="text-input full-width" value="'+encodeHTML(row.value?row.value.street:"")+'" placeholder="'+trans("street")+'"',row.required&&(out+=" required"),out+='></div><div class="col-xs-7 margin-bottom"><input name="'+row.name+'[city]" type="text" class="text-input full-width" value="'+encodeHTML(row.value?row.value.city:"")+'" placeholder="'+trans("ville")+'"',row.required&&(out+=" required"),out+='></div><div class="col-xs-5 margin-bottom"><input name="'+row.name+'[postal_code]" type="text" class="text-input full-width" value="'+encodeHTML(row.value?row.value.postal_code:"")+'" placeholder="'+trans("code_postal")+'"',row.required&&(out+=" required"),out+='></div><div class="col-xs-12 margin-bottom"><input name="'+row.name+'[state]" type="text" class="text-input full-width" value="'+encodeHTML(row.value?row.value.state:"")+'" placeholder="'+trans("state")+'"></div><div class="col-xs-12"><select name="'+row.name+'[country]" data-classes="full-width"',row.required&&(out+=" required"),out+="><option disabled",row.value||(out+=" selected"),out+=">"+trans("country")+"</option>";var arr6=view.countries;if(arr6){var info,country=-1,bObj="object"==typeof arr6,keys6=bObj?Object.keys(arr6):null,l6=keys6?keys6.length:arr6.length;for(idx6=0;idx6<l6;idx6++)country=keys6?keys6[idx6]:idx6,info=arr6[country],out+='<option value="'+country+'"',row.value&&row.value.country==country&&(out+=" selected"),out+=">"+encodeHTML(country)+"</option>"}out+='</select></div><div class="col-xs-12 margin-bottom text-right address-form-submit margin-top hidden"><button type="button" class="button button-green"><i class="fa fa-save icon-left"></i>'+trans("save")+"</button></div></div>"}else row.type==App.FormRowType.TEXT?(out+='<input name="'+row.name+'" type="text" class="text-input full-width" value="'+encodeHTML(row.value||"")+'"',row.required&&(out+=" required"),out+=">"):row.type==App.FormRowType.EMAIL&&(out+='<input name="'+row.name+'" type="email" class="text-input full-width" value="'+encodeHTML(row.value||"")+'"',row.required&&(out+=" required"),out+=">");out+="</div></div>"}}out+="</div>"}return out},tmpl.historyItem=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="history-item"><table><tr><td class="top icon-left"><span class="avatar" style="background-image: url(\''+view.user_avatar+"')\">";return view.user_avatar||(out+=""+view.user_initials),out+='</span></td><td class="top"><div class="history-content">'+encodeHTML(view.history.content)+'</div><div class="history-meta"><i class="fa fa-clock-o icon-left" data-container="#main" data-toggle="tooltip" title="'+view.history.full_date+'"></i>'+view.history.date+"</div></td></tr></table></div>"},tmpl.importFile=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#" method="post"><div class="title-bar">'+trans("importer_fichier_csv_vcf")+'</div><div class="content"><div class="property property-block"><div class="property-value"><input type="file" name="import" data-button="button-primary" accept=".csv" required="required"></div></div>';return view.model_url&&(out+='<div class="property property-block"><div class="property-value text-right"><a href="'+view.model_url+'" target="_blank" class="button button-link"><i class="fa fa-file-o icon-left"></i>'+trans("account.download_import_model")+"</a></div></div>"),out+='</div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button type="submit" class="button button-blue"><i class="fa fa-upload icon-left"></i>'+trans("import")+'</button></div><div class="clear"></div></div></form>'},tmpl.loadingScreen=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="loading-screen"><img src="'+view.loading_image_url+'"><div>'+view.message+'<i class="fa fa-spinner fa-pulse"></i></div></div>';return out},tmpl.manageItemsTags=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("tags_management")+'</div></div><div class="content"><div class="property property-block"><span class="property-value"><ul class="list list-picker list-scrollable list-scrollable-fixed-height tag-list" data-shadow="true" data-search-input></ul></span></div></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("close")+'</button></div><div class="clear"></div></div></form>';return out},tmpl.messages=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("contact_some_admin")+'</div></div><div class="content"><div class="float-left half-width"><div class="property property-block"><span class="property-name">'+trans("select_recipients")+'</span><span class="property-value"><ul class="list list-picker list-scrollable-s" data-shadow="true">',arr1=view.users;if(arr1){var user,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,user=arr1[i1],out+='<li class="user checkbox-selector" data-user="'+user.user_id+'"><input type="checkbox" name="user[]" value="'+user.user_id+'" class="icon-left"><span class="avatar" style="background-image: url(\''+user.avatarPath()+"')\">",user.hasAvatar()||(out+=""+user.initials),out+="</span>"+user.display_name+"</li>"}return out+='</ul></span></div></div><div class="float-left half-width"><div class="section-padding-left"><div class="property property-block"><span class="property-name">'+trans("your_message")+'</span><span class="property-value"><textarea class="text-input full-width" name="message" placeholder="'+trans("write_message")+'"></textarea></span></div><div class="property property-block"><span class="property-value"><input class="icon-left" type="checkbox" checked name="sendme" id="messages-copy-self"><label for="messages-copy-self">'+trans("email.send_me_a_copy")+'</label></span></div></div></div><div class="clear"></div></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">Annuler</button><button type="button" class="button button-accept messages-send dismiss">'+trans("sent_message_to_admin")+'</button></div><div class="clear"></div></div></form>'},tmpl.multiProjectRow=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li class="account_wimis_row header_menu_entry" data-project="'+view.slug+'"><a href="#"><div class="project-folder icon-left"><img class="';return view.project_has_custom_image&&(out+="custom-image"),out+='" alt="Logo" src="'+view.image_url+'"/></div><span class="account_wimis_name">'+view.name+'</span><span class="go_to"><i class="fa fa-arrow-circle-right no-margin"></i></span></a></li>'},tmpl.multiWimiRow=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li class="account_wimis_row header_menu_entry"><a href="'+view.url+'" target="_blank"><span class="avatar"';return view.avatar&&(out+=" style=\"background-image: url('"+view.avatar+"')\""),out+=">",view.avatar||(out+=""+view.initials),out+='</span><span class="account_wimis_name">'+view.name+'</span><span class="go_to"><i class="fa fa-arrow-circle-right no-margin"></i></span></a></li>'},tmpl.projectAddUser=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+view.title+'</div></div><div class="content"><div class="margin-bottom"><input class="input text-input full-width search-input" placeholder="'+trans("rechercher_input")+'..." autofocus></div><div class="relative users-table full-width list-scrollable-fixed-height"></div></div><div class="controls"><table class="full-width"><tr>';return view.canCreate&&(out+='<td class="padding-right"><button type="button" class="button button-blue create-user"><i class="fa fa-user-plus icon-left"></i>'+trans("creer_contributeur")+"</button></td>"),out+='<td class="min nowrap text-right"><button type="button" class="button dismiss">'+trans("annuler")+"</button>",view.selectAll&&(out+='<button type="submit" class="button button-accept select-users" disabled>'+view.actionLabel+"</button>"),out+="</td></tr></table></div></form>"},tmpl.projectEdit=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("modifier_projet")+'</div></div><div class="content"><div class="property property-block"><span class="property-name">'+trans("nom_projet")+'</span><span class="property-value"><input autocomplete="off" autofocus class="input text-input full-width" name="name" placeholder="'+trans("name")+'..." value="'+view.project.name+'"></span></div><div class="property property-block"><span class="property-name">'+trans("categorie")+'</span><span class="property-value"><select class="" data-classes="full-width" name="category">',arr1=view.categories;if(arr1){var category,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,category=arr1[i1],out+='<option value="'+category.category_id+'"',category.category_id==view.project.category_id&&(out+=" selected"),out+=">"+category.category_name+"</option>"}return out+='</select></span></div><div class="property property-block"><span class="property-name">'+trans("description")+'</span><span class="property-value"><textarea name="info" class="input text-input full-width" placeholder="'+trans("description")+'">'+view.project.info+'</textarea></span></div></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button type="submit" class="button button-accept edit">'+trans("editer")+'</button></div><div class="clear"></div></div></form>'},tmpl.projectEditRights=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("project.access_rights.title",{project:view.project.name})+'</div></div><div class="content"><div class="property property-block"><div class="property-info">'+trans("project.access_rights.info")+'</div><div class="list-scrollable" data-shadow="true"><table class="full-width control-edit-table auth-edit-table text-center highlight-row"><thead><tr><th class="full-width"></th>',arr1=view.modules;if(arr1){var module,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,module=arr1[i1],out+='<th><span class="inline-block line-height-normal" data-toggle="tooltip" data-placement="top" data-container="body" title="'+trans("modules."+module.id)+'"><button type="button" class="control-light switch-module-rights',view.project.hasModuleEnabled(module.id)||(out+=" disabled"),out+='"',view.project.hasModuleEnabled(module.id)||(out+=" disabled"),out+='><i class="fa fa-fw fa-'+module.icon+'"></i></button></span></th>'}out+="</tr></thead><tbody>";var arr2=view.users_rights;if(arr2){var user_rights,i2=-1,bObj="object"==typeof arr2,keys2=bObj?Object.keys(arr2):null,l2=keys2?keys2.length:arr2.length;for(idx2=0;idx2<l2;idx2++){i2=keys2?keys2[idx2]:idx2,user_rights=arr2[i2],out+='<tr class="user-row" data-user="'+user_rights.user.user_id+'"><td class="text-left"><span class="avatar"',user_rights.user.hasAvatar()&&(out+=" style=\"background-image: url('"+user_rights.user.avatarPath()+"')\""),out+=">",user_rights.user.hasAvatar()||(out+=""+user_rights.user.initials),out+="</span><span>"+user_rights.user.display_name+"</span></td>";var arr3=view.modules;if(arr3){var module,i3=-1,bObj="object"==typeof arr3,keys3=bObj?Object.keys(arr3):null,l3=keys3?keys3.length:arr3.length;for(idx3=0;idx3<l3;idx3++)if(i3=keys3?keys3[idx3]:idx3,module=arr3[i3],view.project.hasModuleEnabled(module.id)){
out+='<td class="control-switch-group module-right" data-module="'+module.id+'">';var arr4=module.auth;if(arr4){var module_auth,index=-1,bObj="object"==typeof arr4,keys4=bObj?Object.keys(arr4):null,l4=keys4?keys4.length:arr4.length;for(idx4=0;idx4<l4;idx4++)index=keys4?keys4[idx4]:idx4,module_auth=arr4[index],out+='<button type="button" data-right="'+index+'" class="control-switch auth-control control-light ',user_rights.auth[module.id]==index&&(out+="control-switch-on"),out+=" "+App.Rights.colorForAuthType(module_auth)+'" title="'+App.Rights.labelForAuthType(module_auth,module.id)+'" data-toggle="tooltip" data-placement="top" data-container="body"><i class="fa fa-fw '+App.Rights.iconForAuthType(module_auth)+'"></i></button>'}out+="</td>"}else out+='<td><span class="inline-block line-height-normal" title="'+trans("module_disabled")+'" data-toggle="tooltip" data-placement="top" data-container="body"><button type="button" class="control-light disabled" disabled><i class="fa fa-fw fa-ellipsis-h"></i></button></span></td>'}out+="</tr>"}}return out+='</tbody></table></div></div></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button type="submit" class="button button-accept edit"><i class="fa fa-save icon-left"></i>'+trans("save")+'</button></div><div class="clear"></div></div></form>'},tmpl.projectLayout=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="project" data-project="'+view.project.project_id+'"><div id="project-bar"><ul id="module-list">',arr1=view.modules;if(arr1){var module,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,module=arr1[i1],out+='<li><a id="menu-'+module.id+'" data-container="body" data-toggle="tooltip" data-placement="right" title="'+trans(module.trad,{icon:module.icon})+'" class="module colorable-border" href="/#/'+view.project.slug+"/"+module.id+'"><i class="fa fa-'+module.icon+'"></i></a></li>'}return out+='</ul></div><div id="sidebar" class="ui-dark"></div><div id="project-container"><div id="project-overlay"></div><div id="project-content"></div></div></div>'},tmpl.projectRemoveUser=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("project_remove_participant")+'</div></div><div class="content">'+trans("project_remove_participant_confirm",{user:view.user_name,project:view.project_name})+'</div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("annuler")+'</button><button autofocus type="submit" class="button button-red remove"><i class="fa fa-trash-o icon-left"></i>'+trans("remove")+'</button></div><div class="clear"></div></div></form>';return out},tmpl.relog=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("relog.title")+'</div></div><div class="content"><input type="hidden" name="email" value="'+view.email+'"><div class="property property-block"><div class="alert alert-info">'+trans("relog.info")+'</div></div><div class="property property-block"><span class="property-name">'+trans("password")+'</span><span class="property-value"><input type="password" autofocus class="input text-input full-width" name="password" placeholder="'+trans("password")+'"></span></div><div class="property property-block"><div class="alert alert-danger hidden bad-password">'+trans("password.wrong")+'</div></div></div><div class="controls"><div class="float-right"><button type="submit" class="button button-accept">'+trans("confirm")+'</button></div><div class="clear"></div></div></form>';return out},tmpl.sidebarProject=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="sidebar-project"><div class="section-padding"><table><tr><td class="full-width text-center"><span class="project-name">'+view.project_name+'</span></td><td class="top">';return view.can_edit_project&&(out+='<button class="control-light edit-project" data-toggle="tooltip" data-placement="top" data-container="#main" title="'+trans("editer")+'"><i class="fa fa-fw fa-pencil"></i></button>'),out+='</td></tr></table></div><div class="section-padding text-center"><div class="project-folder"><img class="',view.project_has_custom_image&&(out+="custom-image"),out+='" alt="Logo" src="'+view.image_url+'"/>',view.image_preset_class&&(out+='<div class="absolute fullscreen"><div class="'+view.image_preset_class+'"></div></div>'),out+='</div></div></div><div id="sidebar-module"></div><div id="sidebar-users"></div>'},tmpl.sidebarProjectUsers=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="section-padding"><div class="section-title"><table><tr><td class="full-width">'+trans("contributeurs")+'</td><td class="top nowrap"><a href="mailto:'+view.mailto_users+'" class="control-light" data-toggle="tooltip" data-placement="top" data-container="#main" title="'+trans("mail_to_all_user")+'"><i class="fa fa-fw fa-envelope-o"></i></a>';view.can_add_user_to_project&&(out+='<button class="control-light add-user-to-project" data-toggle="tooltip" data-placement="right" data-container="#main" title="'+trans("add_contrib")+'"><i class="fa fa-fw fa-user-plus"></i></button>'),out+="</td></tr></table></div>",view.can_edit_rights&&(out+='<div><button class="button button-dark edit-project-rights block-bottom-margin full-width" data-container="#main" data-placement="right"><i class="fa fa-lock icon-left"></i>'+trans("modifier_les_dorits")+"</button></div>"),out+='<ul id="project-users">';var arr1=view.users;if(arr1){var user,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,user=arr1[i1],out+='<li class="user reveal-hover" data-user="'+user.user_id+'"><table class="full-width"><tr><td class="top min"><span class="avatar dark"',user.hasAvatar()&&(out+=" style=\"background-image: url('"+user.avatarPath()+"')\""),out+=' data-status="'+user.status+'">',user.hasAvatar()||(out+=""+user.initials),out+='</span></td><td class="full-width relative"><div class="absolute user-name relative ellipsis"><span>'+user.display_name+'</span></div></td><td class="on-hover"><div class="controls nowrap">',user.user_id!==view.user_id&&(user.skype&&(out+='<a class="control" href="skype:'+user.skype+'?chat" data-container="#main" data-toggle="tooltip" data-placement="top" title="'+trans("start_skype_discussion")+" "+user.fullName()+'"><i class="fa fa-fw fa-skype"></i></a>'),out+='<span class="control open-chat" data-chat-user="'+user.user_id+'" data-toggle="tooltip" data-container="#main" data-placement="top" title="'+trans("start_discussion")+" "+user.fullName()+'"><i class="fa fa-fw fa-comments"></i></span>',view.airtime_active&&(out+='<span class="control open-air" data-air-users="'+user.user_id+'" data-toggle="tooltip" data-container="#main" data-placement="top" title="AirTime"><i class="fa fa-fw fa-video-camera"></i></span>')),view.can_remove_user_from_project&&(out+='<span class="control remove-user-from-project" data-toggle="tooltip" data-container="#main" data-placement="top" title="'+trans("remove")+'"><i class="fa fa-fw fa-times-circle"></i></span>'),out+="</div></td></tr></table></li>"}return out+="</ul></div>"},tmpl.sidebarProjects=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="sidebar-module"></div><div id="sidebar-projects"><div class="section-padding"><div class="section-title"><table><tr><td><i class="fa fa-briefcase icon-left"></i></td><td>'+trans("mes_espaces")+'</td></tr></table></div><div class="spaced"><table><tr><td><span class="checkAll clickable inline-block icon-left" data-check-container="sidebar-projects-list"><i class="fa fa-check-square icon-left"></i>'+trans("tous")+'</span>/</td><td><span class="uncheckAll clickable inline-block icon-right" data-check-container="sidebar-projects-list"><i class="fa fa-square-o icon-left"></i>'+trans("none")+'</span></td></tr></table></div><ul id="sidebar-projects-list" class="sidebar-list">',arr1=view.projectsByCat;if(arr1){var cat,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++){i1=keys1?keys1[idx1]:idx1,cat=arr1[i1],out+='<li><span class="inline-block reveal-hover list-section" data-toggle="tooltip" title="'+trans("select_all").toUpperFirst()+'" data-placement="right" data-container="#main" data-delay="200"><table><tr class="clickable"><td class="unless-hover"><i class="fa fa-fw fa-list-ul text-left icon-left"></i></td><td class="on-hover"><i class="fa fa-fw fa-check-square-o text-left icon-left"></i></td><td>'+cat.name+"</td></tr></table></span><ul>";var arr2=cat.projects;if(arr2){var project,i2=-1,bObj="object"==typeof arr2,keys2=bObj?Object.keys(arr2):null,l2=keys2?keys2.length:arr2.length;for(idx2=0;idx2<l2;idx2++)i2=keys2?keys2[idx2]:idx2,project=arr2[i2],out+='<li data-project="'+project.project_id+'"><table><tr><td class="full-width"><div class="check-option"><input class="sidebar-project" type="checkbox" id="sidebar-project-'+project.project_id+'" checked><label class="clickable" for="sidebar-project-'+project.project_id+'"><span>'+project.name+'</span></label></div></td><td><div class="controls icon-right"><a href="/#/'+project.slug+"/"+view.module+'" class="control" data-toggle="tooltip" title="'+trans("goto_project")+'" data-container="#main" data-placement="right" data-delay="200"><i class="fa fa-fw fa-chevron-right"></i></a></div></td></tr></table></li>'}out+="</ul></li>"}}return out+="</ul></div></div>"},tmpl.sidebarUser=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="sidebar-module"></div>';return out},tmpl.support=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div><div class="title-bar">'+trans("wimi_support")+'</div></div><div class="content">',arr1=view.links;if(arr1){var link,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,link=arr1[i1],out+='<div class="section-padding"><a class="button full-width',link.color&&(out+=" button-"+link.color),out+='" href="'+link.link+'" target="_blank">',link.icon&&(out+='<i class="fa fa-'+link.icon+' icon-left"></i>'),out+=link.text+"</a></div>"}return out+="</div>"},tmpl.tagPicker=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<form action="#"><div><div class="title-bar">'+trans("tags")+'</div></div><div class="content"><div class="property property-block"><span class="property-value"><ul class="list list-picker list-scrollable list-scrollable-fixed-height tag-list" data-shadow="true" data-search-input><li><table class="full-width"><tr><td><span class="new-tag-label"></span></td><td class="min"><button type="button" class="button button-link button-green"><i class="fa fa-plus icon-left"></i>'+trans("create")+"</button></td></tr></table></li>",arr1=view.tags;if(arr1){var tag,i1=-1,bObj="object"==typeof arr1,keys1=bObj?Object.keys(arr1):null,l1=keys1?keys1.length:arr1.length;for(idx1=0;idx1<l1;idx1++)i1=keys1?keys1[idx1]:idx1,tag=arr1[i1],out+='<li data-tag="'+tag.tag_id+'"><span class="item-tag">'+tag.label+"</span></li>"}return out+='</ul></span></div></div><div class="controls"><div class="float-right"><button type="button" class="button dismiss">'+trans("close")+'</button></div><div class="clear"></div></div></form>'},tmpl.treeBoxItem=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<li data-ref="'+view.item.ref+'" data-type="'+view.item.type+'" class="';return view.is_folded&&(out+="folded"),out+=" ",view.can_select&&(out+="selectable"),out+=' tree-box-item">',view.show_item&&(out+='<i class="fa fa-caret-right folding-icon icon-left fa-fw',view.can_unfold||(out+=" hidden"),out+='"></i><label><table class="full-width"><tr><td class="top min"><i class="fa fa-fw fa-spinner fa-pulse icon-left loading-icon"></i><i class="fa fa-'+view.icon+" ",view.is_dir&&(out+="folder-icon"),out+=' item-icon icon-left fa-fw"></i></td>',view.can_check&&(out+='<td class="top min"><input ',view.disabled&&(out+="disabled"),out+=' type="checkbox" name="'+view.item.type+"_"+view.item.ref+'" data-type="'+view.item.type+'" ',view.checked&&(out+="checked"),out+=' class="item-selection"></td>'),out+='<td class="top"><span class="item-name word-wrap">'+view.item.name+"</span></td></tr></table></label>"),out+="</li>"},tmpl.unauthorizedModule=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div class="notif-screen"><i class="fa fa-lock notif-icon"></i><div>'+view.message+"</div></div>";return out},tmpl.uploadProgress=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div><div class="block-bottom-margin"><strong>'+view.filename+'</strong></div><table class="full-width"><tr><td class="min"><span class="icon-left"><span class="upload-percentage">0</span>%</span></td><td><div class="upload-bar"><div class="upload-bar-inner"></div></div></td></tr></table></div>';return out},tmpl.userDetails=function anonymous(view){var encodeHTML="undefined"!=typeof _encodeHTML?_encodeHTML:function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}}();view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div><div class="title-bar">'+trans("user_information")+'</div></div><div class="content"><div class="property property-block text-center">'+view.avatar+'</div><div class="property property-block text-center">'+encodeHTML(view.first_name)+' <span class="bold">'+encodeHTML(view.last_name)+'</span></div><br><div class="text-center"><div class="inline-block text-left">';return view.email&&(out+='<div class="property property-block inline-block"><i class="fa fa-fw fa-envelope-o icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("email")+'"></i><a href="mailto:'+encodeHTML(view.email)+'" class="link">'+encodeHTML(view.email)+"</a></div>"),view.phone&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-phone icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("telephone")+'"></i>'+view.phone.phone+" ("+trans(view.phone.type)+")</div>"),view.phone_bis&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-phone icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("telephone")+'"></i>'+view.phone_bis.phone+" ("+trans(view.phone_bis.type)+")</div>"),view.title&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-briefcase icon-left" data-placement="left" data-toggle="tooltip" title="'+view.titleField+'"></i>'+encodeHTML(view.title)+"</div>"),view.department&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-group icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("department")+'"></i>'+encodeHTML(view.department)+"</div>"),view.company&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-building-o icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("societe")+'"></i>'+encodeHTML(view.company)+"</div>"),view.skype&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-skype icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("skype")+'"></i>'+encodeHTML(view.skype)+"</div>"),view.tags&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-tags icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("tags")+'"></i>'+view.tags.map(function(a){return"<span class='item-tag'>"+a.label.makeSafe()+"</span>"}).join("")+"</div>"),view.timezone&&(out+='<br><div class="property property-block inline-block"><i class="fa fa-fw fa-globe icon-left" data-placement="left" data-toggle="tooltip" title="'+trans("timezone")+'"></i>'+view.timezone+"</div>"),out+="</div></div>",view.deleted?out+='<div class="property property-block text-center alert alert-warning">'+trans("deleted_user")+"</div>":view.trash&&(out+='<div class="property property-block text-center alert alert-warning">'+trans("disabled_user")+"</div>"),out+='<br><div class="controls"><div class="float-left margin-right">',view.trash||view.deleted||(out+='<button type="button" class="dismiss open-chat button button-primary" data-chat-user="'+view.user_id+'"><i class="fa fa-comments-o icon-left"></i>Chat</button><button type="button" class="dismiss open-air button" data-air-users="'+view.user_id+'"><i class="fa fa-fw fa-video-camera icon-left"></i>AirTime</button>'),out+='</div><div class="float-right"><button type="button" class="button dismiss">'+trans("close")+'</button></div><div class="clear"></div></div></div>'},tmpl.userLayout=function anonymous(view){view=view||{};for(var _ks=Object.keys(view),_l=_ks.length,_k,_v,i=0;i<_l;i++)_k=_ks[i],eval("var "+_k+" = view['"+_k+"'];");var out='<div id="user-module"><div id="sidebar"></div><div id="project-container" class="user-module-container"><div id="project-overlay"></div><div id="project-content"></div></div></div>';return out},tmpl}();